<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Detecting Top-10-API-Vulnerabilities-with-vAPI</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="e962c52a-79d0-4cfc-8eb9-821a8c173699" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/nasa_robert_stewart_spacewalk.jpg" style="object-position:center 40%"/><h1 class="page-title">Detecting Top-10-API-Vulnerabilities-with-vAPI</h1><p class="page-description"></p></header><div class="page-body"><p id="5802a8f4-0449-4750-9ecc-15989ad345b9" class=""><code>Team</code>:</p><ol type="1" id="88eb1ca3-6153-42d5-a10b-cd88a6c2d885" class="numbered-list" start="1"><li><mark class="highlight-blue"><strong>Khasan Abdurakhmanov</strong></mark></li></ol><ol type="1" id="cbc872da-31f8-4cde-90bd-b334f3e83fb0" class="numbered-list" start="2"><li><mark class="highlight-teal"><strong>Mbachan Fabrice</strong></mark></li></ol><ol type="1" id="8d90df3c-9b5f-4333-896a-49f98368263e" class="numbered-list" start="3"><li><mark class="highlight-yellow"><strong>Ahmed Saad</strong></mark></li></ol><ol type="1" id="dce57f6f-be46-4e5f-8240-eee9086c4879" class="numbered-list" start="4"><li><mark class="highlight-orange"><strong>Vanel Nara</strong></mark></li></ol><hr id="316a3022-cca2-4b88-aa86-904a0eecdb56"/><nav id="1c6afeca-a5ad-48bb-bdf9-31ed5c54aaca" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#75bde440-3f9c-4835-9608-8f131095430e">Introduction</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e008ee1d-8a48-4aa4-bb65-6cf56acd6aad">Importance of Monitoring Docker Containers</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e67b40b4-c194-49f4-b2ef-2359b09006b6">1. Tools and Setup</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6c94a5ac-04f0-4454-acd8-fa27e47f6471">1.1 Docker Engine</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3fc49135-9c53-4b98-8a2b-7c4c38c1e2f8">1.2 Vulnerable Docker Container vAPI</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#db6e0582-0566-475a-8054-94af9a089db6">1.3 <strong>Wazuh - The Open Source Security Platform</strong></a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3377056a-fe4b-45b6-887c-aad28a6bb5df"><strong>1.3.1 Architecture</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#02c85271-d62f-4ea0-8b2e-e87ca222bc7a">1.4 Deployment Methods</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#9703fa49-11c0-496b-8335-1643c9f042df">1.4.1 <strong>Wazuh Docker deployment</strong></a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#95796f97-b6e2-4f43-975d-f338b709ccca">1.4.2 Wazuh Manual Deployment</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#022bb570-9da5-4143-a496-88780cf5d694">1.4.3 Wazuh Cloud</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3cccdbd6-4c4c-48b8-8019-55b7befdc9af">2. Configuring Wazuh SIEM</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e6ed6421-405a-435e-83e4-11bc111f2e11">2.1 Configuring Wazuh to Monitor Docker Containers</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#fcf6422b-5d83-461d-9387-c0ed063ae963">2.1.1 Installing Wazuh Agent on Docker Host</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#f7c2bb8e-e1bd-426e-807a-e65c0de219b2">2.1.2 Monitoring Docker events</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e31f623b-af37-452f-8e30-4594536323fe">2.1.3 <strong>Monitoring Docker container logs</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4d0cf263-92d3-4acc-bd15-38f5d60461d1">3. Configuring Vulnerable Application</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1e12d379-f9ea-43d7-aa49-9b167f3c863d">4 Detecting Attacks on Endpoints</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#98507bd3-a2f7-4e20-b90f-508cf6a5154c">4.1 <strong> Broken Object-Level Authorization (BOLA)</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0ff31457-4903-456a-95a0-30d89dbb8594">4.2 <strong> Broken Authentication</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2eebfe2b-fd17-497b-8877-950a9aec0759">4.3 <strong> Lack of resources and rate-limiting</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d5dac5fd-a6a7-484a-8855-dff89c875346">4.4 <strong>Broken function-level authorization</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#594e607a-2cab-4c1b-b961-f04e9bbce6c9">4.5 <strong>Security misconfiguration</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#34a12e0c-18b6-4dae-847d-5e8056420b36">4.6 <strong>Injection</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0dd71510-c632-4939-91c8-013b10a80064">Conclusion</a></div></nav><h1 id="75bde440-3f9c-4835-9608-8f131095430e" class="">Introduction</h1><p id="92ea9b83-2e5e-4bc9-ab91-8ac84fdf5e0f" class="">In the modern landscape of containerized applications, <strong>Docker</strong> has become a pivotal technology for deploying <em>scalable</em> and <em>portable</em> environments. However, with the increased usage of <strong>Docker</strong>, the threat landscape has also expanded, making <strong>Docker</strong> containers an attractive target for cyber attackers. Vulnerabilities within containers can lead to <em>severe breaches</em>, <em>data theft</em>, and <em>system compromises</em>. Therefore, it is crucial to implement robust security measures to monitor and protect these environments.</p><p id="db42730f-2d0d-43a4-af9b-7b21ca1b3f90" class=""><strong>Wazuh</strong>, an open-source security monitoring platform, provides comprehensive capabilities to detect and respond to security incidents in <strong>Docker</strong> environments. By leveraging <strong>Wazuh&#x27;s</strong> powerful <em>detection engine</em>, <em>custom rules</em>, and <em>real-time monitoring</em>, organizations can significantly enhance their ability to identify and prevent attacks targeting vulnerable <strong>Docker</strong> containers.</p><div id="a1cb875a-7616-455b-a40b-c121750eae54" class="column-list"><div id="fd6a7bdd-a6f1-490f-8745-43ade53b1d1a" style="width:43.75%" class="column"><figure id="c76b48df-7d19-4f79-84db-ee24397e68f6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled.png"><img style="width:242px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled.png"/></a></figure></div><div id="3b40bb17-7722-46ac-9f8a-351c3085707b" style="width:56.25%" class="column"><p id="85d511fb-00be-40e0-991f-6f1f127251e3" class="">
</p><figure id="8966cafa-3739-4078-a0d4-ca465bc2e3fe" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/5c9462dc-2bdf-4e91-8c26-ac63e7d14ab6.png"><img style="width:432px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/5c9462dc-2bdf-4e91-8c26-ac63e7d14ab6.png"/></a></figure><p id="a1e1da82-82da-402f-b14d-5a560cc1296b" class="">
</p></div></div><p id="221e2961-e77b-4009-96f0-699a30205cdf" class="">This guide will walk you through the process of configuring <strong>Wazuh</strong> to detect various types of attacks exploiting vulnerabilities in <strong>Docker</strong> containers. We will cover the necessary steps to set up the <strong>Docker Listener</strong> module, create custom <strong>decoders</strong> and <strong>rules</strong>, and analyze the relevant logs to identify potential attacks. By following these best practices, you can strengthen the security posture of your <strong>Docker</strong> infrastructure and minimize the risk of successful exploits.</p><h2 id="e008ee1d-8a48-4aa4-bb65-6cf56acd6aad" class="">Importance of Monitoring Docker Containers</h2><ul id="732e9474-0936-4aab-bc53-2c6e06d82b18" class="bulleted-list"><li style="list-style-type:disc"><strong>Visibility:</strong> Monitoring Docker containers ensures visibility into the runtime behavior of applications and infrastructure, enabling early detection of malicious activities.</li></ul><ul id="a42cace2-5d97-4873-91b4-9cc222289e18" class="bulleted-list"><li style="list-style-type:disc"><strong>Compliance:</strong> Many regulatory standards require continuous monitoring of systems. Using Wazuh to monitor Docker environments helps in achieving compliance.</li></ul><ul id="81189976-b246-4e49-9817-8887f9ee79fb" class="bulleted-list"><li style="list-style-type:disc"><strong>Incident Response:</strong> With real-time alerts and logs, security teams can respond promptly to incidents, minimizing potential damage.</li></ul><ul id="7c7cbad6-c4a9-470f-b164-d1c7c875bbbb" class="bulleted-list"><li style="list-style-type:disc"><strong>Improved Security Posture:</strong> Regular monitoring and analysis of container logs help in identifying and mitigating vulnerabilities, thereby improving the overall security posture of the environment.</li></ul><hr id="6fe5303d-ccd8-4289-901a-4bf19f1e1f47"/><h1 id="e67b40b4-c194-49f4-b2ef-2359b09006b6" class="">1. Tools and Setup</h1><p id="3a7b9910-d106-4cb5-ac65-a357c09ebc63" class="">Before diving into the specifics of configuring <strong>Wazuh</strong> for monitoring <strong>Docker</strong> containers, it&#x27;s essential to have a clear understanding of the tools involved and their setup. This section will cover the installation and basic setup of the <strong>Docker engine</strong>, deploying a vulnerable container, and providing an in-depth explanation of the <strong>Wazuh</strong> architecture.</p><h2 id="6c94a5ac-04f0-4454-acd8-fa27e47f6471" class="">1.1 Docker Engine</h2><p id="2a9d787c-3569-46d0-88c0-a32cf82387a0" class="">The foundation of our setup is the <strong>Docker engine</strong>, which is  responsible for running and managing the <strong>Docker</strong> containers. Ensure that you have <strong>Docker</strong> installed and configured on your system.</p><ol type="1" id="d9bee3af-44d7-4b66-ba5f-055b2249c3fd" class="numbered-list" start="1"><li><strong>Docker</strong> is a platform that has gained wide acceptance for <em>containerization</em>. It greatly simplifies the process of managing and deploying applications in containers, making it a vital tool for any developer.<figure id="719eeb32-00fd-468d-a501-3ce8c97f2719" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%201.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%201.png"/></a></figure></li></ol><ul id="3d8f6db8-3542-4972-b2bd-c06e7d916a63" class="bulleted-list"><li style="list-style-type:disc"><strong><a href="https://docs.docker.com/engine/install/">Install Docker</a></strong>: You can follow the detailed instructions provided on the <strong>Docker</strong> website to install <strong>Docker</strong> on your system. This will ensure that you have the latest and most secure version.</li></ul><p id="9f95ca02-cbc4-4033-bc0c-140b7117abc5" class="">In addition to <strong>Docker</strong>, this guide will also use <strong>Docker Compose</strong> to define and manage the multi-container application. <strong>Docker Compose</strong> allows you to define the services, networks, and volumes required for the application in a single configuration file, making it easier to set up and manage the environment.</p><h2 id="3fc49135-9c53-4b98-8a2b-7c4c38c1e2f8" class="">1.2 Vulnerable Docker Container vAPI</h2><p id="840044eb-3511-4206-a8f5-f1feabdac250" class="">In this guide, we will be using a deliberately vulnerable <strong>Docker</strong> container to demonstrate the detection capabilities of <strong>Wazuh</strong>.</p><figure id="7da8eec7-51cb-467b-bd7e-eace494215ee" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%202.png"><img style="width:640px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%202.png"/></a></figure><p id="d72abaf4-d997-4e06-a5bd-69b429bf5915" class="">This project is intentionally designed as a vulnerable <strong>Flask</strong> application for the purpose of education. Its primary goal is to showcase a variety of common web vulnerabilities that frequently pose a risk in the digital world. By providing a real-life simulation of these vulnerabilities, this project serves as an invaluable learning tool for a diverse range of individuals. You can set up the vulnerable container by following the steps outlined in the <a href="https://sne-m23-sn.github.io/Vulnerable-Flask-App/">previous guide</a>.</p><h2 id="db6e0582-0566-475a-8054-94af9a089db6" class="">1.3 <strong>Wazuh - The Open Source Security Platform</strong></h2><p id="3bd5fdd1-2938-4929-82f3-1a3965a528da" class=""><strong>Wazuh</strong> is a free and open source platform used for <em>threat prevention</em>, <em>detection</em>, and <em>response</em>. It is capable of protecting workloads across on-premises, <em><strong>virtualized</strong></em>, <em><strong>containerized</strong></em>, and <em><strong>cloud-based</strong></em> environments.</p><figure id="addef860-d754-4724-b607-0fcbb21de422" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%203.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%203.png"/></a></figure><p id="f8baf7c9-7dc4-4e73-99cc-93106546e950" class=""><strong>Wazuh</strong> solution consists of an <em>endpoint security agent</em>, deployed to the monitored systems, and a <em>management server</em>, which collects and analyzes data gathered by the agents. Besides, <strong>Wazuh </strong>has been fully integrated with the <strong>Elastic Stack</strong>, providing a <em>search engine</em> and <em>data visualization</em> tool that allows users to navigate through their security alerts.</p><h3 id="3377056a-fe4b-45b6-887c-aad28a6bb5df" class=""><strong>1.3.1 Architecture</strong></h3><p id="b51c3449-3ccb-4343-84c4-540400748261" class="">The <strong>Wazuh</strong> architecture uses agents on monitored endpoints to forward security data to a central server. <strong>Agentless</strong> devices like <em>firewalls</em>, <em>switches</em>, <em>routers</em>, and access points can send log data via <strong>Syslog</strong>, <strong>SSH</strong>, or <strong>API</strong>. The server <em>decodes</em> and <em>analyzes</em> this information, then sends it to the <code>Wazuh indexer</code> for indexing and storage.</p><p id="cad9d6f2-79c2-41c5-ba6c-cf7df950f1eb" class="">A <code>Wazuh indexer</code> cluster can have one or more nodes for read and write operations. Small deployments can use a <strong>single-node cluster</strong>, while <strong>multi-node clusters</strong> are better for large data volumes or high availability.</p><p id="a0a719d4-4643-44c5-aec5-98877ca7fbff" class="">For production, it&#x27;s recommended to deploy the <code>Wazuh server</code> and <code>indexer</code> on different hosts. <code>Filebeat</code> securely forwards <strong>Wazuh</strong> alerts and events to the indexer cluster using <strong>TLS</strong> encryption.</p><p id="c63be2ad-b352-4ce4-b21b-959ba21e1b98" class="">The diagram below shows a <strong>Wazuh</strong> deployment architecture, illustrating the components and how the server and indexer nodes can be configured as clusters for <em>load balancing</em> and <em>high availability</em>.<br/> <br/></p><figure id="09456062-ddc7-49ad-9eee-2268dd903a51" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%204.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%204.png"/></a></figure><p id="943258cb-a654-4303-92cd-5d4fc0cbeffe" class="">The <strong>Wazuh agent</strong> sends events to the <strong>Wazuh server</strong> for <em>analysis</em> and <em>threat detection</em>. The <strong>agent</strong> connects to the server on port <code>1514</code> (default, configurable). The server <em>decodes</em> and checks <em>events</em>, adding alert data if a rule is triggered. Events are saved to:</p><ul id="c0382155-e765-48fc-ba67-e55d66890cf0" class="bulleted-list"><li style="list-style-type:disc"><code>/var/ossec/logs/archives/archives.json</code> (all events)</li></ul><ul id="e31f2433-1f78-4e29-bb68-fd06f091c2d4" class="bulleted-list"><li style="list-style-type:disc"><code>/var/ossec/logs/alerts/alerts.json</code> (events triggering high-priority rules, configurable)</li></ul><p id="3c29d774-c928-46fd-a7d6-caa4ec7f8858" class=""><strong>Wazuh</strong> uses <strong>AES</strong> encryption (128-bit blocks, 256-bit keys) by default, with optional Blowfish encryption.</p><p id="19b64271-6534-4817-a854-12cf7e9735cc" class="">The <strong>Wazuh server</strong> uses <strong>Filebeat</strong> to send <em>alert</em> and <em>event data</em> to the <strong>Wazuh</strong> <strong>indexer</strong> with <strong>TLS </strong>encryption. <strong>Filebeat</strong> reads the server output and sends it to the indexer (default port 9200/TCP). The indexed data is then visualized using the <strong>Wazuh</strong> dashboard. The <strong>Wazuh dashboard</strong> queries the <strong>Wazuh RESTful API</strong> (default port 55000/TCP) to display configuration and status information of the <strong>Wazuh server</strong> and agents. It can also modify settings through API calls, with communication <em>encrypted</em> and <em>authenticated</em> by username and password.</p><hr id="5deb0f27-13a6-4570-b530-665897b7fb41"/><h2 id="02c85271-d62f-4ea0-8b2e-e87ca222bc7a" class="">1.4 Deployment Methods</h2><p id="436473c5-c671-4884-99ce-962bbf6b5b2f" class="">There are three methods to deploy Wazuh:</p><ol type="1" id="f2df01da-ad83-4410-b149-6069aa0a79c0" class="numbered-list" start="1"><li><strong>Wazuh via Docker:</strong> Deploy <strong>Wazuh</strong> components as <strong>Docker</strong> containers.<ul id="1da29aae-19e9-4b67-9f98-5449b922dacf" class="bulleted-list"><li style="list-style-type:disc">Building Docker images for the Wazuh manager, indexer, and dashboard components</li></ul><ul id="b1f791e8-96a2-482c-bbf2-c91f74978ade" class="bulleted-list"><li style="list-style-type:disc">Configuring a multi-node Wazuh deployment using Docker Compose</li></ul><ul id="006df841-afd1-4ffc-9daa-5146ebfda2c0" class="bulleted-list"><li style="list-style-type:disc">Generating SSL/TLS certificates for secure communication between the Wazuh components</li></ul></li></ol><ol type="1" id="dced80b4-6f4e-442f-b800-e52e9eeeb2b7" class="numbered-list" start="2"><li><strong>Wazuh Manual Installation:</strong> Install <strong>Wazuh</strong> components directly on the host operating system.<ul id="b1d0a82a-227d-4880-834d-e713ebe1ad1f" class="bulleted-list"><li style="list-style-type:disc">Installing the Wazuh central components (server, indexer, and dashboard) on one or more hosts</li></ul><ul id="b33cbae1-21b9-46ba-a16e-c2ffe22b8033" class="bulleted-list"><li style="list-style-type:disc">Deploying the Wazuh agent on the endpoints to be monitored</li></ul><ul id="e49f70a1-19e2-44b1-b691-543625e024f7" class="bulleted-list"><li style="list-style-type:disc">Configuring the Wazuh components and integrating them into the infrastructure</li></ul></li></ol><ol type="1" id="e2466f20-8892-454d-bbcd-38fb694c5d67" class="numbered-list" start="3"><li><strong>Wazuh Cloud:</strong> Use the <strong>Wazuh Cloud</strong> service for a managed deployment.<ul id="4e3b5cf8-8e88-4f15-8764-dfc1edeab107" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud hosts and manages all the Wazuh components in a single integrated platform</li></ul><ul id="f118df22-2739-47b2-b3c8-f90bc036f5a3" class="bulleted-list"><li style="list-style-type:disc">It handles the installation, scaling, and updates of the Wazuh components</li></ul><ul id="314b4fb9-ca9a-4295-9cef-fb02682dc2e2" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud provides a free trial to create and explore the cloud environment</li></ul><ul id="4fe0ab3e-38e8-43a1-930d-b02c37f4963f" class="bulleted-list"><li style="list-style-type:disc">It offers predefined environment profiles (Small, Medium, Large) to cater to different needs</li></ul></li></ol><p id="bbb8bba3-f8dc-4a4d-aad3-8ac46979f108" class="">In summary, you can choose from these three options to set up <strong>Wazuh</strong> based on your specific requirements, infrastructure, and resource constraints.</p><h3 id="9703fa49-11c0-496b-8335-1643c9f042df" class="">1.4.1 <strong>Wazuh Docker deployment</strong></h3><p id="34755b73-e311-4b74-97df-5707e1e7d839" class="">You can deploy <strong>Wazuh</strong> as a <em>single-node</em> or <em>multi-node</em> stack.</p><ul id="2272368f-e296-4e3d-b35c-e9579c04589a" class="bulleted-list"><li style="list-style-type:disc"><strong>Single-node deployment</strong>: Deploys one <strong>Wazuh manager</strong>, <strong>indexer</strong>, and <strong>dashboard node</strong>.</li></ul><ul id="d1f3dbf2-6983-4d02-9695-73488d371833" class="bulleted-list"><li style="list-style-type:disc"><strong>Multi-node deployment</strong>: Deploys two <strong>Wazuh</strong> <strong>manager nodes</strong> (one master and one worker), three <strong>Wazuh indexer nodes</strong>, and a <strong>Wazuh dashboard</strong> node.</li></ul><p id="6e1f57af-83e0-485f-81ac-fba4634f42c7" class="">Both deployments use persistence and allow configuring certificates to secure communications between nodes. The multi-node stack is the only deployment that contains high availability.</p><p id="442fe52c-e2e5-4079-863c-ad83d8628e97" class="">In our case we will only consider <strong>Single-node deployment</strong>:</p><ol type="1" id="cea90b70-cf38-418a-ae2a-6a0d31250916" class="numbered-list" start="1"><li><strong>Clone the Wazuh repository to your system:</strong></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e1bc1778-8ddb-4ef4-80e2-820d5e025492" class="code"><code class="language-Bash">git clone https://github.com/wazuh/wazuh-docker.git -b v4.3.0</code></pre><figure id="1c358510-9d60-4b72-a084-49ef0649f515" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%205.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%205.png"/></a></figure><p id="bba5b10c-10c5-4d3d-b7d3-77a81adc50ac" class="">Provide a group of certificates for each node in the stack to secure communication between the nodes. You have two alternatives to provide these certificates:</p><ul id="130b3228-b693-4ce1-a19e-326640c34df9" class="bulleted-list"><li style="list-style-type:disc"><strong>Generate self-signed certificates for each cluster node</strong><ul id="a482a159-17fb-489e-93e0-ee82bc48821f" class="bulleted-list"><li style="list-style-type:circle">We have created a <strong>Docker</strong> image to automate certificate generation using the <strong>Wazuh</strong> certs gen tool.</li></ul><ul id="9394eac8-b22e-4a86-aa86-5f017ed70cb8" class="bulleted-list"><li style="list-style-type:circle">If your system uses a proxy, add the following to the <code>generate-indexer-certs.yml</code> file. If not, skip this particular step:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c3e92df2-a5c3-49e2-86e9-a27a3a84914a" class="code"><code class="language-Bash">environment:
  - HTTP_PROXY=YOUR_PROXY_ADDRESS_OR_DNS</code></pre></li></ul><p id="a3e2fce4-4b2d-40a0-91cb-a79ce26d67fb" class=""><strong>A completed example looks like:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="57096d15-d019-4e6c-a250-e39b39e4ad88" class="code"><code class="language-Bash"># Wazuh App Copyright (C) 2017 Wazuh Inc. (License GPLv2)
version: &#x27;3&#x27;

services:
  generator:
    image: wazuh/wazuh-certs-generator:0.0.2
    hostname: wazuh-certs-generator
    volumes:
      - ./config/wazuh_indexer_ssl_certs/:/certificates/
      - ./config/certs.yml:/config/certs.yml
    environment:
      - HTTP_PROXY=YOUR_PROXY_ADDRESS_OR_DNS</code></pre></li></ul><p id="1d7f2f0e-4974-4836-8db6-0abbef37ea54" class="">Execute the following command to get the desired certificates:</p><p id="11a58a38-c557-4ca6-8049-594ceeeea15e" class=""><strong>Docker Compose version 2:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fc33e4eb-622b-49e9-a04b-365cce6dda7d" class="code"><code class="language-Bash">docker-compose -f generate-indexer-certs.yml run --rm generator</code></pre><p id="4baccad6-dfb1-4ef4-9ed4-056c88d57bc5" class=""><strong>Docker Compose version 3:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="729b3085-c593-4d88-941d-1056fc536724" class="code"><code class="language-Bash">docker compose -f generate-indexer-certs.yml run --rm generator</code></pre><figure id="ce2e6c08-f26e-495b-abd0-9e4b4cb69316" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%206.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%206.png"/></a></figure><p id="4dcc3287-4552-498b-8850-19f962491cba" class="">This saves the certificates into the <code>config/wazuh_indexer_ssl_certs</code> directory.</p><ol type="1" id="5305c408-0f2c-46e1-a3f0-e7d59c735b30" class="numbered-list" start="2"><li><strong>Provide your own certificates for each node.</strong><ul id="4a4ac7fb-3af4-4340-8f0c-3911109abe41" class="bulleted-list"><li style="list-style-type:disc">In case you have your own certificates, provision them as follows in the <code>config/wazuh_indexer_ssl_certs</code> directory:<br/><br/><strong>Wazuh indexer</strong>:</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="61a4eb2c-9af1-4b0d-a3da-2079b00a1aee" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/root-ca.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer-key.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer.pem
config/wazuh_indexer_ssl_certs/admin.pem
config/wazuh_indexer_ssl_certs/admin-key.pem</code></pre><p id="62ed5a35-54c5-4c77-ae24-04cc6b39e63a" class=""><strong>     Wazuh manager</strong>:<div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d73eb989-3b34-4c04-b429-50642047f2c3" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/root-ca-manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager-key.pem</code></pre><p id="06862bf9-2545-4c00-9c1a-1d9c30c0f2ee" class=""><strong>Wazuh dashboard</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d5bcf864-cf58-4ecd-9ac7-219108b9ff3b" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/wazuh.dashboard.pem
config/wazuh_indexer_ssl_certs/wazuh.dashboard-key.pem
config/wazuh_indexer_ssl_certs/root-ca.pem</code></pre></div></p></li></ol><ol type="1" id="27a8ba40-31ca-4382-8c44-2a7d08db0791" class="numbered-list" start="3"><li><strong>Start the Wazuh single-node deployment using docker-compose:</strong><p id="8ce6921b-31dc-48fe-bbee-e05d76e97ae2" class=""><strong>Foreground</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cd73a0ca-ecef-49c9-8bb0-86ce86df7b73" class="code"><code class="language-Bash">docker-compose up</code></pre><figure id="d3803dd3-de15-4a13-ab1b-4e84e9c319e9" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%207.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%207.png"/></a></figure><figure id="464be6d2-d579-4207-8f89-eebb021063a4" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%208.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%208.png"/></a></figure><p id="d3124fa7-7e5a-4cc9-8be8-2fcb14d62026" class=""><strong>Background</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d1dfe685-2964-40bc-8798-6878be272882" class="code"><code class="language-Bash">docker compose up -d</code></pre><figure id="b179c717-e3f8-448d-8a03-7835778306cf" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%209.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%209.png"/></a></figure><p id="23651aa4-3039-401d-9b41-63807beb5504" class="">The default <em>username</em> and <em>password</em> for the <strong>Wazuh</strong> <strong>dashboard</strong> are <code>admin</code> and <code>SecretPassword</code>. For <a href="https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html#change-pwd-existing-usr">additional security</a>, you can change the <em>default password</em> for the <strong>Wazuh indexer</strong> <em>admin</em> user.</p><figure id="28a23a8c-d857-48c4-b219-a94fec568c77" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2010.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2010.png"/></a></figure><figure id="3284c86a-13ab-4cef-b4cb-57313dbbe37c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2011.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2011.png"/></a></figure><figure id="82df4ee1-dd90-47ed-9e44-2f47dee49613" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2012.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2012.png"/></a></figure><figure id="66f51a85-f59b-488d-920a-74daf2b30e1e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2013.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2013.png"/></a></figure></li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="0844df0f-478b-45eb-8931-acf7fe08cfba"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">It’s recommended to use <strong>Wazuh</strong> version <code>4.3</code>. If you want to deploy it via <strong>Docker</strong>, use a <strong>Linux OS</strong> because the <em>certificates</em> are not created properly on <strong>Windows OS</strong>.</div></figure><hr id="3fba36f5-da1e-49db-8f89-e83f5356ef10"/><h3 id="95796f97-b6e2-4f43-975d-f338b709ccca" class="">1.4.2 Wazuh Manual Deployment</h3><p id="4bcdad2f-a147-4335-82c0-35e42f9dd537" class="">The <strong>Wazuh indexer</strong> and <strong>Wazuh server</strong> can be installed on a <strong>single host</strong> or distributed across <strong>multiple hosts</strong> in a cluster configuration. There are two main installation methods for each <strong>Wazuh</strong> central component. Both methods provide instructions for installing the components either on a single host or on separate hosts.</p><p id="f0965200-c857-4aa2-9ebb-9e479d0d0c72" class="">For greater deployment flexibility and customization, you can start with the <strong>Wazuh indexer</strong> deployment. This approach allows for an all-in-one installation as well as the installation of components on separate servers.</p><p id="a525aa4f-ff58-4e6c-b563-6d20526c1ffc" class=""><strong>Here is the installation workflow you will follow:</strong></p><figure id="4fa6ca29-8af6-4559-abb8-ab5fa7129992" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2014.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2014.png"/></a></figure><blockquote id="bb49390f-2fec-4b6a-9301-a00b8059c126" class="block-color-gray_background"><mark class="highlight-yellow"><strong>Wazuh Indexer</strong></mark></blockquote><p id="e5d17239-af5a-489b-8f51-cd5f2b18a96b" class="">The <strong>Wazuh indexer</strong> is a highly scalable, full-text search and analytics engine. This central component indexes and stores alerts generated by the <strong>Wazuh server</strong>, providing near real-time data search and analytics capabilities.</p><p id="4f685f0e-4a8c-49f0-ae51-069f00754eb2" class="">You can install the <strong>Wazuh indexer</strong> on a <em>single host</em> or distribute it across multiple nodes in a cluster configuration. A clustered setup offers scalability, high availability, and improved performance.</p><p id="7a7d83ba-3274-4f6a-8c03-f713012e488f" class=""><strong>The installation process is divided into three stages.</strong></p><ol type="1" id="1b257954-f520-4eeb-8cc5-f6353986529a" class="numbered-list" start="1"><li><code><strong>Initial configuration</strong></code></li></ol><ol type="1" id="74cd6a5f-9f33-4630-8390-0bc3ec616e7b" class="numbered-list" start="2"><li><code><strong>Wazuh indexer nodes installation</strong></code></li></ol><ol type="1" id="15be5de5-4240-4655-815b-af6a832f158f" class="numbered-list" start="3"><li><code><strong>Cluster initialization</strong></code><strong> </strong></li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="62844b7a-29d5-4108-a847-20fb3a236656"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>You need root user privileges to run all the commands described below.</strong></div></figure><blockquote id="164c5a46-37c7-4c54-bb22-3328f21b10e3" class=""><mark class="highlight-yellow"><strong>1. Initial configuration</strong></mark></blockquote><p id="4195bcef-bb23-4cb8-9164-3dcc496ced90" class="">Indicate your deployment configuration, create the SSL certificates to encrypt communications between the Wazuh components, and generate random passwords to secure your installation.</p><ol type="1" id="bfee5263-179e-421f-929c-b6a9e7992f18" class="numbered-list" start="1"><li><strong>Download the Wazuh installation assistant and the configuration file.</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a09d9580-02cf-4349-bb8c-f3373cf6a398" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh
curl -sO https://packages.wazuh.com/4.3/config.yml</code></pre><figure id="c3db0faf-ae76-4cdf-b1d4-b716e8341c67" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2015.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2015.png"/></a></figure></li></ol><ol type="1" id="119b9358-7f66-4f75-8880-a3c6a5750a50" class="numbered-list" start="2"><li><strong>Edit the </strong><code><strong>./config.yml</strong></code><strong> and replace the node names and IP values with the corresponding names and IP addresses.</strong> You need to do this for all <strong>Wazuh server</strong>, <strong>Wazuh  indexer</strong>, and <strong>Wazuh dashboard</strong> nodes. Add as many node fields as needed.<figure id="37999757-fcf4-4316-80bc-3050fc63371c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2016.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2016.png"/></a></figure></li></ol><ol type="1" id="0f9df774-ef9f-4fce-89a8-5843b4ade71b" class="numbered-list" start="3"><li><strong>Run the assistant with the option</strong> <code>--generate-config-files</code> to generate the <strong>Wazuh cluster</strong> key, certificates, and passwords necessary for installation. You can find these files in <code>./wazuh-install-files.tar</code>.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2bc7a153-6c44-41af-8481-21dbb2750f31" class="code"><code class="language-Bash">bash wazuh-install.sh --generate-config-files</code></pre><figure id="fd67d542-30ae-4e2c-b320-58c2cd8a806a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2017.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2017.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="1a565fc6-ecdd-43be-bd40-cca85a5cf606"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><ol type="1" id="03dcc4fa-af0e-4afc-b4c6-f2aeba87a419" class="numbered-list" start="4"><li>Copy the <code>wazuh-install-files.tar</code> file to all the servers of the distributed deployment, including the <strong>Wazuh server</strong>, the <strong>Wazuh indexer</strong>, and the <strong>Wazuh dashboard</strong> nodes. This can be done by using the <code>scp</code> utility.</li></ol></li></ol><hr id="555ac4f7-d4e3-4a56-b3ae-dcf8d6c55eb9"/><blockquote id="756873d6-829e-46ea-8fd6-51d38f3ccb86" class=""><mark class="highlight-yellow"><strong>2. Wazuh indexer nodes installation</strong></mark></blockquote><p id="f68dc865-9fe3-45d0-952b-10e8a0b1323c" class="">Install and configure the <strong>Wazuh</strong> indexer nodes.</p><ol type="1" id="03afa145-654d-473a-a093-efdf223d9b95" class="numbered-list" start="1"><li>Download the Wazuh installation assistant.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9f790316-306b-41cf-9054-dfce002f200d" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="92bef44b-a468-4f57-8b5b-64ec386652b9" class="numbered-list" start="2"><li>Run the assistant with the option <code>-wazuh-indexer</code> and the node name to install and configure the <strong>Wazuh indexer</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>node-1</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="fb79ed48-1eab-494a-8683-abcf7dd33ef1"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Make sure that a copy of <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3375e259-e6c0-4a07-928c-ae7d69c87656" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-indexer node-1</code></pre><figure id="ae25deac-c5f7-4b3a-935f-8d6ff538b271" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2018.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2018.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="e5fd364c-d91c-4e70-8ab4-344302865fc8"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="b65ef894-1a00-4052-88af-f00bddd5bdfe" class="">Repeat this stage of the installation process for every <strong>Wazuh indexer</strong> node in your cluster. Then proceed with initializing your <strong>single-node</strong> or <strong>multi-node</strong> cluster in the next stage.</p><hr id="127b3d33-56b5-4298-971e-cfc5ae7ee8f3"/></li></ol><blockquote id="8372e65d-d967-44e1-a377-80f236670d14" class=""><mark class="highlight-yellow"><strong>3. Cluster initialization</strong></mark></blockquote><p id="988e7cfb-ec50-4d41-827f-883bc10309ee" class="">The final stage of installing the <strong>Wazuh indexer</strong> <em>single-node</em> or <em>multi-node</em> cluster consists of running the security admin script.</p><ol type="1" id="1e5250a2-4f01-4317-8367-8a5e6a015f4c" class="numbered-list" start="1"><li>Run the Wazuh installation assistant with option <code>-start-cluster</code> on any <strong>Wazuh indexer</strong> node to load the new certificates information and start the cluster.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7083a1ae-e24c-43e1-9209-7e83b782ced1" class="code"><code class="language-Bash">bash wazuh-install.sh --start-cluster</code></pre><figure id="93b5bc3f-c3dd-48b9-b3f8-0ed7bb05c5ad" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2019.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2019.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="19c4c428-5e65-4e28-806d-5c1a7bd4bbe9"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">You only have to initialize the cluster once, there is no need to run this command on every node.</div></figure></li></ol><blockquote id="f4678e38-5e1c-4d69-b443-a997652d508c" class=""><mark class="highlight-teal"><strong>Testing the cluster installation</strong></mark></blockquote><ol type="1" id="47cbcd7e-b509-4f8e-903c-01bcc6ad70cf" class="numbered-list" start="1"><li>Run the following command to get the <em>admin</em> password:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3a960e12-4a45-4dba-8766-c723f145d90a" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200</code></pre><figure id="98c495d6-d833-4da7-9c45-137906369e70" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2020.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2020.png"/></a></figure></li></ol><ol type="1" id="0e875f2d-52f2-4575-bceb-eea9640e6429" class="numbered-list" start="2"><li>Run the following command to confirm that the installation is successful. Replace <code>&lt;ADMIN_PASSWORD&gt;</code> with the password gotten from the output of the previous command. Replace <code>&lt;WAZUH_INDEXER_IP&gt;</code> with the configured <strong>Wazuh indexer IP </strong>address:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5cc91f0f-941d-416a-87af-27065e4639cb" class="code"><code class="language-Bash">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200</code></pre><figure id="75acdd6c-f3cf-4db9-a0e2-307a38ab59ea" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2021.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2021.png"/></a></figure></li></ol><ol type="1" id="a804fc6a-596d-4b7d-85f6-4031605a383c" class="numbered-list" start="3"><li>Replace <code>&lt;WAZUH_INDEXER_IP&gt;</code> and <code>&lt;ADMIN_PASSWORD&gt;</code>, and run the following command to check if the cluster is working correctly:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3476f447-5715-4c01-ac78-58db71ffbbfd" class="code"><code class="language-Bash">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200/_cat/nodes?v</code></pre><figure id="d8478a00-ba33-4251-987e-4d43f2d4d083" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2022.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2022.png"/></a></figure></li></ol><p id="6e4d6f39-ecbb-4a61-875c-301402036ce4" class="">The <strong>Wazuh indexer</strong> is now successfully installed, and you can proceed with installing the <strong>Wazuh server</strong>. </p><blockquote id="ccb1a715-54c6-48f9-acc9-26aafbd6df2d" class=""><mark class="highlight-blue"><strong>Wazuh Server</strong></mark></blockquote><p id="a06c51bd-ba78-4a48-9cee-59294042c6b2" class="">The <strong>Wazuh server</strong> analyzes data received from <strong>Wazuh agents</strong>, triggering alerts when threats or anomalies are detected. It also allows for remote management of agent configurations and monitoring their status.</p><p id="6b2959ff-fba1-4ecc-ab3c-b77cbe3e286b" class="">You can install the <strong>Wazuh server</strong> on a <em>single host</em> or distribute it across <em>multiple nodes</em> in a cluster configuration. Multi-node configurations offer high availability and improved performance. When combined with a network load balancer, this setup can efficiently utilize its capacity.</p><figure id="5551c394-33cd-4e2f-853a-d7ce3bf742dc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2023.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2023.png"/></a></figure><blockquote id="36685ceb-24a4-431e-a3b9-3e5f874058bb" class=""><mark class="highlight-blue"><strong>Wazuh server cluster installation</strong></mark></blockquote><ol type="1" id="35291342-818e-4e0c-b67d-2b9a0e2ea0cf" class="numbered-list" start="1"><li>Download the Wazuh installation assistant:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8ad67374-8177-46c5-838c-3fc85679d0dc" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="233c807a-a3b4-4a55-8faa-2c6272b7488a" class="numbered-list" start="2"><li><strong>Run the assistant with the option</strong> <code>--wazuh-server</code> followed by the node name to install the <strong>Wazuh server</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>wazuh-1</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="57ff61b8-070e-4b5a-8993-d947a1c98760"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Make sure that a copy of the <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d6d51d62-27b3-4e8d-a41b-844306a460ee" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-server wazuh-1</code></pre><figure id="2aed7344-271c-44ae-9661-08cdb58415f3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2024.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2024.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="4cf08736-5480-42ff-b84d-a30f0c06bdda"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="aba48b2d-3d3e-4a69-9ee4-72fbc9f7aac9" class=""><strong>Your Wazuh server is now successfully installed.</strong></p><ul id="34b167a8-477f-4c29-8e4f-4dfb227b67a4" class="bulleted-list"><li style="list-style-type:disc">If you want a <strong>Wazuh server</strong> <em>single-node cluster</em>, everything is set and you can proceed directly with <em>Installing the Wazuh dashboard using the assistant</em>.</li></ul><ul id="58f970c9-86e2-45f9-916e-d67f34b70943" class="bulleted-list"><li style="list-style-type:disc">If you want a <strong>Wazuh server</strong> <em>multi-node cluster</em>, repeat this process on every <strong>Wazuh server </strong>node.</li></ul></li></ol><p id="3758a3de-c2e1-4e3b-9f5e-c6d703b9e239" class="">The <strong>Wazuh server</strong> installation is now complete, and you can proceed with installing the Wazuh dashboard.</p><hr id="a14e3cb1-589b-492d-bc80-cf0c9e9ca228"/><blockquote id="4886d99c-b97a-4cd9-a058-891391db4377" class=""><mark class="highlight-red"><strong>Wazuh Dashboard</strong></mark></blockquote><p id="9f58890c-beec-44b1-b106-77e7f359f083" class="">The <strong>Wazuh dashboard</strong> is a flexible and intuitive web interface for mining, analyzing, and visualizing security data. It provides out-of-the-box dashboards, allowing seamless navigation through the user interface.</p><p id="b4aa790c-538d-4209-a564-a8d5992a2235" class="">With the <strong>Wazuh dashboard</strong>, users can visualize security events, detected vulnerabilities, file integrity monitoring data, configuration assessment results, cloud infrastructure monitoring events, and regulatory compliance standards.</p><figure id="6391ae48-c42a-45e2-88f0-30bac3811c7b" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2025.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2025.png"/></a></figure><blockquote id="f7dddb2d-a0b4-40bd-ba9f-94a65f467747" class=""><mark class="highlight-red"><strong>Wazuh dashboard installation</strong></mark></blockquote><ol type="1" id="f386b0c3-2f0d-4b0b-8127-ec70ba743b74" class="numbered-list" start="1"><li>Download the Wazuh installation assistant. This step can be skipped if you have already installed <strong>Wazuh indexer</strong> on the same server.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="69f8e35e-56a0-433f-a959-fd64ebb95ba8" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="50187b3b-e86e-458a-8f30-c0e900beea19" class="numbered-list" start="2"><li>Run the assistant with the option <code>--wazuh-dashboard</code> and the node name to install and configure the <strong>Wazuh dashboard</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>dashboard</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="5c8d24ba-6330-4311-b2e7-2f8ed2f2c2d2"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Make sure that a copy of the <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e160795f-0ced-46ed-b4f0-504942ab65bf" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-dashboard dashboard</code></pre><figure id="e4fe7cea-0dc2-4631-bdc8-7f7ab810a80c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2026.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2026.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="ec64e362-626d-4aed-a483-5618da68d456"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="b690da4f-0034-4cad-ad6d-609572bc4d02" class="">Once the assistant finishes the installation, the output shows the access credentials and a message that confirms that the installation was successful.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0c0fc371-aced-4e01-b62c-8385ee8aa846" class="code"><code class="language-Bash">INFO: --- Summary ---
INFO: You can access the web interface https://&lt;wazuh-dashboard-ip&gt;
   User: admin
   Password: &lt;ADMIN_PASSWORD&gt;

INFO: Installation finished.</code></pre><p id="2058398a-7d4b-4318-bfa4-88d272c66158" class="">You now have installed and configured <strong>Wazuh</strong>. All passwords generated by the <strong>Wazuh</strong> installation assistant can be found in the <code>wazuh-passwords.txt</code> file inside the <code>wazuh-install-files.tar</code> archive. To print them, run the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4b6f0b75-011e-49c8-b853-5ddc1997d694" class="code"><code class="language-Bash">tar -O -xvf wazuh-install-files.tar wazuh-install-files/wazuh-passwords.txt</code></pre><figure id="56abce27-631a-4fa4-8acf-ec107118f69a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2027.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2027.png"/></a></figure></li></ol><ol type="1" id="80c1dbf8-a0cd-4946-ba4e-9486f44f10b0" class="numbered-list" start="3"><li>Access the <strong>Wazuh</strong> web interface with your credentials.<ol type="a" id="7dc3396b-6b2d-4a35-b270-a3bc337449d9" class="numbered-list" start="1"><li><strong>URL</strong>: <em>https://&lt;wazuh-dashboard-ip&gt;</em></li></ol><ol type="a" id="6b07c930-d764-4fe0-921e-1697e882e1e8" class="numbered-list" start="2"><li><strong>Username</strong>: <em>admin</em></li></ol><ol type="a" id="2babc8d5-ed9f-4f1e-8d63-8715355a450e" class="numbered-list" start="3"><li><strong>Password</strong>: <em>&lt;ADMIN_PASSWORD&gt;</em></li></ol><figure id="7273c6ab-6f26-4c43-b9d2-cf39baf3a4cc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2028.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2028.png"/></a></figure><figure id="d5cbcdf5-9e7d-4383-a493-eabe9f2222a5" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2029.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2029.png"/></a></figure><figure id="58e5b3a0-ea93-4fa6-90bc-7bfa40d5a595" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2030.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2030.png"/></a></figure><figure id="2dd38ef2-1284-4a5e-8ec1-167b167f8f60" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2031.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2031.png"/></a></figure><p id="3744013a-e222-4911-a241-07c0434f1fb7" class="">When you access the <strong>Wazuh dashboard</strong> for the first time, the browser shows a warning message stating that the certificate was not issued by a trusted authority. An exception can be added in the advanced options of the web browser. For increased security, the <code>root-ca.pem</code> file previously generated can be imported to the certificate manager of the browser instead. Alternatively, a certificate from a trusted authority can be configured.</p><hr id="1cd70a7f-88bb-442e-8ef5-a0048c4cfce2"/></li></ol><h3 id="022bb570-9da5-4143-a496-88780cf5d694" class="">1.4.3 Wazuh Cloud</h3><p id="fa9f1bfa-1749-4dc7-815b-82f95331345d" class=""><strong>Wazuh Cloud</strong> is a <em>cloud-based</em> security monitoring solution that provides organizations with a comprehensive approach to <em>security information</em> and <em>event management</em> (<strong>SIEM</strong>) and extended detection and response (<strong>XDR</strong>). Below are the key details about <strong>Wazuh Cloud</strong>:</p><figure id="746d3d17-6b07-40bb-9192-52816f0c8320" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2032.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2032.png"/></a></figure><p id="e835b71f-5d77-4f54-be03-631ee43a847f" class=""><strong>Wazuh Cloud</strong> enables organizations to monitor their <strong>IT infrastructure</strong>, including <em>on-premises</em>, <em>cloud</em>, and <em>hybrid</em> environments, by leveraging the capabilities of the <strong>Wazuh</strong> platform. It provides a centralized view of security events and incidents, allowing for real-time analysis and response.</p><p id="23310253-f6d1-4fa9-b513-ebda2a8133e4" class=""><strong>Key Features</strong></p><ol type="1" id="20dd79a0-51cb-4f1d-8acd-abf3d8f08712" class="numbered-list" start="1"><li><strong>Centralized Management</strong>:<ul id="77d4df0d-cd8c-4349-aa74-8746a057f874" class="bulleted-list"><li style="list-style-type:disc"><strong>Wazuh Cloud</strong> allows for the centralized management of security events from multiple sources, including servers, workstations, and cloud services.</li></ul></li></ol><ol type="1" id="2f9701c6-6dcf-450f-ac8d-14532845204e" class="numbered-list" start="2"><li><strong>Real-time Monitoring</strong>:<ul id="a2d414a5-e1f7-4c70-a64a-a11c0bede330" class="bulleted-list"><li style="list-style-type:disc">The platform provides real-time monitoring of security events, enabling organizations to detect threats and anomalies as they occur.</li></ul></li></ol><ol type="1" id="168b8278-77ff-4b8f-849d-0aff2fae8c50" class="numbered-list" start="3"><li><strong>Scalability</strong>:<ul id="c173392b-81ae-488d-bdaa-aa034c3151f7" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud is designed to scale with the organization&#x27;s needs, allowing for the addition of new agents and resources without significant overhead.</li></ul></li></ol><ol type="1" id="c34b754b-bebe-4759-aa51-dc3373496400" class="numbered-list" start="4"><li><strong>Compliance Management</strong>:<ul id="fe8bf06e-4e72-4d02-a709-3f804138341f" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud helps organizations meet compliance requirements by providing tools for auditing and reporting on security events.</li></ul></li></ol><ol type="1" id="26caf51b-1a21-414b-9970-5576746678cb" class="numbered-list" start="5"><li><strong>Integration with Cloud Providers</strong>:<ul id="55aea7ed-37d4-4eeb-a48d-4321f0846ba9" class="bulleted-list"><li style="list-style-type:disc">The solution supports integrations with major cloud service providers, allowing for seamless monitoring of cloud resources.</li></ul></li></ol><ol type="1" id="d68ac8ab-e1de-4849-806e-3ecf1f95137a" class="numbered-list" start="6"><li><strong>Threat Intelligence</strong>:<ul id="9374e644-33f6-408c-b762-298f412d7c33" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud incorporates threat intelligence feeds to enhance the detection capabilities and provide context around security events.</li></ul></li></ol><figure id="5ddfac55-df8d-4189-ac9d-68d9efd9a9e1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2033.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2033.png"/></a></figure><p id="c34e2e4a-4d6a-46c6-90bb-5cc04fdd2cf1" class=""><strong>Trial Offer</strong></p><p id="ac1edbdc-be46-4a8a-bf70-5292250524d4" class="">The trial lasts for <strong>14 days</strong>, allowing organizations to explore the features and capabilities of <strong>Wazuh Cloud</strong> without any commitment.</p><figure id="6d8429a8-c002-43a8-a24c-9deee4297072" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2034.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2034.png"/></a></figure><p id="5cf38384-235e-4539-8603-a8c5f14040b1" class="">During the <em>trial</em>, users can access all the functionalities of <strong>Wazuh Cloud</strong>, including <em>agent management</em>, <em>alerting</em>, <em>reporting</em>, and compliance features.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="525a651b-c6f1-4ae6-8a7c-1900891ac319"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">The trial version is offered free of charge and without the use of a <strong>credit card</strong>, making it a great opportunity for organizations to evaluate the solution.<br/>After the trial period, organizations can choose from several pricing plans based on their requirements:<br/></div></figure><figure id="7083096f-c223-4fbf-946f-c99b692f57b2" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2035.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2035.png"/></a></figure><p id="31aa7dd7-30bc-47ad-a52c-740f48df7d27" class=""><strong>Wazuh Cloud</strong> is a valuable tool for organizations looking to enhance their security posture. For more information or to sign up for the trial, you can visit the official <strong>Wazuh</strong> website.</p><hr id="0cab58cd-4172-419f-ac76-fe627093de1b"/><h1 id="3cccdbd6-4c4c-48b8-8019-55b7befdc9af" class="">2. Configuring Wazuh SIEM</h1><h2 id="e6ed6421-405a-435e-83e4-11bc111f2e11" class="">2.1 Configuring Wazuh to Monitor Docker Containers</h2><p id="1b5dd7ef-9a86-4f27-90a5-b52b2651e773" class="">To effectively monitor <strong>Docker containers</strong> using <strong>Wazuh</strong>, you need to configure both the <strong>Wazuh Manager</strong> and the <strong>Wazuh Agent</strong>. This section provides a step-by-step guide on how to set up <strong>Wazuh</strong> to collect logs from <strong>Docker containers</strong>, including installing and configuring the <strong>Wazuh Agent</strong>.</p><h3 id="fcf6422b-5d83-461d-9387-c0ed063ae963" class="">2.1.1 Installing Wazuh Agent on Docker Host</h3><p id="11c82924-632d-42b9-96f2-0f63367c9c35" class="">You can install the <strong>Wazuh agent</strong> on the <strong>Docker host</strong> (<em>the machine where your Docker containers are running</em>) in two primary ways: <strong>manually</strong> or through the <strong>Wazuh UI</strong>. Below, I’ll outline both methods for installing the Wazuh agent.</p><ol type="1" id="b7f4d24a-56d4-49f9-9807-6be9c92182ff" class="numbered-list" start="1"><li><strong>Add Wazuh Repository and Install Agent:</strong><ol type="a" id="20065d95-73d9-4ed8-ada6-84cab2656444" class="numbered-list" start="1"><li>First, add the <strong>Wazuh</strong> repository and install the Wazuh Agent on the host where Docker is running.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c7b54a06-e39a-49f8-8658-253441750854" class="code"><code class="language-Bash">curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import &amp;&amp; chmod 644 /usr/share/keyrings/wazuh.gpg
echo &quot;deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main&quot; | tee -a /etc/apt/sources.list.d/wazuh.list
apt-get update</code></pre><figure id="5ccea78a-9873-400c-8eef-3b7804316474" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2036.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2036.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="0bbfe226-0f44-423d-9b67-6b28df439349"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">For Debian 7, 8, and Ubuntu 14 systems import the GCP key and add the Wazuh repository (steps 1 and 2) using the following commands.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="dc1cf0cb-319e-464c-85fe-07f2dd41cc2c" class="code"><code class="language-Bash">apt-get install gnupg apt-transport-https
curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -
echo &quot;deb https://packages.wazuh.com/4.x/apt/ stable main&quot; | tee -a /etc/apt/sources.list.d/wazuh.list</code></pre></div></figure></li></ol></li></ol><ol type="1" id="5d15aa7e-ba18-40dd-843f-1821dce916d5" class="numbered-list" start="2"><li><strong>Deploy a Wazuh agent</strong><ol type="a" id="b2a50cde-b371-4fa8-b1a6-0006476a8707" class="numbered-list" start="1"><li>To deploy the <strong>Wazuh agent</strong> on your endpoint, select your package manager and edit the <code>WAZUH_MANAGER</code> variable to contain your <strong>Wazuh manager IP</strong> address or hostname.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1975f207-85c4-4309-a8fd-b647fe41206e" class="code"><code class="language-Bash">WAZUH_MANAGER=&quot;IP_ADDRESS&quot; apt-get install wazuh-agent</code></pre><figure id="d7d16ace-284d-4003-8f45-c44259bb1675" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2037.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2037.png"/></a></figure><figure id="403e3bd4-51a2-4463-88a6-81bfc85ba16d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2038.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2038.png"/></a></figure></li></ol></li></ol><ol type="1" id="8bbd864e-553b-48e2-9fdc-d840cdbb7e79" class="numbered-list" start="3"><li><strong>Enable and start the Wazuh agent service</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="047759b3-cf19-4fc5-afd0-2696541e76d2" class="code"><code class="language-Bash">systemctl daemon-reload
systemctl enable wazuh-agent
systemctl start wazuh-agent</code></pre><figure id="9a84e8d9-2746-472a-8f00-0e80ae7e4c3d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2039.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2039.png"/></a></figure><figure id="312a72c1-468d-44cb-a5d9-33113e12bff6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2040.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2040.png"/></a></figure></li></ol><p id="dc35ef8c-fbe3-4dc4-bba7-d982e54831e8" class="">The deployment process is now complete, and the <strong>Wazuh agent</strong> is successfully running on your <strong>Linux system</strong>.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="030e91eb-eb2a-456e-80e4-9000bae545bb"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">The previous steps were for <strong>manual</strong> <strong>Wazuh Agent</strong> installation, but if you want to make it faster and easier, use the<strong> Wazuh UI</strong> to add agents.</div></figure><p id="e7aab474-18a0-4fb7-a5d8-fd59f268d2c1" class=""><strong>Follow these steps to enroll an agent:</strong></p><ol type="1" id="8346f913-d0cd-4cb5-a714-fc521a4060fb" class="numbered-list" start="1"><li>Log into the <strong>Wazuh WUI</strong>.<figure id="76de578b-96ba-45c0-b3a6-56ae4f672f3e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2041.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2041.png"/></a></figure></li></ol><ol type="1" id="769856e0-b158-4a88-a04f-27227a4d92f7" class="numbered-list" start="2"><li>Click the upper-left <strong>Wazuh</strong> icon and then <strong>Agents</strong>.<figure id="29ef8170-dd76-40b7-917c-becc703af1eb" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2042.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2042.png"/></a></figure><figure id="e5f74f42-e800-4f4f-9198-7425b1b837d1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2043.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2043.png"/></a></figure><figure id="b8562b3f-eac9-4914-a5c2-1d31d826cdf0" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2044.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2044.png"/></a></figure></li></ol><ol type="1" id="89006184-6dab-4c50-aaf0-5e6abe08047d" class="numbered-list" start="3"><li>Click <strong>Deploy new agent</strong>.</li></ol><ol type="1" id="eb1d03e3-51ff-4d6d-a978-e0686b0c3678" class="numbered-list" start="4"><li>Follow the steps described on the <strong>Deploy a new agent</strong> page.<figure id="cf7e73af-f509-4170-ab6b-bdee36c8c603" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2045.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2045.png"/></a></figure><figure id="e6db35f2-a850-46ac-a9dd-69ffa4e7ce33" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2046.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2046.png"/></a></figure></li></ol><h3 id="f7c2bb8e-e1bd-426e-807a-e65c0de219b2" class="">2.1.2 Monitoring Docker events</h3><p id="31cbd8c6-38bc-46db-881f-5b6a93d2793b" class=""><strong>Docker</strong> automates the deployment of different applications inside software containers. The <strong>Wazuh module</strong> for<strong> Docker</strong> identifies security incidents across containers and alerts in real-time. In this use case, you configure <strong>Wazuh</strong> to monitor <strong>Docker events</strong> on an <strong>Ubuntu</strong> endpoint hosting Docker containers.<br/>Before you start monitoring <br/><strong>Docker</strong> containers with <strong>Wazuh</strong>, it&#x27;s essential to enable the <strong>Docker Listener</strong> module in the <strong>Wazuh UI</strong>. This module allows the <strong>Wazuh</strong> agent to capture <strong>Docker</strong> events and forward them to the <strong>Wazuh</strong> server for analysis.</p><figure id="5ae4624d-dd69-4d5e-a0ed-68602f9da2bd" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2047.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2047.png"/></a></figure><figure id="17269730-fc13-4ad8-b348-7259836e01f8" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2048.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2048.png"/></a></figure><figure id="10c8a82d-f90a-4700-af42-382e1c52f11e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2049.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2049.png"/></a></figure><p id="21786684-645a-4265-a6a3-17beb2790742" class="">Perform the following steps to install <strong>Docker</strong> on the <strong>Ubuntu</strong> endpoint and configure <strong>Wazuh</strong> to monitor <strong>Docker</strong> events.</p><ol type="1" id="877b63ee-79eb-4293-ac51-22bcf680bcbb" class="numbered-list" start="1"><li><strong>Install Python and pip</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1c86d380-5ff6-4fe8-bc5a-d57f570e6c67" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">sudo apt install python3 python3-pip</code></pre><figure id="cca0ecdb-9209-4ec1-a5d1-8ffe76916d37" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2050.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2050.png"/></a></figure></li></ol><ol type="1" id="b06c124c-e3bc-4edb-816b-e4fe618489a9" class="numbered-list" start="2"><li><strong>Upgrade pip</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1a618994-4195-4cc2-a273-bd2fdf8eeede" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">pip3 install --upgrade pip</code></pre><figure id="d494e4fb-93a6-4198-912c-078b81d05624" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2051.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2051.png"/></a></figure></li></ol><ol type="1" id="12a74a8a-6e30-4cc8-9794-3a4066a7deb8" class="numbered-list" start="3"><li><strong>Install Docker and Python Docker Library</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="54c904a4-ffa9-4a9c-93fe-b0f453c62338" class="code"><code class="language-Bash">curl -sSL https://get.docker.com/ | sh
sudo pip3 install docker==7.1.0 urllib3==2.2.2 requests==2.32.2</code></pre><figure id="8cedd8f9-7c35-4575-8a6a-ff3b95d7757a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2052.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2052.png"/></a></figure><figure id="6c2234fe-077b-4364-a376-0df43b32ded0" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2053.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2053.png"/></a></figure></li></ol><ol type="1" id="d9ba4d0e-a292-49b0-9420-c3c0f8484e7f" class="numbered-list" start="4"><li>Edit the <strong>Wazuh agent</strong> configuration file <code>/var/ossec/etc/ossec.conf</code> and add this block to enable the <code>docker-listener</code> module:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="40225dae-475b-4003-a017-6a538d56534e" class="code"><code class="language-Bash">&lt;ossec_config&gt;
  &lt;wodle name=&quot;docker-listener&quot;&gt;
    &lt;interval&gt;5m&lt;/interval&gt;
    &lt;attempts&gt;5&lt;/attempts&gt;
    &lt;run_on_start&gt;yes&lt;/run_on_start&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
  &lt;/wodle&gt;
&lt;/ossec_config&gt;</code></pre><figure id="30aa4a9b-f216-4d61-ab55-db7979202635" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2054.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2054.png"/></a></figure></li></ol><ol type="1" id="31d3cb77-fd0f-4d94-8006-d739de807a80" class="numbered-list" start="5"><li>Restart the <strong>Wazuh agent</strong> to apply the changes:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="874a11ee-b1ad-4eff-8545-6b3672e67d9c" class="code"><code class="language-Bash">sudo systemctl restart wazuh-agent</code></pre><figure id="ba156399-57e3-474a-8d4e-e85dd0186bea" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2055.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2055.png"/></a></figure></li></ol><p id="54d08ba9-c713-4e44-a407-88c901104884" class="">Perform several <strong>Docker </strong>activities like <em>pulling</em> a <strong>Docker image</strong>, <em>starting an instance</em>, <em>running</em> some other <strong>Docker</strong> commands, and then<em> deleting</em> the container.</p><ol type="1" id="6f11c3b8-15c2-4ddb-a33a-cd0b56d20dcc" class="numbered-list" start="1"><li>Pull an image, such as the <strong>NGINX</strong> image, and run a container:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1ca3bac5-2f74-4b0c-89e4-3feb9ef88029" class="code"><code class="language-Bash">sudo docker pull nginx
sudo docker run -d -P --name nginx_container nginx
sudo docker exec -it nginx_container cat /etc/passwd
sudo docker exec -it nginx_container /bin/bash
exit</code></pre><figure id="68291b4d-8df4-44bf-9c44-e92a2d2b9d7d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2056.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2056.png"/></a></figure><figure id="0ecb8559-5e2f-4e51-a4d8-e7f335f4476d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2057.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2057.png"/></a></figure><figure id="befebea6-1b84-4bbb-9ff5-d02981ac7f2f" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2058.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2058.png"/></a></figure><figure id="553ae248-098c-43c7-9d7a-fdfb4e9e335b" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2059.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2059.png"/></a></figure><figure id="0c361125-8e49-4f9c-a7ff-88236447ef3f" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2060.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2060.png"/></a></figure></li></ol><hr id="ed6763ea-bf33-4a61-b9ec-dc88952b37e9"/><p id="ce54c34c-687b-4545-86b9-e0c65e47d359" class="">To detect vulnerabilities in <strong>Docker containers</strong> using <strong>Wazuh</strong>, you first need to configure <strong>Wazuh</strong> to monitor the logs generated by your <strong>Docker containers</strong>.</p><h3 id="e31f623b-af37-452f-8e30-4594536323fe" class="">2.1.3 <strong>Monitoring Docker container logs</strong></h3><p id="2122a6ee-92c8-427a-a05b-271b3f8fa514" class="">By default, <strong>Docker container</strong> logs only show <code>stdout</code> and <code>stderr</code> standard streams, which are cleared when the container is destroyed. However, when <strong>non-interactive</strong> processes, like a <em>database</em> or <em>web server</em> are run, logs pertaining to these processes are generated. These logs can be collected using <strong>Docker logging drivers</strong> and saved to a file. If the design of a container is good enough, it can provide valuable logs to be examined.</p><p id="34ad99d7-1d40-4d81-a856-c8752a99140f" class="">By default, when a container is created by the docker engine, the <strong>JSON</strong> <strong>File logging</strong> driver is used. Logs captured this way can be found in <code>/var/lib/docker/containers/[container-id]/[container-id]-json.log</code>. The <strong>Wazuh agent</strong> can collect logs directly from this location but the <br/>logs do not provide enough information about which container produced it. This might be a problem when we have a large number of containers. <br/><strong>Rsyslog</strong> is used to improve the container logs by tagging them with their respective container names and grouping them in a directory. The <strong>JSON File logging</strong> driver doesn’t allow the log file location to be changed, so we will use the <strong>Syslog logging driver</strong> instead.</p><p id="b4e711b7-9be6-49bf-a586-04c1550c678f" class="">When creating a container, the <code>--log-driver</code> tag can be specified to set the log driver which will be used. A more global approach is to use a configuration that sets the logging driver for all containers created.</p><p id="7c36443e-aa68-42c2-aa06-b785c7c3d997" class="">To set the global logging driver, create or edit <code>/etc/docker/daemon.json</code>. This way all containers created henceforth will use the <strong>Syslog</strong> driver:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cb869b23-ba10-4469-b737-bccdfb5ff0dd" class="code"><code class="language-JSON">{
  &quot;log-driver&quot;: &quot;syslog&quot;,
  &quot;log-opts&quot;: {
    &quot;syslog-address&quot;: &quot;unixgram:///dev/log&quot;,
    &quot;tag&quot;: &quot;docker/{{.Name}}&quot;
  }
}</code></pre><figure id="3f08ee5a-ad0c-4921-a2f5-653109738cdf" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2061.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2061.png"/></a></figure><p id="bf89144f-2856-4586-99b8-903da931d850" class="">The configuration above specifies:</p><ul id="87e663ea-4d29-4a3d-b761-add81996c85f" class="bulleted-list"><li style="list-style-type:disc">The type of log driver used, which in this case is <strong>Syslog</strong>.</li></ul><ul id="918a3f67-1b0e-485d-b726-d41bc67f926c" class="bulleted-list"><li style="list-style-type:disc">That log messages will be channeled to <code>unixgram:///dev/log</code>, then the <strong>Rsyslog</strong> daemon pulls data from that socket.</li></ul><ul id="e5dc769a-541b-49bb-8723-8f9a44b9caea" class="bulleted-list"><li style="list-style-type:disc">That log messages will be tagged with <code>docker/{{.Name}}</code>, where <code>{{.Name}}</code> replaces the container name.</li></ul><p id="33bf55c4-babb-4c18-a0ca-222090deaaca" class=""><strong>Restart the Docker service to apply changes:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4a41a4db-c671-4421-a15b-865b7298575c" class="code"><code class="language-Bash">systemctl restart docker</code></pre><figure id="4d7fdd8a-53f1-422a-961f-68201702c85d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2062.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2062.png"/></a></figure><p id="e7942bca-8e32-415e-b2fb-7fd60d06c783" class="">We need to configure <strong>Rsyslog</strong> to create and tag new logs from containers in the <code>/var/log/docker</code> folder.</p><p id="5951237a-9123-4acd-b21e-b5ace81c8d5d" class="">Let’s create a configuration file called <code>wazuh-docker.conf</code> in the <code>/etc/rsyslog.d/</code> directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="88542f45-2237-436e-82cb-69c369b3ff13" class="code"><code class="language-Bash">$FileCreateMode 0644
$template DockerDaemonLogFileName,&quot;/var/log/docker/docker.log&quot;
$template DockerContainerLogFileName,&quot;/var/log/docker/%SYSLOGTAG:R,ERE,1,FIELD:docker/(.*)\[--end:secpath-replace%.log&quot;
if $programname == &#x27;dockerd&#x27; then {
  ?DockerDaemonLogFileName
  stop
}
if $programname == &#x27;containerd&#x27; then {
  ?DockerDaemonLogFileName
  stop
}
if $programname == &#x27;docker&#x27; then {
  if $syslogtag contains &#x27;docker/&#x27; then {
  ?DockerContainerLogFileName
  stop
  }
}
$FileCreateMode 0600</code></pre><figure id="82507a8b-5c14-4d49-9fc4-43cf1f4a1e04" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2063.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2063.png"/></a></figure><p id="cafbc73c-cc3d-4556-859c-1c7f2a13d888" class="">The configuration above specifies:</p><ul id="b52bf3d8-750a-4891-ae93-478069bbca9e" class="bulleted-list"><li style="list-style-type:disc">The files created are in <code>0644</code> mode, meaning they will be readable by all the user groups, but writable by the user only.</li></ul><ul id="9277745f-e134-484a-87f6-cdefd32593ae" class="bulleted-list"><li style="list-style-type:disc">That any log from <strong>dockerd</strong>, <strong>containerd</strong>, and docker runtime will be written to <code>/var/log/docker/docker.log</code>.</li></ul><ul id="4b013149-18be-4929-9fe2-7b84681637e8" class="bulleted-list"><li style="list-style-type:disc"><code>SYSLOGTAG:R,ERE,1,FIELD:docker/(.*)\[--end:secpath-replace%</code> is equivalent to the <code>{{.Name}}</code> tag in the <strong>Docker</strong> daemon configuration. Therefore new logs will be located in <code>/var/log/docker/[new container name].log</code>.</li></ul><p id="a04b247f-fca2-41a4-9038-84b27c8d3663" class=""><strong>Restart the Rsyslog service to apply changes:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c29fb315-5810-49e4-a3a1-90a047b39da3" class="code"><code class="language-Bash">systemctl restart rsyslog</code></pre><figure id="64295d19-c515-424e-9420-685446cb53d9" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2064.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2064.png"/></a></figure><p id="ebb8a7ce-7939-469c-b6c3-e0ac66a001b6" class="">New logs should start appearing in the <code>/var/log/docker</code> directory when containers are created.</p><figure id="b9401b5e-c76b-4790-8b89-f4567705eecc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2065.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2065.png"/></a></figure><p id="a9b01a94-85ef-4232-ba5f-2a8fb6843e1d" class="">To configure log collection locally on the agent, add the configuration below inside the <code>&lt;ossec_config&gt;</code> tag of the <code>/var/ossec/etc/ossec.conf</code> file. A wild card is used, this way the <strong>Wazuh agent</strong> will read every container log in that directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5dd0cf9a-cc8e-4e6c-ae1f-55733b5e0ec4" class="code"><code class="language-Bash">&lt;localfile&gt;
  &lt;log_format&gt;syslog&lt;/log_format&gt;
  &lt;location&gt;/var/log/docker/*&lt;/location&gt;
&lt;/localfile&gt;</code></pre><figure id="cd37f71f-1d2e-46ab-84c1-8ae0c6fc6c4b" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2066.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2066.png"/></a></figure><p id="5d02a845-8e89-474b-8ca5-5fc1a70beddb" class=""><strong>Restart the Wazuh agent for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cae89139-ce2d-4c8b-8f97-cf4ede417e81" class="code"><code class="language-Bash">systemctl restart wazuh-agent</code></pre><figure id="b5a44b90-dfbb-4b4b-b86f-7b263dc0a30d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2067.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2067.png"/></a></figure><p id="25738a23-9e51-4dd5-8213-d56e79380013" class="">As mentioned earlier, non-interactive applications produce additional logs, depending on the design of the container. For example, a web server container will generate web logs. So we expect to see <strong>HTTP</strong> web requests like <code>GET</code> in the logs.</p><p id="1b7fcb9c-fde0-4b6c-8bf6-32758c8e5d8c" class="">Let’s set up a simple web server that shows its <em>hostname</em>, <em>IP address</em>, and other information:</p><ul id="220037f4-1808-41b5-8bd7-d7dfea5214b7" class="bulleted-list"><li style="list-style-type:disc">Create a container using the <code>nginxdemos/hello</code> container image. Setting the container name is important for <strong>Rsyslog</strong> to tag the log:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ad54058d-af12-4c66-8773-2836d074a6bb" class="code"><code class="language-Bash">docker run -P -d --hostname webserver --name webserver nginxdemos/hello</code></pre><figure id="731c896c-53ca-44d7-801c-a63c0c2cbbc8" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2068.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2068.png"/></a></figure></li></ul><ul id="510c8e7a-a3bb-4009-ac18-ef7a3e2f0e82" class="bulleted-list"><li style="list-style-type:disc">Check that there is a new log file:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="55653e04-c9b3-4938-8dba-aef229b9d8f1" class="code"><code class="language-Bash">ls /var/log/docker/webserver.log</code></pre><figure id="ef0eb2e3-670c-4e91-8351-e9cc43b3ac1c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2069.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2069.png"/></a></figure></li></ul><p id="1579f630-3f96-432a-a51c-d022b29eaae2" class="">Configure the manager to store events collected by the agent to <code>/var/ossec/logs/archives/archives.json</code> file. These logs will be used to create rules and decoders. In the <code>/var/ossec/etc/ossec.conf</code> file, change <code>&lt;logall_json&gt;</code> to <code><strong>yes</strong></code>. Later <strong>when rules are being triggered</strong>, we change <code>&lt;logall_json&gt;</code> back to <code><strong>no</strong></code>. This way large volumes of logs are not stored on the manager side:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6f127e6d-e144-4ff4-9ca5-40f8629ab394" class="code"><code class="language-Bash">&lt;logall_json&gt;yes&lt;/logall_json&gt;</code></pre><figure id="f17a8e0a-c20b-479f-9d6b-f7fa6a08f1ba" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2070.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2070.png"/></a></figure><p id="bdcff02a-62d3-4c4e-b03a-d6bcd7be5bd8" class=""><strong>Restart the Wazuh manager for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="24998107-0a57-48d2-afb8-4c69ed0b5524" class="code"><code class="language-Bash">systemctl restart wazuh-manager</code></pre><figure id="39876cee-bf07-4fc6-b86d-e8da84ca8b13" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2071.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2071.png"/></a></figure><p id="8ba6b21f-7b54-428f-a97c-a62fcfaf349b" class="">On the <strong>Linux/Unix</strong> endpoint, get the <strong>IP</strong> address of the <strong>web server</strong> container:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4d0ffbb0-77b6-4575-95df-46fda7f0eff2" class="code"><code class="language-Bash">docker inspect webserver | grep IPAddress</code></pre><figure id="394f215f-fa9f-45dd-955f-776e6ed6b95e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2072.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2072.png"/></a></figure><p id="834e6150-c18e-4b58-9684-c3ef21cdc23e" class="">On the <strong>Wazuh manager</strong>, check that it can see the container logs after a curl request is made:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e949bd7e-c7e3-4db5-9ad7-8b24b6624279" class="code"><code class="language-Bash">tail -f /var/ossec/logs/archives/archives.json | grep webserver</code></pre><figure id="3c913d89-d813-4fab-a148-e9a798386406" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2073.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2073.png"/></a></figure><p id="66d06da2-3cd3-4906-a49f-bf88c6c0aaf9" class="">From a machine that can reach the web server, do a curl request or browse to the <strong>web server </strong>container <strong>IP</strong> address:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7c3d93e4-9afb-436b-b49b-7307201039d2" class="code"><code class="language-Bash">curl &lt;webserver_IP&gt;</code></pre><figure id="f8142272-3ad0-4afc-a2b7-5eb5c1538d6e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2074.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2074.png"/></a></figure><p id="08fb2511-d156-42fa-8a3d-f462355eb5c0" class="">The curl request creates an event that is logged to the Wazuh manager archives:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6d9c73ab-f7c0-4eaa-b4de-25f721a0097d" class="code"><code class="language-Bash">{&quot;timestamp&quot;:&quot;2022-02-02T11:53:33.058+0000&quot;,&quot;agent&quot;:{&quot;id&quot;:&quot;025&quot;,&quot;name&quot;:&quot;vagrant&quot;,&quot;ip&quot;:&quot;10.0.2.15&quot;},&quot;manager&quot;:{&quot;name&quot;:&quot;wazuh-manager&quot;},&quot;id&quot;:&quot;1643802813.1121072&quot;,&quot;full_log&quot;:&quot;Feb  2 11:53:32 vagrant docker/webserver[24403]: 172.17.0.1 - - [02/Feb/2022:11:53:32 +0000] \&quot;GET / HTTP/1.1\&quot; 200 7228 \&quot;-\&quot; \&quot;curl/7.58.0\&quot; \&quot;-\&quot;&quot;,&quot;predecoder&quot;:{&quot;program_name&quot;:&quot;docker/webserver&quot;,&quot;timestamp&quot;:&quot;Feb  2 11:53:32&quot;,&quot;hostname&quot;:&quot;vagrant&quot;},&quot;decoder&quot;:{&quot;name&quot;:&quot;docker_log_decoder&quot;},&quot;data&quot;:{&quot;srcip&quot;:&quot;172.17.0.1&quot;,&quot;date&quot;:&quot;02/Feb/2022&quot;,&quot;time&quot;:&quot;2022:11:53&quot;,&quot;web_action&quot;:&quot;\&quot;GET / HTTP/1.1\&quot; 200&quot;},&quot;location&quot;:&quot;/var/log/syslog&quot;}</code></pre><figure id="3d3c11c2-f43e-4914-a682-34414ee7ad42" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2075.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2075.png"/></a></figure><p id="d7ed6c93-0eb3-45ce-a156-d0c27faccd36" class="">The container logs are in the <code>full_log</code> field in the log above. This is the log of interest:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b534e270-a719-4e30-8c6e-b1ac76b52f08" class="code"><code class="language-Bash">Feb  2 11:53:32 vagrant docker/webserver[24403]: 172.17.0.1 - - [02/Feb/2022:11:53:32 +0000] &quot;GET / HTTP/1.1&quot; 200 7228 &quot;-&quot; &quot;curl/7.58.0&quot; &quot;-&quot;&#x27;</code></pre><figure id="f382c240-e1fb-44df-bd36-c1776ebb514e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2076.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2076.png"/></a></figure><p id="44c93bcf-9bfd-446f-abca-4088730b3ec2" class="">Write decoders to extract information from the <code>full_log</code> field. To do it, edit <code>/var/ossec/etc/decoders/local_decoder.xml</code> on the <strong>Wazuh manager</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c8aa9ccb-e2be-41ab-9297-942b155912ba" class="code"><code class="language-Bash">&lt;decoder name=&quot;docker_log_decoder&quot;&gt;
  &lt;program_name&gt;^docker&lt;/program_name&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*.\d*.\d*.\d*)&lt;/regex&gt;
  &lt;order&gt;srcip&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*/\w*/\d*)&lt;/regex&gt;
  &lt;order&gt;date&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*:\d*:\d*)&lt;/regex&gt;
  &lt;order&gt;time&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(&quot;\w*\s/\s\w*/\d.\d&quot;\s\d*)&lt;/regex&gt;
  &lt;order&gt;web_action&lt;/order&gt;
&lt;/decoder&gt;</code></pre><figure id="09b686c1-ffb2-4493-a483-7482f75cabe1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2077.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2077.png"/></a></figure><p id="8835541b-4bcb-487a-a6e9-b02b482b6ae8" class="">We run the log test binary to check that the decoder is extracting the event fields:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1d1ab34d-fdca-42c0-8a12-baf8b7cf7af1" class="code"><code class="language-Bash">/var/ossec/bin/wazuh-logtest</code></pre><p id="8d708ba5-0b4c-45e6-adc7-072e652cd41d" class="">Paste the log after the binary starts:</p><figure id="0387afb4-2f2d-44ce-a518-e957b1b7c8bb" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2078.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2078.png"/></a></figure><p id="ab98daa5-0310-403c-a92c-1c53bf540704" class="">To write a custom rule that triggers an alert when a <strong>GET</strong> request is made to the web server, edit <code>/var/ossec/etc/rules/local_rules.xml</code> on the <strong>Wazuh manager</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="497fc8d6-aa53-42cf-95c8-7d45bf817c4f" class="code"><code class="language-Bash">&lt;group name=&quot;docker-log-rule,&quot;&gt;
  &lt;rule id=&quot;100009&quot; level=&quot;5&quot;&gt;
    &lt;field name=&quot;web_action&quot;&gt;&quot;GET / HTTP/1.1&quot; 200&lt;/field&gt;
    &lt;description&gt;Docker Container: Successful Web GET request on Container: $(program_name) from $(srcip)&lt;/description&gt; &lt;mitre&gt;
      &lt;id&gt;T1016.001&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;docker-log-rule,&lt;/group&gt;
  &lt;/rule&gt;
&lt;/group&gt;</code></pre><figure id="ceab3c97-4b16-43bc-98e3-3b74e86ad11c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2079.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2079.png"/></a></figure><p id="2e79bfec-cbc9-4de9-9bc1-70b340e5f756" class=""><strong>Restart the Wazuh manager for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c3747157-2830-4738-a9b9-b3252a66d736" class="code"><code class="language-Bash">systemctl restart wazuh-manager</code></pre><figure id="8e4216f8-56ec-4b79-b9a4-84e2c760fe96" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2080.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2080.png"/></a></figure><p id="1ddd53aa-85b4-4c87-8d59-3976b5d2ec4a" class="">To trigger alerts for the rule that was created, do a curl request or browse to the web server container <strong>IP</strong> address. In the security events tab of the <strong>Wazuh Dashboard</strong>, we can see an example of a successful <strong>GET</strong> request alert.</p><figure id="7a2e6363-fae3-4cbe-b65b-c82093ba48a8" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2081.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2081.png"/></a></figure><figure id="6b8b7945-3aba-4997-8954-8f29b596bc1f" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2082.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2082.png"/></a></figure><hr id="f929317d-15d9-47ea-94c0-9c898dc69232"/><h1 id="4d0cf263-92d3-4acc-bd15-38f5d60461d1" class="">3. Configuring Vulnerable Application</h1><p id="b35d4d52-3bf8-4e24-b64a-22c8b561e529" class="">In the previous steps, we configured <strong>Wazuh</strong> to collect logs and events from <strong>Docker</strong> and its containers. However, if our application is not generating <strong>logs</strong> properly, we need to establish robust logging logic within the application itself. Additionally, we must ensure these logs are correctly monitored by the <strong>Wazuh agent</strong>.</p><figure id="26af05ea-df21-4643-9dcd-6e794ab66536" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2083.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2083.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2e003ae8-064d-47f9-a314-65f0f6f1d235" class="code"><code class="language-PHP">&lt;?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that gets used when writing
    | messages to the logs. The name specified in this option should match
    | one of the channels defined in the &quot;channels&quot; configuration array.
    |
    */

    &#x27;default&#x27; =&gt; env(&#x27;LOG_CHANNEL&#x27;, &#x27;stack&#x27;),

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Out of
    | the box, Laravel uses the Monolog PHP logging library. This gives
    | you a variety of powerful log handlers / formatters to utilize.
    |
    | Available Drivers: &quot;single&quot;, &quot;daily&quot;, &quot;slack&quot;, &quot;syslog&quot;,
    |                    &quot;errorlog&quot;, &quot;monolog&quot;,
    |                    &quot;custom&quot;, &quot;stack&quot;
    |
    */

    &#x27;channels&#x27; =&gt; [
        &#x27;stack&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;stack&#x27;,
            &#x27;channels&#x27; =&gt; [&#x27;single&#x27;],
            &#x27;ignore_exceptions&#x27; =&gt; false,
        ],

        &#x27;single&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;single&#x27;,
            &#x27;path&#x27; =&gt; storage_path(&#x27;logs/laravel.log&#x27;),
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
        ],

        &#x27;daily&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;daily&#x27;,
            &#x27;path&#x27; =&gt; storage_path(&#x27;logs/laravel.log&#x27;),
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
            &#x27;days&#x27; =&gt; 14,
        ],

        &#x27;slack&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;slack&#x27;,
            &#x27;url&#x27; =&gt; env(&#x27;LOG_SLACK_WEBHOOK_URL&#x27;),
            &#x27;username&#x27; =&gt; &#x27;Laravel Log&#x27;,
            &#x27;emoji&#x27; =&gt; &#x27;:boom:&#x27;,
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;critical&#x27;),
        ],

        &#x27;papertrail&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;monolog&#x27;,
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
            &#x27;handler&#x27; =&gt; SyslogUdpHandler::class,
            &#x27;handler_with&#x27; =&gt; [
                &#x27;host&#x27; =&gt; env(&#x27;PAPERTRAIL_URL&#x27;),
                &#x27;port&#x27; =&gt; env(&#x27;PAPERTRAIL_PORT&#x27;),
            ],
        ],

        &#x27;stderr&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;monolog&#x27;,
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
            &#x27;handler&#x27; =&gt; StreamHandler::class,
            &#x27;formatter&#x27; =&gt; env(&#x27;LOG_STDERR_FORMATTER&#x27;),
            &#x27;with&#x27; =&gt; [
                &#x27;stream&#x27; =&gt; &#x27;php://stderr&#x27;,
            ],
        ],

        &#x27;syslog&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;syslog&#x27;,
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
        ],

        &#x27;errorlog&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;errorlog&#x27;,
            &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
        ],

        &#x27;null&#x27; =&gt; [
            &#x27;driver&#x27; =&gt; &#x27;monolog&#x27;,
            &#x27;handler&#x27; =&gt; NullHandler::class,
        ],

        &#x27;emergency&#x27; =&gt; [
            &#x27;path&#x27; =&gt; storage_path(&#x27;logs/laravel.log&#x27;),
        ],
    ],

];</code></pre><p id="8963c88b-b739-4607-a9d4-5fa18e8e78de" class="">To configure our <strong>Laravel</strong> application to log events in <strong>JSON</strong> format, we can create a new logging channel in your <code>logging.php</code> configuration file. This will allow you to log messages in a structured format, making it easier to parse and analyze logs later, especially when integrating with log monitoring tools like <strong>Wazuh</strong>.</p><ol type="1" id="4b603ef2-2d01-4ae5-aca7-92946fcdec16" class="numbered-list" start="1"><li><strong>Add JSON Log Channel:</strong><ul id="4b782296-745f-4c19-838b-56e9a75dca4d" class="bulleted-list"><li style="list-style-type:disc">Edit the <code>logging.php</code> configuration file to include a new <strong>JSON</strong> channel. This channel will format logs in <strong>JSON</strong>, which is easier to decode and process.</li></ul><ul id="074f200f-d7ee-4666-b64d-360858b77229" class="bulleted-list"><li style="list-style-type:disc">Add the following code snippet to the <code>channels</code> array:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f3757203-e06b-4f07-a81a-4b4a86bfa323" class="code"><code class="language-PHP">&#x27;json&#x27; =&gt; [
    &#x27;driver&#x27; =&gt; &#x27;single&#x27;,
    &#x27;path&#x27; =&gt; storage_path(&#x27;logs/laravel.log&#x27;),
    &#x27;level&#x27; =&gt; env(&#x27;LOG_LEVEL&#x27;, &#x27;debug&#x27;),
],
</code></pre><figure id="5a5e0277-a7b5-4593-9aea-bce5bad196b3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2084.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2084.png"/></a></figure></li></ul></li></ol><ol type="1" id="3b7d18ea-4f66-45b1-b2b3-ad2db7c88635" class="numbered-list" start="2"><li><strong>Set Default Log Channel to JSON:</strong><ul id="254e011e-58b6-40ba-8044-51b8867b2e2f" class="bulleted-list"><li style="list-style-type:disc">Update the <code>default</code> log channel to use the new <code>json</code> channel:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="220a209e-2abb-456e-89d9-50457722be74" class="code"><code class="language-PHP">&#x27;default&#x27; =&gt; env(&#x27;LOG_CHANNEL&#x27;, &#x27;json&#x27;),
</code></pre><figure id="b7321a17-d4d6-4b87-9b06-055b19f7af53" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2085.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2085.png"/></a></figure></li></ul></li></ol><p id="5f4e8acf-cc0c-4799-afee-9fed5921758b" class="">In a <em>web application</em>, especially one built with frameworks like <strong>Laravel</strong>, implementing proper <strong>middleware</strong> for handling <strong>HTTP</strong> <em>requests</em> and <em>responses</em> is crucial. <strong>Middleware</strong> allows you to filter and handle requests entering your application, providing a way to add functionality such as <em>logging</em>, <em>authentication</em>, and <em>response</em> formatting.</p><ol type="1" id="45d74aa3-f1b5-4c42-a66a-7fb910272ba2" class="numbered-list" start="1"><li><strong>Generate Middleware:</strong><ul id="92505050-5840-4fb1-9433-870977a76895" class="bulleted-list"><li style="list-style-type:disc">Use the <code>Artisan</code> command to create new <strong>middleware</strong> for <strong>logging HTTP </strong><em>requests</em> and <em>responses</em>.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="52adc31e-0810-4832-8a45-265d2f0647ce" class="code"><code class="language-Bash">php artisan make:middleware LogHttpRequestResponse</code></pre><figure id="7e75d34c-b64a-421e-94f8-9c9faa1a62da" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2086.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2086.png"/></a></figure></li></ul></li></ol><ol type="1" id="2bf4f7f9-209e-4fbf-9831-cb8b698bbbf7" class="numbered-list" start="2"><li><strong>Implement Middleware Logic:</strong><ul id="7a6ac460-124c-4671-8f67-003bde585dde" class="bulleted-list"><li style="list-style-type:disc">Edit the newly created <strong>middleware</strong> file located at <code>app/Http/Middleware/LogHttpRequestResponse.php</code> to include logging logic.</li></ul><ul id="cc57db76-4771-4fdb-bd86-1006773f5b99" class="bulleted-list"><li style="list-style-type:disc">But you can&#x27;t do anything inside the container because you don&#x27;t have a <em>text editor</em>, but you do have the volume <code>/vapi</code> folder, which will be mounted inside your container, and any changes to this folder on your host will effect the corresponding container. So you may go to the <code>/vapi</code> folder on your host and edit this file.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="77e02769-e46e-4e08-b87d-7a224425740d" class="code"><code class="language-PHP">&lt;?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Log;

class LogRequestsAndResponses
{
    public function handle($request, Closure $next)
    {
        // Log request details
        Log::channel(&#x27;json&#x27;)-&gt;info(&#x27;Request:&#x27;, [
            &#x27;method&#x27; =&gt; $request-&gt;getMethod(),
            &#x27;url&#x27; =&gt; $request-&gt;fullUrl(),
            &#x27;headers&#x27; =&gt; $request-&gt;headers-&gt;all(),
            &#x27;body&#x27; =&gt; $request-&gt;all()
        ]);

        // Get the response
        $response = $next($request);

        // Log response details
        Log::channel(&#x27;json&#x27;)-&gt;info(&#x27;Response:&#x27;, [
            &#x27;status&#x27; =&gt; $response-&gt;status(),
            &#x27;headers&#x27; =&gt; $response-&gt;headers-&gt;all(),
            &#x27;body&#x27; =&gt; $response-&gt;getContent()
        ]);

        return $response;
    }
}
</code></pre><figure id="746a31c3-e92c-4f37-bf60-ba3d5ce69e3d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2087.png"><img style="width:624px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2087.png"/></a></figure></li></ul></li></ol><ol type="1" id="a5be7021-efb2-423a-b836-22c98eaa4264" class="numbered-list" start="3"><li><strong>Update Kernel.php</strong><ul id="d4d0a2bc-399c-485f-a92a-e66750046a62" class="bulleted-list"><li style="list-style-type:disc">We should also update <code>Kernel.php</code> file in order to include our class</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c0668cab-2210-4139-bdcd-8e5e6e67877d" class="code"><code class="language-PHP">\App\Http\Middleware\LogHttpRequestResponse::class</code></pre><figure id="e5d070af-6879-4e2c-91a7-cbe0103c18e3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2088.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2088.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="1742beba-eb4e-457f-bb07-9171bd392398"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">You should rebuild your docker-compose images: <code>docker compose up --build -d</code></div></figure></li></ol><ol type="1" id="c2608f3d-4a1d-465a-809f-b124c382fcd3" class="numbered-list" start="4"><li><strong>Test the Application</strong><ul id="3814515c-77b3-4f69-bdd1-5ddb7b5452f4" class="bulleted-list"><li style="list-style-type:disc">Make an <strong>HTTP</strong> request to your application and check the logs (usually located in <code>storage/logs/laravel.log</code>) to see if the request and response details are being logged as expected.<figure id="bcfec756-7e30-4b6e-82c4-f541808ddded" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2089.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2089.png"/></a></figure><figure id="b3262297-cb7f-44da-968a-86af3d78541c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2090.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2090.png"/></a></figure></li></ul><ol type="1" id="d78507c1-e5eb-4e3e-88b3-6752a909f7bd" class="numbered-list" start="5"><li><strong>Add a Localfile Entry for the Laravel Log</strong>:<ul id="c11c2d28-3bb8-42c0-b299-3edf3ef40381" class="bulleted-list"><li style="list-style-type:disc">You need to add a <code>&lt;localfile&gt;</code> entry to monitor the log file generated by your <strong>Laravel</strong> application. Assuming your <strong>Laravel</strong> logs are stored in <code>storage/logs/laravel.log</code>, you would add the following configuration:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="63f2682c-510f-4bc7-94db-9b9c6f3e97f7" class="code"><code class="language-Bash">&lt;localfile&gt;
    &lt;log_format&gt;plain&lt;/log_format&gt;
    &lt;location&gt;/path/to/your/vapi/storage/logs/laravel.log&lt;/location&gt;
&lt;/localfile&gt;</code></pre><figure id="46be11dd-6e33-429b-bb2f-c3620623f4cb" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2091.png"><img style="width:624px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2091.png"/></a></figure></li></ul><ul id="d7f82f9b-bfdf-4573-852d-550b4811dec3" class="bulleted-list"><li style="list-style-type:disc">Replace <code>/path/to/your/vapi/storage/logs/laravel.log</code> with the actual path to the log file on the host. If the <code>vapi</code> folder is mounted inside the container, ensure you specify the correct path.</li></ul></li></ol><ol type="1" id="af84698d-7fb1-4d82-b83f-18f67fe68e01" class="numbered-list" start="3"><li><strong>Save the Configuration File</strong>:<ul id="c00dadc5-ba73-463d-9034-93829f195acf" class="bulleted-list"><li style="list-style-type:disc">After adding the <code>&lt;localfile&gt;</code> entry, save the changes and exit the text editor.</li></ul></li></ol><ol type="1" id="f6418034-4908-44d7-9756-5bd0b6b519e1" class="numbered-list" start="7"><li><strong>Restart the Wazuh Agent</strong>:<ul id="6c6c14c6-ed3d-4ae2-aefe-9401cf19580d" class="bulleted-list"><li style="list-style-type:disc">For the changes to take effect, restart the <strong>Wazuh agent</strong> service. You can do this with the following command:</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a1100ddb-bb09-4edb-aa62-b69837e4d8e2" class="code"><code class="language-Bash">sudo systemctl restart wazuh-agent</code></pre><figure id="ef6d216e-0bfd-4f1f-81cc-625a7c3d4582" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2092.png"><img style="width:652px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2092.png"/></a></figure></li></ol><hr id="f8121332-1fb7-4d61-99f1-1f469fde7ee3"/></li></ol><h1 id="1e12d379-f9ea-43d7-aa49-9b167f3c863d" class="">4 Detecting Attacks on Endpoints</h1><p id="3385c69d-27ef-4a84-a08c-525d504cacd1" class="">In this section, we will focus on detecting attacks on our application&#x27;s endpoints. We will write custom decoders and rules in <strong>Wazuh</strong> to identify suspicious activities or attacks, and test these configurations to ensure they work effectively.</p><p id="60562dc2-b1cc-4890-9ccc-23c977c50c57" class=""><strong>Identifying Attacks</strong></p><p id="d712bf4c-c5e9-442d-b926-89021f2c9135" class="">To detect attacks, we first need to identify what kind of attacks we&#x27;re looking for. Common types of attacks on web applications include:</p><ul id="d47da3bc-5428-4e40-bf03-6cc2b4a42e61" class="bulleted-list"><li style="list-style-type:disc"><code>SQL Injection</code></li></ul><ul id="681eb881-37b8-4a4a-abe8-f50d73a8ea43" class="bulleted-list"><li style="list-style-type:disc"><code>Cross-Site Scripting (XSS)</code></li></ul><ul id="c93535d6-3ecc-48c8-998d-df42ea3307f8" class="bulleted-list"><li style="list-style-type:disc"><code>Command Injection</code></li></ul><ul id="777dd2cf-8ae2-4350-9953-879070f9ca7d" class="bulleted-list"><li style="list-style-type:disc"><code>Directory Traversal</code></li></ul><ul id="a5a0a407-6882-49e0-aab1-a6e94ae0d391" class="bulleted-list"><li style="list-style-type:disc"><code>Brute Force Attacks</code> </li></ul><p id="b0085b6e-3294-4756-81d9-892396da8c24" class=""><strong>Decoders</strong></p><p id="5bfd820a-20d9-4130-97b5-6f50ed462413" class="">First, let&#x27;s define the <strong>decoders</strong> that will <em>parse</em> and <em>analyze</em> the logs from our <strong>Laravel</strong> application. These decoders will help extract relevant information from <strong>JSON logs</strong> and identify potential <em>unauthorized</em> access attempts.</p><p id="2e69df22-32d4-4b3c-9303-6d4dc659227a" class=""><strong>1. Parent Decoder</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1ef67643-3e95-40d2-87bf-9d1fc6f8ffd2" class="code"><code class="language-XML">&lt;!-- Parent Decoder --&gt;
&lt;decoder name=&quot;laravel_logs_parent&quot;&gt;
    &lt;type&gt;syslog&lt;/type&gt;
    &lt;prematch type=&quot;pcre2&quot;&gt;local.INFO&lt;/prematch&gt;
&lt;/decoder&gt;</code></pre><ul id="e437b6b3-6008-49e3-9e68-7024bee1e237" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This parent <strong>decoder</strong> captures logs of type <code>syslog</code> with a severity level of <code>INFO</code>. It serves as the foundation for all child decoders.</li></ul></div></p><p id="9db8e719-c763-4463-93a9-6967f4f19730" class=""><strong>2. Child Decoder for JSON Requests/Responses</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a68b64ec-aef3-4ab0-b7c0-7898c15d2fcc" class="code"><code class="language-XML">&lt;!-- Child Decoder: Use JSON Decoder Plugin --&gt;
&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;prematch type=&quot;pcre2&quot;&gt;(Request|Response): &lt;/prematch&gt;
    &lt;plugin_decoder offset=&quot;after_prematch&quot;&gt;JSON_Decoder&lt;/plugin_decoder&gt;
&lt;/decoder&gt;</code></pre><ul id="94f4e856-f312-47a2-9903-42a6c4a9b9ec" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This decoder identifies log entries that contain either a request or a response. It<br/>uses a <br/><strong>JSON</strong> decoder plugin to parse the <strong>JSON</strong> content following the <code>Request</code> or <code>Response</code> label.</li></ul></div></p><p id="86e67ae8-baa7-486b-bc9c-dc288aea918c" class=""><strong>3. Child Decoder to Identify Request or Response</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="513df5b8-f1f2-4983-9475-041bed6a76b0" class="code"><code class="language-XML">&lt;!-- Child Decoder: Identify Request or Response --&gt;
&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;(Request|Response): &lt;/regex&gt;
    &lt;order&gt;response_or_request&lt;/order&gt;
&lt;/decoder&gt;</code></pre><ul id="c29b8acd-eda6-414c-935b-4fe3ffd52eeb" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This decoder further categorizes logs as either requests or responses using a regex match.</li></ul></div></p><p id="06f67fad-f61a-4b75-8a86-bc931ec3c258" class=""><strong>4. Child Decoder to Extract Body</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="95f4779b-306d-4191-9638-7bd9c3f4d346" class="code"><code class="language-XML">&lt;decoder name=&quot;laravel_logs_child_body&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;&quot;body&quot;:\{([^}]+)\}&lt;/regex&gt;
    &lt;order&gt;full_body&lt;/order&gt;
&lt;/decoder&gt;
</code></pre><ul id="93fd425a-4526-4eca-8273-2fbfe0d40cdb" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This decoder extracts the <code>body</code> of the JSON request or response. It captures everything within the <code>body</code> object, which is crucial for analyzing the data being sent or received.</li></ul></div></p><p id="304872d6-e67e-4c24-9184-c0321d3e8b9a" class=""><strong>5. Unauthorized Field Decoder</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c361da84-370f-4e59-9999-a04ed86c7983" class="code"><code class="language-XML">&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;\&quot;(?!username|name|course|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/regex&gt;
    &lt;order&gt;unauthorized_field&lt;/order&gt;
&lt;/decoder&gt;</code></pre><ul id="233a316c-d878-45f5-9766-9034ef6fb21b" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This decoder identifies any fields in the <strong>JSON</strong> body that are not allowed (i.e., fields other than <code>username</code>, <code>name</code>, <code>course</code>, and <code>password</code>). This is particularly useful for detecting <em>unauthorized access</em> or modifications to user data.</li></ul></div></p><p id="86868930-d6c4-4cd1-9f9e-e099322a9c9a" class="">Here is the full view of decoders:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="331c73de-3b20-4bd3-99e6-b89030791a46" class="code"><code class="language-XML">&lt;!-- Parent Decoder --&gt;
&lt;decoder name=&quot;laravel_logs_parent&quot;&gt;
    &lt;type&gt;syslog&lt;/type&gt;
    &lt;prematch type=&quot;pcre2&quot;&gt;local.INFO&lt;/prematch&gt;
&lt;/decoder&gt;

&lt;!-- Child Decoder: Use JSON Decoder Plugin --&gt;
&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;prematch type=&quot;pcre2&quot;&gt;(Request|Response): &lt;/prematch&gt;
    &lt;plugin_decoder offset=&quot;after_prematch&quot;&gt;JSON_Decoder&lt;/plugin_decoder&gt;
&lt;/decoder&gt;

&lt;!-- Child Decoder: Identify Request or Response --&gt;
&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;(Request|Response): &lt;/regex&gt;
    &lt;order&gt;response_or_request&lt;/order&gt;
&lt;/decoder&gt;

&lt;!-- Child Decoder: Extract &#x27;body&#x27; --&gt;
&lt;decoder name=&quot;laravel_logs_child_body&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;&quot;body&quot;:\{([^}]+)\}&lt;/regex&gt;
    &lt;order&gt;full_body&lt;/order&gt;
&lt;/decoder&gt;

&lt;!-- Unauthorized Field Decoder --&gt;
&lt;decoder name=&quot;laravel_logs_child_json&quot;&gt;
    &lt;parent&gt;laravel_logs_parent&lt;/parent&gt;
    &lt;regex type=&quot;pcre2&quot;&gt;\&quot;(?!username|name|course|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/regex&gt;
    &lt;order&gt;unauthorized_field&lt;/order&gt;
&lt;/decoder&gt;</code></pre><p id="954118be-5078-42a0-a2e5-b32099e17119" class="">To effectively <em>monitor</em> and <em>detect</em> events on the user endpoint, we can classify and assign appropriate <strong>rule levels</strong> based on the severity and nature of the events. Here is the strategic approach:</p><ol type="1" id="abdc8934-a6d0-49c6-ac2e-3e8842d80d21" class="numbered-list" start="1"><li><strong>Successful Events:</strong><ul id="0bbdd496-cbcb-43a0-bff2-e7496780f567" class="bulleted-list"><li style="list-style-type:disc"><strong>Rule Level:</strong> 3-4</li></ul><ul id="3841848c-eea4-4f92-99f9-55893d23a508" class="bulleted-list"><li style="list-style-type:disc"><strong>Description:</strong> These events indicate successful operations such as user creation, retrieval, and updates without any anomalies.</li></ul><ul id="1f889c89-e8dc-4a59-a723-0c8e7b3ea1f7" class="bulleted-list"><li style="list-style-type:disc"><strong>Example:</strong> A successful <code>POST</code> request to create a user or a successful <code>GET</code> request to retrieve user information.</li></ul></li></ol><ol type="1" id="a286daef-f7e8-427c-afec-85ad25287b39" class="numbered-list" start="2"><li><strong>Unauthorized Field Access:</strong><ul id="86350ef5-f95e-4f1c-9f7f-16a3e17a27c4" class="bulleted-list"><li style="list-style-type:disc"><strong>Rule Level:</strong> 6-8</li></ul><ul id="10bc60f7-186c-46d5-a133-9119520b1383" class="bulleted-list"><li style="list-style-type:disc"><strong>Description:</strong> These events indicate attempts to access fields that are not <code>authorized</code>. This could be a sign of a potential attack or misconfiguration.</li></ul><ul id="e2c894c6-1897-4bd4-adb2-a3051fcc1fe1" class="bulleted-list"><li style="list-style-type:disc"><strong>Example:</strong> An attempt to include <em>unauthorized fields</em> in the request body during a <code>POST</code> or <code>PUT</code> request.</li></ul></li></ol><ol type="1" id="5f5a0031-8255-4bdd-99e2-68ba165255a6" class="numbered-list" start="3"><li><strong>Failure Events:</strong><ul id="e0224381-e74b-4ada-9e85-85bec3156152" class="bulleted-list"><li style="list-style-type:disc"><strong>Rule Level:</strong> 7-9</li></ul><ul id="c1f7066a-8f95-43ee-94fd-3979c8c220d8" class="bulleted-list"><li style="list-style-type:disc"><strong>Description:</strong> These events indicate failed operations which could be due to <em>incorrect inputs</em>, <em>invalid authentication tokens</em>, or other reasons that might not be immediately critical but need attention.</li></ul><ul id="f45a0a23-6152-4146-a157-43bd0e21e137" class="bulleted-list"><li style="list-style-type:disc"><strong>Example:</strong> A failed login attempt or an invalid request to update user information.</li></ul></li></ol><ol type="1" id="8456d773-430b-44c5-b796-f8af336cf685" class="numbered-list" start="4"><li><strong>Brute-Force Attacks:</strong><ul id="1067665b-0009-4d5a-8b49-0b92220011ca" class="bulleted-list"><li style="list-style-type:disc"><strong>Rule Level:</strong> 10</li></ul><ul id="f0949394-3f6b-4f52-88a8-b1ded28a5be9" class="bulleted-list"><li style="list-style-type:disc"><strong>Description:</strong> These events indicate repeated failed attempts to perform operations, which could be a sign of a <code>brute-force</code> attack.</li></ul><ul id="e8d37c67-0f90-4d7b-b6a8-b4ad95d651b4" class="bulleted-list"><li style="list-style-type:disc"><strong>Example:</strong> Multiple failed login attempts within a short timeframe.</li></ul></li></ol><p id="2e3ce601-ac26-4237-9157-1da2aa258b1f" class="">This strategic approach ensures comprehensive security monitoring and timely alerts, enhancing the security posture of your application.</p><hr id="c2ba06ef-19b0-486d-be84-a2427fe43fd6"/><h2 id="98507bd3-a2f7-4e20-b90f-508cf6a5154c" class="">4.1 <strong> Broken Object-Level Authorization (BOLA)</strong></h2><p id="95c32d41-f59d-44fd-86b6-0f5002a0d60b" class="">When dealing with <strong>Broken Object-Level Authorization (BOLA)</strong> vulnerabilities, it is crucial to have a robust <em>logging</em> and <em>decoding</em> mechanism in place. This ensures that you can effectively monitor and <em>analyze requests</em> to your application’s endpoints.</p><figure id="3e1978b7-9337-4257-8a93-2c7c21d4fe58" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2093.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2093.png"/></a></figure><p id="8a01f012-533c-43ac-a3bc-d7b7e85e0017" class=""><strong> Overview of Endpoints</strong>:<div class="indented"><ul id="eafd3789-8107-48a2-bd57-5a6faf5154bb" class="bulleted-list"><li style="list-style-type:disc"><strong>POST</strong>: <em>Create User</em> <code>http://{{host}}/vapi/api1/user</code></li></ul><ul id="60f7c83f-0b62-48c0-abde-f970a9504a75" class="bulleted-list"><li style="list-style-type:disc"><strong>GET</strong>: <em>Get User</em> <code>http://{{host}}/vapi/api1/user/{api1_id}</code></li></ul><ul id="48d00aa4-852e-4694-b132-c339569c1a19" class="bulleted-list"><li style="list-style-type:disc"><strong>PUT</strong>: <em>Update User</em> <code>http://{{host}}/vapi/api1/user/{api1_id}</code></li></ul></div></p><p id="e3b1bd6f-ee1a-419d-842f-09265ea28850" class="">To effectively <strong>monitor</strong> and <strong>detect</strong> various events for the user endpoint in our application, we will implement specific detection <strong>rules</strong> in <strong>Wazuh</strong>. These rules will cover successful events, unauthorized field access, failure events, and brute-force attacks.</p><p id="c6061ae3-412a-41e6-989c-28ccae1ed7b5" class=""><strong>1. Successful Events</strong></p><p id="3b9e0058-74ad-4e82-ac22-4306fecb8be1" class="">These rules capture successful operations such as user creation, retrieval, and updates.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="51646f63-4dd8-4eaf-8748-9d523af11a8d" class="code"><code class="language-XML">&lt;rule id=&quot;100002&quot; level=&quot;3&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;username&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;name&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;course&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;id&lt;/field&gt;
  &lt;status&gt;201&lt;/status&gt;
  &lt;description&gt;User was successfully created ! &lt;/description&gt;
  &lt;/rule&gt;
  
&lt;rule id=&quot;100014&quot; level=&quot;6&quot;&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;id&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;username&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;name&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;course&lt;/field&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;200&lt;/status&gt;
  &lt;description&gt;User was successfully updated ! &lt;/description&gt;
&lt;/rule&gt;

&lt;rule id=&quot;100007&quot; level=&quot;3&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;GET&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;\Wvapi\Wapi1\Wuser\W\d+&lt;/url&gt;
  &lt;description&gt;Getting access to user information id:$(url) &lt;/description&gt;
&lt;/rule&gt;</code></pre><p id="2de9d0c2-d7cb-4547-a731-d94e2fd7a9f8" class=""><strong>2. Unauthorized Field Access</strong></p><p id="d265ecac-cf1d-458a-bfa1-7e60d35dcef3" class="">These rules capture attempts to access fields that are not authorized, indicating potential security issues.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0c2c9cea-1fde-4ab2-bba8-f6aa2f2bdfe3" class="code"><code class="language-XML">&lt;rule id=&quot;100006&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;POST&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api1/user&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\&quot;(?!username|name|course|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;

&lt;rule id=&quot;100011&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;GET&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api1/user&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\w+&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;

&lt;rule id=&quot;100012&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;PUT&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api1/user&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\&quot;(?!username|name|course|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><p id="c578302a-4854-4f5b-9be1-67451da9a4a5" class=""><strong>3. Failure Events</strong></p><p id="4a39729c-c8eb-44d5-95a9-08bf54ccbcf4" class="">These rules capture failed operations, which could indicate incorrect inputs or other issues.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b4e59223-a8d6-478c-b5fc-de52752d40ee" class="code"><code class="language-XML">&lt;rule id=&quot;100003&quot; level=&quot;6&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;Duplicate&lt;/field&gt;
  &lt;status&gt;500&lt;/status&gt;
  &lt;description&gt;Duplicate entry for username !!! &lt;/description&gt;
&lt;/rule&gt;

&lt;rule id=&quot;100004&quot; level=&quot;4&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;500&lt;/status&gt;
  &lt;description&gt;Empty Request !!! &lt;/description&gt;
&lt;/rule&gt;

&lt;rule id=&quot;100008&quot; level=&quot;6&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;usernameOrPasswordIncorrect&lt;/field&gt;
  &lt;status&gt;403&lt;/status&gt;
  &lt;description&gt;Username Or Password Incorrect !!! &lt;/description&gt;
&lt;/rule&gt;</code></pre><p id="c4a56763-e520-4e2e-9660-2398e2cf382c" class=""><strong>4. Brute-Force Attacks</strong></p><p id="bc0ee372-71f6-44bf-9a4e-28e726469fba" class="">These rules capture repeated failed attempts to perform operations, indicating potential brute-force attacks.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9f2c1c20-f901-4f97-b63b-544007f823f2" class="code"><code class="language-XML">
&lt;rule id=&quot;100010&quot; level=&quot;10&quot; frequency=&quot;4&quot; timeframe=&quot;300&quot;&gt;
  &lt;if_matched_sid&gt;100008&lt;/if_matched_sid&gt;
  &lt;same_status/&gt;
  &lt;description&gt;Potential Brute-Force Attack!!!&lt;/description&gt;
&lt;/rule&gt;</code></pre><p id="bebc0771-bf8c-4fab-beb3-c4a714e5600c" class="">To ensure the effectiveness of your custom detection rules, it&#x27;s essential to test them thoroughly. You can use both real-world requests via <strong>cURL</strong> and the <strong>Wazuh-Logtest</strong> tool to validate the rules and analyze the generated logs.<br/><br/><strong>1. Successful User Creation:</strong><br/>Here is the <br/><strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="afdd7fae-68a3-44d0-a8a7-63cd49b5429d" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api1/user&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--header &#x27;Accept: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;: &quot;Anthony&quot;,
    &quot;name&quot;: &quot;Jones&quot;,
    &quot;course&quot;: &quot;3&quot;,
    &quot;password&quot;: &quot;21)(*)(8231&quot;
}&#x27;</code></pre><figure id="98f1e18d-6388-4304-b367-b21a463d67c1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2094.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2094.png"/></a></figure><p id="2e62b81a-8158-4fb7-89bd-35d1dbcd065e" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3cd67570-faa3-4443-82d5-8c8d3772eddf" class="code"><code class="language-Bash">[2024-07-20 13:24:27] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;}} 
[2024-07-20 13:24:28] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:24:28 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Anthony\&quot;,\&quot;name\&quot;:\&quot;Jones\&quot;,\&quot;course\&quot;:\&quot;3\&quot;,\&quot;id\&quot;:29}&quot;} </code></pre><figure id="ced690c8-0435-40f6-918a-ce66267d28e6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2095.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2095.png"/></a></figure><p id="40066d2d-68f6-4c89-91f3-e38d04383988" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="0a024159-9639-4760-b190-49f428b506dd" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2096.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2096.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9b036846-d77b-4f29-b68c-1d82cc22d77a" class="code"><code class="language-Bash">**Messages:
	INFO: (7202): Session initialized with token &#x27;55b68bdb&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:24:27] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.course: &#x27;3&#x27;
	body.name: &#x27;Jones&#x27;
	body.password: &#x27;21)(*)(8231&#x27;
	body.username: &#x27;Anthony&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;&#x27;
	headers.accept: &#x27;[&quot;application/json&quot;]&#x27;
	headers.content-length: &#x27;[&quot;100&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:24:28] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:24:28 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Anthony\&quot;,\&quot;name\&quot;:\&quot;Jones\&quot;,\&quot;course\&quot;:\&quot;3\&quot;,\&quot;id\&quot;:29}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;id&quot;:29}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sat, 20 Jul 2024 13:24:28 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;201&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100002&#x27;
	level: &#x27;3&#x27;
	description: &#x27;User was successfully created ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="87c48753-f6bd-46ef-aa23-38a3ef738456" class="">The log entries reflect a <strong>successful user creation process</strong>, where the application correctly identifies and <em>logs</em> the <em>request and response</em>. The detection rule (<code>ID 100002</code>) was successfully triggered, indicating that the system is effectively monitoring user management activities. This process is crucial for maintaining security and ensuring that user-related actions are logged and monitored for any potential issues.</p><hr id="048843c3-932f-4435-b00a-42443ce5f231"/><p id="98c0709a-5a49-4627-9d8f-22bd1b2c8554" class=""><strong>2. Duplicate User Entry:</strong></p><p id="71c2ee40-898b-45ba-9655-5d1a85a1e6e3" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e964d053-d9d6-4498-b06e-bdbe5fb3b5ca" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api1/user&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--header &#x27;Accept: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;: &quot;Anthony&quot;,
    &quot;name&quot;: &quot;Jones&quot;,
    &quot;course&quot;: &quot;3&quot;,
    &quot;password&quot;: &quot;21)(*)(8231&quot;
}&#x27;</code></pre><figure id="dd21090c-3fe9-4313-aa69-d55e317fca97" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2097.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2097.png"/></a></figure><p id="aee9a776-34c2-42bb-9525-30318c5a68aa" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f3bcf604-ce4d-4088-8894-c3e0480e0353" class="code"><code class="language-Bash">[2024-07-20 13:38:46] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;}} 
[2024-07-20 13:38:46] local.INFO: Response: {&quot;status&quot;:500,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:38:46 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;errorInfo\&quot;:[\&quot;23000\&quot;,1062,\&quot;Duplicate entry &#x27;Anthony&#x27; for key &#x27;a_p_i1_users.username&#x27;\&quot;]}&quot;} </code></pre><figure id="16b78e2a-4228-4d1c-b081-7ae05fa8ba36" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2098.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2098.png"/></a></figure><p id="508379f7-4b60-4343-984b-ea2e1e25fa1b" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="ce8888b1-41ff-49fd-9d82-7548dddfbabe" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2099.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%2099.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ada9c972-a9d9-4186-9a83-4d79444561c9" class="code"><code class="language-Bash">**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:38:46] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.course: &#x27;3&#x27;
	body.name: &#x27;Jones&#x27;
	body.password: &#x27;21)(*)(8231&#x27;
	body.username: &#x27;Anthony&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Anthony&quot;,&quot;name&quot;:&quot;Jones&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;&#x27;
	headers.accept: &#x27;[&quot;application/json&quot;]&#x27;
	headers.content-length: &#x27;[&quot;100&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:38:46] local.INFO: Response: {&quot;status&quot;:500,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:38:46 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;errorInfo\&quot;:[\&quot;23000\&quot;,1062,\&quot;Duplicate entry &#x27;Anthony&#x27; for key &#x27;a_p_i1_users.username&#x27;\&quot;]}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;errorInfo&quot;:[&quot;23000&quot;,1062,&quot;Duplicate entry &#x27;Anthony&#x27; for key &#x27;a_p_i1_users.username&#x27;&quot;]}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sat, 20 Jul 2024 13:38:46 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;500&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100003&#x27;
	level: &#x27;6&#x27;
	description: &#x27;Duplicate entry for username !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="b78e8c11-35a1-4973-9c42-1db1d3ce4216" class="">The log entries reflect an attempt to <strong>create a user</strong> that resulted in a <strong>duplicate entry error</strong>. The application correctly <em>identifies</em> and logs the <em>request</em> and <em>response</em>, and the <strong>detection rule</strong> (<code>ID 100003</code>) was successfully triggered, indicating that the system is effectively monitoring for duplicate user entries.</p><hr id="1a35490d-a0f3-4ea5-9feb-193b85fa045d"/><p id="a27087b3-c7eb-4528-a3aa-6ebdf4d196b0" class=""><strong>3. Unauthorized Fields in POST Request</strong>:</p><p id="7087d571-e85b-4b6d-a5ac-9aaf1ef3c9fe" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c65bad58-5d2e-47d8-bfe1-ce3d247e8a66" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api1/user&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--header &#x27;Accept: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;: &quot;Anthony&quot;,
    &quot;name&quot;: &quot;Jones&quot;,
    &quot;course&quot;: &quot;3&quot;,
    &quot;password&quot;: &quot;21)(*)(8231&quot;,
    &quot;age&quot;: &quot;23&quot;
}&#x27;</code></pre><figure id="5f72ebc9-88e5-43e3-93bf-d832bd53e56a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20100.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20100.png"/></a></figure><p id="02ac8144-89dd-44c8-b77b-409754bdff69" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b44630c1-8e7c-4e20-a442-b2e0c24860d7" class="code"><code class="language-Bash">[2024-07-20 13:48:16] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;115&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Kasty&quot;,&quot;name&quot;:&quot;Trick&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;,&quot;age&quot;:&quot;23&quot;}} 
[2024-07-20 13:48:16] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:48:16 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Kasty\&quot;,\&quot;name\&quot;:\&quot;Trick\&quot;,\&quot;course\&quot;:\&quot;3\&quot;,\&quot;id\&quot;:32}&quot;} </code></pre><figure id="b850e717-8e03-463e-aa1b-126f2c9bd2c5" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20101.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20101.png"/></a></figure><p id="cdcefec7-143e-420f-90d1-1e109093151f" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="b72c5ceb-a052-4b36-b156-bdf6f5219ebc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20102.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20102.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="08143c88-26ca-4016-839e-6c1e41e9ba78" class="code"><code class="language-Bash">**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:48:16] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;accept&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;115&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Kasty&quot;,&quot;name&quot;:&quot;Trick&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;,&quot;age&quot;:&quot;23&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.age: &#x27;23&#x27;
	body.course: &#x27;3&#x27;
	body.name: &#x27;Trick&#x27;
	body.password: &#x27;21)(*)(8231&#x27;
	body.username: &#x27;Kasty&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Kasty&quot;,&quot;name&quot;:&quot;Trick&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;21)(*)(8231&quot;,&quot;age&quot;:&quot;23&quot;&#x27;
	headers.accept: &#x27;[&quot;application/json&quot;]&#x27;
	headers.content-length: &#x27;[&quot;115&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100006&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in POST http://localhost/vapi/api1/user&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-20 13:48:16] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sat, 20 Jul 2024 13:48:16 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Kasty\&quot;,\&quot;name\&quot;:\&quot;Trick\&quot;,\&quot;course\&quot;:\&quot;3\&quot;,\&quot;id\&quot;:32}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;username&quot;:&quot;Kasty&quot;,&quot;name&quot;:&quot;Trick&quot;,&quot;course&quot;:&quot;3&quot;,&quot;id&quot;:32}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sat, 20 Jul 2024 13:48:16 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;201&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100002&#x27;
	level: &#x27;3&#x27;
	description: &#x27;User was successfully created ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;2&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="dd0ebd6a-d773-411b-bf1c-c4c438901835" class="">The log entries reflect an attempt to create a user that included an <strong>unauthorized field</strong> (<code>age</code>). The application correctly identifies and logs the request and response, and the detection rule (<strong>ID 100006</strong>) was successfully triggered, indicating that the system is effectively monitoring for unauthorized fields in <strong>POST</strong> requests to the <code>/vapi/api1/user</code> endpoint.</p><hr id="ccce3d31-cbc2-4fe5-af74-e29bdf987fdb"/><p id="9582e3d4-e208-4c85-9398-8c9f7d1f2d8b" class=""><strong>4. Accessing User Information</strong>:</p><p id="05a03c29-795e-4b18-92fd-432a246a9196" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8f24a285-3c4a-4459-a568-c0b2f7cb838c" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api1/user/1&#x27; \
--header &#x27;Authorization-Token: QW50aG9ueToyMSkoKikoODIzMQ==&#x27; \
--header &#x27;Content-Type: application/json&#x27;</code></pre><figure id="87a54db2-135c-4cf7-b7aa-4c0f8c5acbd6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20103.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20103.png"/></a></figure><p id="f434f744-1d8a-429b-ae24-defe83bb3067" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e6f65dbb-e920-4a37-ad20-bc5539c943d7" class="code"><code class="language-Bash">[2024-07-21 08:08:19] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:[]} 
[2024-07-21 08:08:19] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:08:19 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Antoshka\&quot;,\&quot;name\&quot;:\&quot;Cartoshka\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;}</code></pre><figure id="d6849948-c81e-4614-9d6f-6928663c91ad" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20104.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20104.png"/></a></figure><p id="bc5fd569-0260-48fa-a4ea-2e466653ed14" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="2114df4b-5e83-4b5f-a608-f9a03811430e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20105.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20105.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="69acc4df-341f-4cf3-bebd-cf083dae38bd" class="code"><code class="language-Bash">**Messages:
	INFO: (7202): Session initialized with token &#x27;4f1e2973&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:08:19] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user/1&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100007&#x27;
	level: &#x27;3&#x27;
	description: &#x27;Getting access to user information id:http://localhost/vapi/api1/user/1 &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:08:19] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:08:19 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Antoshka\&quot;,\&quot;name\&quot;:\&quot;Cartoshka\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;}&#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;id&quot;:1,&quot;username&quot;:&quot;Antoshka&quot;,&quot;name&quot;:&quot;Cartoshka&quot;,&quot;course&quot;:&quot;3&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 08:08:19 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100014&#x27;
	level: &#x27;6&#x27;
	description: &#x27;User was successfully updated ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="c7391ff2-3d40-4995-ba9a-c7a9525512cb" class="">The log entries reflect a successful retrieval of user information from the <strong>API</strong>. The application correctly identifies and logs both the <em>request</em> and <em>response</em>, and the <strong>detection rules</strong> (<code>IDs 100007</code> and <code>100014</code>) were successfully triggered.</p><ul id="2fbeec78-edeb-402d-a5e2-af721edd136d" class="bulleted-list"><li style="list-style-type:disc">The first rule (<code>ID 100007</code>) captures the <em>access to user information</em>, providing an informational alert about the request.</li></ul><ul id="3338cfbc-31c3-48c9-be68-1ee1ce23c352" class="bulleted-list"><li style="list-style-type:disc">The second rule (<code>ID 100014</code>) confirms that the user data was successfully retrieved, indicating that the application is functioning as intended.</li></ul><hr id="ac8784ef-f6fe-4f19-bc1c-ddbc886c54bc"/><p id="9c3af7a9-b737-4a54-ad3b-0650040289dd" class=""><strong>5. Incorrect Credentials</strong>:</p><p id="b769afe5-07c0-422f-93e4-8c10f95146df" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0bfd0f17-2f35-48ef-a6b6-a0ce51689fe8" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api1/user/1&#x27; \
--header &#x27;Authorization-Token: QW50aG9ueToyMSkoKikoODIzM1==&#x27; \
--header &#x27;Content-Type: application/json&#x27;</code></pre><figure id="c8566c50-300c-4899-a2f9-fed32cd09c66" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20106.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20106.png"/></a></figure><p id="2ca3aba5-45ac-4b43-8ee7-40f4d2647a9a" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5a9c8c33-530d-4f16-ab87-d67275ee52c6" class="code"><code class="language-Bash">[2024-07-21 08:18:34] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzM1==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:[]} 
[2024-07-21 08:18:34] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:18:34 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} </code></pre><figure id="fa6f3293-073b-46d9-babb-c4210e9eb069" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20107.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20107.png"/></a></figure><p id="8b192082-4854-47dc-b6dd-3b5f422c4a5b" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="78245f9e-5a72-4c35-98a1-b4ab9c5804bc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20108.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20108.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ad0a4daf-d5e2-4328-a342-8bd46419470b" class="code"><code class="language-Bash">**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:18:34] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzM1==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;QW50aG9ueToyMSkoKikoODIzM1==&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user/1&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100007&#x27;
	level: &#x27;3&#x27;
	description: &#x27;Getting access to user information id:http://localhost/vapi/api1/user/1 &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;2&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:18:34] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:18:34 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 08:18:34 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100008&#x27;
	level: &#x27;6&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="3a8eea90-0918-4766-8460-67c31ed27f26" class="">The log entries reflect an attempt to <em>access user information</em> that resulted in a forbidden response due to <em>incorrect authentication credentials</em>. The application correctly identifies and logs both the <br/><br/><em>request</em> and <em>response</em>, and the <strong>detection rules</strong> (IDs <code>100007</code> and <code>100008</code>) were successfully triggered.</p><ul id="2461a937-d18e-47a7-816e-e1169fdb4347" class="bulleted-list"><li style="list-style-type:disc">The first rule (<code>ID 100007</code>) captures the access <em>attempt to user information</em>, providing an informational alert about the request.</li></ul><ul id="72b75c65-d7fe-467f-aca3-dd8d195f2fa5" class="bulleted-list"><li style="list-style-type:disc">The second rule (<code>ID 100008</code>) confirms that the authentication attempt failed due to <em>incorrect credentials</em>, indicating a potential security concern.</li></ul><hr id="9e1d7ecb-36a0-47ce-a3b5-126db694db66"/><p id="306f86c3-3337-4a81-98dd-ed1502ef6030" class=""><strong>6. Unauthorized Fields in GET Request</strong>:</p><p id="fc2ba505-a5f8-472f-8471-5c1630818dd2" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="641485a0-8956-4f65-adf7-69358e7fd8e0" class="code"><code class="language-Bash">curl --location --request GET &#x27;http://localhost/vapi/api1/user/1&#x27; \
--header &#x27;Authorization-Token: QW50aG9ueToyMSkoKikoODIzMQ==&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;age&quot;:&quot;25&quot;
}&#x27;</code></pre><figure id="60471708-d718-4293-a317-a84895ff0988" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20109.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20109.png"/></a></figure><p id="749cf9f5-c6e2-4849-9ba5-04cc1197d456" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3a3296cd-830c-4673-8a63-fec1c604cd2f" class="code"><code class="language-Bash">[2024-07-21 08:26:39] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;18&quot;]},&quot;body&quot;:{&quot;age&quot;:&quot;25&quot;}} 
[2024-07-21 08:26:39] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:26:39 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Antoshka\&quot;,\&quot;name\&quot;:\&quot;Cartoshka\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;} </code></pre><figure id="7207b55f-24c9-4098-97fa-4eb85b85a1b1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20110.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20110.png"/></a></figure><p id="fa1cddee-667c-41a9-9625-fed7dd9c3697" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="92472d69-38e4-4185-9166-808856214455" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20111.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20111.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5934e1ea-8605-4754-b6a2-3f068c5d90a5" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;57f24385&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:26:39] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;18&quot;]},&quot;body&quot;:{&quot;age&quot;:&quot;25&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.age: &#x27;25&#x27;
	full_body: &#x27;&quot;age&quot;:&quot;25&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;]&#x27;
	headers.content-length: &#x27;[&quot;18&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user/1&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100011&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in GET http://localhost/vapi/api1/user/1&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:26:39] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:26:39 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Antoshka\&quot;,\&quot;name\&quot;:\&quot;Cartoshka\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;id&quot;:1,&quot;username&quot;:&quot;Antoshka&quot;,&quot;name&quot;:&quot;Cartoshka&quot;,&quot;course&quot;:&quot;3&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 08:26:39 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100014&#x27;
	level: &#x27;6&#x27;
	description: &#x27;User was successfully updated ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="ee8a00a2-7b8f-43e3-9abe-689270b2fe46" class="">The log entries reflect a <strong>GET</strong> request to <em>retrieve user information</em> that included an <strong>unauthorized field (age)</strong> in the <em>request body</em>. The application correctly identifies and logs both the <em>request</em> and <em>response</em>, and the <strong>detection rule</strong> (<code>ID 100011</code>) was successfully triggered.</p><ul id="636947f6-d3ce-411c-949e-e8024a745e3a" class="bulleted-list"><li style="list-style-type:disc">The first rule (<code>ID 100011</code>) captures the <em>unauthorized field</em> in the <strong>GET</strong> request, providing a high warning alert about the potential security concern.</li></ul><ul id="e29a2e25-ca1a-4a54-b89e-a2cb13e63c3a" class="bulleted-list"><li style="list-style-type:disc">The second rule (<code>ID 100014</code>) confirms that the user data was successfully retrieved, indicating that the application is functioning as intended.</li></ul><hr id="0a16e478-4304-4f75-a9d0-67f5e4034d34"/><p id="a3a63e89-ce52-4ee3-b0f0-41746c4576d1" class=""><strong>7. Unauthorized Fields in PUT Request</strong>:</p><p id="a5b20b23-1005-400d-9b55-6151ea3446e8" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="faef65ee-24e4-4a3a-a05a-8136ffd1ea9e" class="code"><code class="language-Bash">curl --location --request PUT &#x27;http://localhost/vapi/api1/user/1&#x27; \
--header &#x27;Authorization-Token: QW50aG9ueToyMSkoKikoODIzMQ==&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;:&quot;Bond&quot;,
    &quot;name&quot;:&quot;James&quot;,
    &quot;course&quot;:&quot;3&quot;,
    &quot;password&quot;:&quot;;aksd&quot;,
    &quot;age&quot;:&quot;25&quot;
}&#x27;</code></pre><figure id="2254bf4c-aed8-4f8e-875d-75141f4532c6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20112.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20112.png"/></a></figure><p id="2fe77f82-b964-450f-ab70-9e9dca72c6f3" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ddf57ef9-b282-48a6-9cdf-d2c452cfdbc9" class="code"><code class="language-Bash">[2024-07-21 08:37:41] local.INFO: Request: {&quot;method&quot;:&quot;PUT&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;103&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Bond&quot;,&quot;name&quot;:&quot;James&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;;aksd&quot;,&quot;age&quot;:&quot;25&quot;}} 
[2024-07-21 08:37:41] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:37:41 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Bond\&quot;,\&quot;name\&quot;:\&quot;James\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;} </code></pre><figure id="2e451147-1b2d-49ab-8d54-e35339e9b5db" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20113.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20113.png"/></a></figure><p id="e14caca3-685b-45af-a27f-4d1aeb8f140d" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="9d46c8dc-cbfa-4ca0-992b-b06844973f70" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20114.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20114.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7468ddfe-bb2e-49ce-ae5c-8985b12647a6" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;90144332&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:37:41] local.INFO: Request: {&quot;method&quot;:&quot;PUT&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api1/user/1&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;103&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Bond&quot;,&quot;name&quot;:&quot;James&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;;aksd&quot;,&quot;age&quot;:&quot;25&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.age: &#x27;25&#x27;
	body.course: &#x27;3&#x27;
	body.name: &#x27;James&#x27;
	body.password: &#x27;;aksd&#x27;
	body.username: &#x27;Bond&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Bond&quot;,&quot;name&quot;:&quot;James&quot;,&quot;course&quot;:&quot;3&quot;,&quot;password&quot;:&quot;;aksd&quot;,&quot;age&quot;:&quot;25&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;QW50aG9ueToyMSkoKikoODIzMQ==&quot;]&#x27;
	headers.content-length: &#x27;[&quot;103&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;PUT&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api1/user/1&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100012&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in PUT http://localhost/vapi/api1/user/1&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 08:37:41] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 08:37:41 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;Bond\&quot;,\&quot;name\&quot;:\&quot;James\&quot;,\&quot;course\&quot;:\&quot;3\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;id&quot;:1,&quot;username&quot;:&quot;Bond&quot;,&quot;name&quot;:&quot;James&quot;,&quot;course&quot;:&quot;3&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 08:37:41 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100014&#x27;
	level: &#x27;6&#x27;
	description: &#x27;User was successfully updated ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="a666dc10-ad9b-4f04-8e07-ba34267b9ff6" class="">The log entries reflect a <strong>PUT</strong><em> request</em> to <em>update user information</em> that included an <strong>unauthorized field (age)</strong> in the <em>request body</em>. The application correctly identifies and logs both the <em>request</em> and <em>response</em>, and the <strong>detection rule</strong> (<code>ID 100012</code>) was successfully triggered.</p><ul id="c6a263b0-d7b8-4eb9-9279-df030a563b7f" class="bulleted-list"><li style="list-style-type:disc">The first rule (<code>ID 100012</code>) captures the <strong>unauthorized field</strong> in the <strong>PUT</strong> request, providing a high warning alert about the potential security concern.</li></ul><ul id="5a004c1f-db13-40d9-bd74-fe27cdfc7b0c" class="bulleted-list"><li style="list-style-type:disc">The second rule (<code>ID 100014</code>) confirms that the user data was <em>successfully updated</em>, indicating that the application is functioning as intended despite the presence of the <em>unauthorized field</em>.</li></ul><hr id="547e3e6a-768e-4860-a875-c304efa45ff7"/><h2 id="0ff31457-4903-456a-95a0-30d89dbb8594" class="">4.2 <strong> Broken Authentication</strong></h2><p id="f340de57-0838-4f2c-97d7-de978769aab7" class=""><strong>Broken Authentication</strong> vulnerabilities occur when an application&#x27;s <em>authentication mechanism</em> is not properly implemented, allowing attackers to <strong>compromise authentication credentials</strong> or exploit <em>implementation flaws</em> to assume other users&#x27; identities. To detect such attacks, we need to monitor the <code>login</code> and <code>user details</code> endpoints.<br/><br/></p><figure id="30436201-f8ac-40e3-a952-92cb3e44ee4b" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20115.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20115.png"/></a></figure><p id="4cc2c988-fa71-42f4-bc60-59da0b8897ca" class=""><strong>Overview of Endpoints</strong></p><ol type="1" id="df81029d-73eb-491a-a898-fefb760edab1" class="numbered-list" start="1"><li><strong>User Login (POST) </strong><code>http://{{host}}/vapi/api2/user/login</code></li></ol><ol type="1" id="c6a12d23-1b58-4991-9319-35b5b795c475" class="numbered-list" start="2"><li><strong>Get User Details (GET) </strong><code>http://{{host}}/vapi/api2/user/details</code></li></ol><p id="0d43c1df-4919-42a9-9511-31cdbd05e44c" class="">Here are the <strong>rules</strong> designed to detect various scenarios on these endpoints:</p><p id="8b293642-c101-4874-b110-8828d2491a0b" class=""><strong>1. Successful Login</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e908a683-4688-44c5-b14d-b50ea365654a" class="code"><code class="language-XML">&lt;rule id=&quot;100015&quot; level=&quot;6&quot;&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;success&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;true&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;token&lt;/field&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;200&lt;/status&gt;
  &lt;description&gt;User was successfully logged in ! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="ec0b4b34-bdfc-4ed9-84ad-6307f66e898d" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: Detects successful user logins.</li></ul><ul id="d0529d8b-00af-4701-9763-bc816385329b" class="bulleted-list"><li style="list-style-type:disc"><strong>Level</strong>: 6 (Warning)</li></ul><ul id="42bfc9a2-c737-49e0-9ad4-585e19eb09fd" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: When a response indicates a successful login (<strong>HTTP status 200</strong>) and includes the words <code>success</code>, <code>true</code>, and <code>token</code> in the <em>response body</em>.</li></ul><hr id="2a57e255-0c8b-4ea0-b811-103b982b1998"/><p id="d4ece78e-3bc3-46b8-ae7e-5f37a1a02e94" class=""><strong> 2. Unauthorized Fields in Login Request</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="199d310e-d26c-48bc-85c0-c671a079f705" class="code"><code class="language-XML">&lt;rule id=&quot;100016&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;POST&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api2/user/login&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\&quot;(?!email|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="2082cf64-f4de-414f-88c1-0d39275974f3" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: Detects unauthorized fields in login requests.</li></ul><ul id="a05d672e-4e63-452b-ba2f-7b67e7e868de" class="bulleted-list"><li style="list-style-type:disc"><strong>Level</strong>: 8 (High Warning)</li></ul><ul id="c185c8ed-4514-41a6-8945-2e0c1b58b0fb" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: When a <strong>POST</strong> request to <code>/vapi/api2/user/login</code> contains fields other than <code>email </code>and <code>password</code>.</li></ul><hr id="b332562c-2617-4f0f-a426-e61f214d9d7b"/><p id="bf9fe24d-24a7-4b6e-bb90-4cabfe048c10" class=""><strong>3. Failed Login Attempts</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7c294b91-2c76-487f-a972-9aa107cb5001" class="code"><code class="language-XML">&lt;rule id=&quot;100017&quot; level=&quot;7&quot;&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;success&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;false&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;usernameOrPasswordIncorrect&lt;/field&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;401&lt;/status&gt;
  &lt;description&gt;Username Or Password Incorrect !!! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="07506e38-bced-4060-90a0-d71d6daef670" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: Detects failed login attempts due to incorrect credentials.</li></ul><ul id="6876852a-1ad9-4d01-b7f6-010bbee8dc83" class="bulleted-list"><li style="list-style-type:disc"><strong>Level</strong>: 7 (Warning)</li></ul><ul id="3a71eb53-1cbf-4e4d-b2e0-99947a4cedd5" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: When a response indicates an <em>unsuccessful login</em> (<strong>HTTP status 401</strong>) and includes<br/>the words <br/><code>success</code>, <code>false</code>, and <code>usernameOrPasswordIncorrect</code> in the <em>response body</em>.</li></ul><hr id="ec7fa3d5-9259-4725-80b3-0e071e1c5709"/><p id="3eb7dec5-ce68-4d7f-bd2f-4da53a32a062" class=""><strong>4. Potential Brute-Force Attacks</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="70d431ee-655e-42a7-95fc-9ea17c2d5b6b" class="code"><code class="language-XML">&lt;rule id=&quot;100018&quot; level=&quot;10&quot; frequency=&quot;5&quot; timeframe=&quot;120&quot;&gt;
  &lt;if_matched_sid&gt;100017&lt;/if_matched_sid&gt;
  &lt;description&gt;Potential Brute-Force Attack !!! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="2c69453a-e3b6-4cad-bbae-93a56381f7d8" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: Detects potential<em> brute-force attacks</em> based on multiple failed login attempts.</li></ul><ul id="d972f8fd-1337-4311-bf8f-505a66798ba0" class="bulleted-list"><li style="list-style-type:disc"><strong>Level</strong>: 10 (Critical)</li></ul><ul id="c82e8c7e-ae8d-4100-a08f-a6d0d40cce83" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: When the rule for failed login attempts (<code>ID 100017</code>) is matched 5 times within a 2-minute timeframe.</li></ul><hr id="dace4b82-4b58-402e-a8dd-48ec77bf656c"/><p id="3425bb7f-8e55-455f-8ad9-1849e3a51b03" class="">We will use <code>curl</code> to send various requests to the <em>authentication endpoints</em> and then use <code>wazuh-logtest</code> to manually verify our rules.</p><ol type="1" id="597230c7-123f-49f9-9b98-c0640b90247c" class="numbered-list" start="1"><li><strong>Successful Login (POST Request)</strong><p id="4ebe75c0-798f-4760-9cc2-f7ad4c3fb489" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="316f3961-6f79-4c21-ac69-94201179fec0" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api2/user/login&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data-raw &#x27;{
    &quot;email&quot;:&quot;savanna48@ortiz.com&quot;,
    &quot;password&quot;:&quot;zTyBwV/9&quot;
}&#x27;</code></pre><figure id="9c3d8c8b-a5be-4026-a03f-a6825e933ab3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20116.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20116.png"/></a></figure><p id="7085c650-22f2-4228-817c-7e2f50264923" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b6e1e4c2-511f-41c8-8888-45d69785c5f8" class="code"><code class="language-Bash">[2024-07-21 09:03:54] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;64&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:03:54] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:03:54 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;token\&quot;:\&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB\&quot;}&quot;} </code></pre><figure id="a1c11370-27d5-48b9-8228-5f3bf0687a31" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20117.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20117.png"/></a></figure><p id="9678cd14-6d01-4799-a110-c3db2944cfda" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="666c672e-f978-45d3-b8b0-8e964523a43d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20118.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20118.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5545dab6-af2f-4617-8bb1-bf76166d114d" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;b0fdfe19&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:03:54] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;64&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;savanna48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;64&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:03:54] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:03:54 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;token\&quot;:\&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;true&quot;,&quot;token&quot;:&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:03:54 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100015&#x27;
	level: &#x27;6&#x27;
	description: &#x27;User was successfully logged in ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="a447bf9a-b95c-4809-9e72-df7c14f0b611" class="">The log entries reflect a <em>successful login</em> attempt by a user, where the application correctly processes the request and generates a valid response. The <strong>detection rule</strong> (<code>ID 100015</code>) was successfully triggered, indicating that the system is effectively monitoring login activities.</p><hr id="1072867c-1b4d-4261-b2fc-997cf4ffd26b"/></li></ol><ol type="1" id="7882b2e7-c102-4eee-8ed1-a971469997e4" class="numbered-list" start="2"><li><strong>Unauthorized Field in Login Request (POST Request)</strong><p id="3ef4474e-4dc2-4940-b637-122a93c580c6" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ad2195b1-9e3e-47ad-997c-e7bb970ead82" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api2/user/login&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data-raw &#x27;{
    &quot;email&quot;:&quot;savanna48@ortiz.com&quot;,
    &quot;password&quot;:&quot;zTyBwV/9&quot;,
    &quot;age&quot;:&quot;24&quot;,
    &quot;admin&quot;:&quot;true&quot;
}&#x27;</code></pre><figure id="765a54c1-e03d-4162-813d-a4e5c93436fe" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20119.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20119.png"/></a></figure><p id="432542ec-1cc3-4444-a114-13dcb8eb08a3" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f0223208-84ae-4932-91d9-4561224d7e35" class="code"><code class="language-Bash">[2024-07-21 09:08:48] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;,&quot;age&quot;:&quot;24&quot;,&quot;admin&quot;:&quot;true&quot;}} 
[2024-07-21 09:08:48] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:08:48 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;token\&quot;:\&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB\&quot;}&quot;} </code></pre><figure id="e437f2e6-0ae7-435c-8b0b-97c6dd31f764" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20120.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20120.png"/></a></figure><p id="40fb24e8-b6fb-49ef-a3e3-f9044887204a" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="07aed4b8-fcf0-4586-a12b-3b33678784aa" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20121.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20121.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4a5b859a-c7cf-4537-82fa-ff9bb385552d" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;8f6455ea&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:08:48] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;100&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;,&quot;age&quot;:&quot;24&quot;,&quot;admin&quot;:&quot;true&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.admin: &#x27;true&#x27;
	body.age: &#x27;24&#x27;
	body.email: &#x27;savanna48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;savanna48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;,&quot;age&quot;:&quot;24&quot;,&quot;admin&quot;:&quot;true&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;100&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100016&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in POST http://localhost/vapi/api2/user/login&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:08:48] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:08:48 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;token\&quot;:\&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;true&quot;,&quot;token&quot;:&quot;Fp0r1mty_gxK9DRZ5IUw3sX2enQ6rau68M6YGyoqR3XoBG13wtSbvmdaK5CB&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:08:48 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100015&#x27;
	level: &#x27;6&#x27;
	description: &#x27;User was successfully logged in ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="5725f046-9a40-45fd-bf9b-7b6529b6e635" class="">The log entries reflect a <em>login attempt</em> that included <strong>unauthorized fields</strong> (<code>age</code> and <code>admin</code>) in the <em>request body</em>. Despite the presence of these fields, the application still generates a successful authentication response. The <strong>detection rule</strong> (<code>ID 100016</code>) was triggered, indicating that the system identified the <strong>unauthorized fields</strong> in the <em>login request</em>.</p><hr id="3d3eebb1-87e7-4b60-ba54-2b1018523ee9"/></li></ol><ol type="1" id="11365b76-7770-47d0-8fbb-d86710431979" class="numbered-list" start="3"><li><strong>Incorrect Username or Password (POST Request)</strong><p id="3114282c-2395-4bd0-b5fb-c5a704168401" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="023666be-aefd-48e9-b7db-82075aaa1d81" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api2/user/login&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data-raw &#x27;{
    &quot;email&quot;:&quot;havvana48@ortiz.com&quot;,
    &quot;password&quot;:&quot;zTyBwV/9&quot;
}&#x27;</code></pre><figure id="6c7d5c89-253b-4574-89c7-2a088c035a6b" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20122.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20122.png"/></a></figure><p id="032a8a5f-4334-494c-a361-c00060ef346e" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="89867af2-18af-4d58-bb04-be91159393e5" class="code"><code class="language-Bash">[2024-07-21 09:15:18] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;64&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:15:18] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:15:18 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} </code></pre><figure id="e851cb6c-3852-4ab3-a613-d17b68035423" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20123.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20123.png"/></a></figure><p id="108faa5a-9727-4332-806a-098150d735ba" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="13678f5a-65ca-4f5f-8c55-b85a7484bd9a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20124.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20124.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ac9af519-dec5-4404-a923-9f3088a5d12b" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;96fe2ea3&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:15:18] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;64&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;64&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:15:18] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:15:18 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:15:18 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="7fba338d-c897-48cb-a260-77b07c058ff5" class="">The log entries reflect a <em>failed login attempt</em> by a user, where the application correctly processes the <em>request</em> and generates an appropriate response indicating that the provided credentials were incorrect. The <strong>detection rule</strong> (<code>ID 100017</code>) was successfully triggered, indicating that the system is effectively monitoring login activities for <strong>unauthorized access</strong> attempts.</p><hr id="a22857e4-f8a2-4f0f-8b8c-afc9b8d5304c"/></li></ol><ol type="1" id="57f226da-f8c7-47f2-9b2d-a0d4244ce102" class="numbered-list" start="4"><li><strong>Brute-Force Attack Simulation</strong><p id="73e389f8-11f8-49e4-8ce5-c8a7d2b2839a" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="51e0236e-a3e3-4d17-b81c-e46cc9e745f8" class="code"><code class="language-Bash">for i in {1..6}; do
	curl --location &#x27;http://localhost/vapi/api2/user/login&#x27; \
	--header &#x27;Content-Type: application/json&#x27; \
	--data-raw &#x27;{
	    &quot;email&quot;:&quot;havvana48@ortiz.com&quot;,
	    &quot;password&quot;:&quot;zTyBwV/9&quot;
	}&#x27;
done</code></pre><figure id="b2c053b4-78f2-4dc9-8cc5-ae175bf8aeeb" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20125.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20125.png"/></a></figure><p id="bfa98c39-577e-4845-91d6-b4175e32bba1" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b6818501-a732-4009-9a56-8addf2df8ed7" class="code"><code class="language-Bash">[2024-07-21 09:19:57] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:57] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:57 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} 
[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} 
[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} 
[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} 
[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} 
[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} 
[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} </code></pre><figure id="a8bcca6a-f3f1-4999-919d-5fbc88ec719d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20126.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20126.png"/></a></figure><p id="c26643a4-664a-4017-ae08-d0882bb1efb4" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="c20438d6-b181-423e-a0c4-facd53334921" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20127.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20127.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="82ead1c5-d056-4320-83bd-96f6aeb10b70" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;09371708&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:57] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:57] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:57 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:57 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;2&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;3&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;4&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100018&#x27;
	level: &#x27;10&#x27;
	description: &#x27;Potential Brute-Force Attack !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	frequency: &#x27;5&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api2/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.email: &#x27;havvana48@ortiz.com&#x27;
	body.password: &#x27;zTyBwV/9&#x27;
	full_body: &#x27;&quot;email&quot;:&quot;havvana48@ortiz.com&quot;,&quot;password&quot;:&quot;zTyBwV/9&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api2/user/login&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:19:58] local.INFO: Response: {&quot;status&quot;:401,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;usernameOrPasswordIncorrect\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;usernameOrPasswordIncorrect&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:19:58 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;401&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100017&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Username Or Password Incorrect !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;5&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="126a918f-88f2-43d5-94e8-f8afaa6dee8a" class="">The log entries reflect a <em>failed login attempt</em> by a user, where the application correctly processes the <em>request</em> and generates an appropriate response indicating that the provided credentials were incorrect. The <strong>detection rule</strong> (<code>ID 100017</code>) was successfully triggered, indicating that the system is effectively monitoring login activities for <strong>unauthorized access</strong> attempts. Also the <strong>detection rule</strong> (<code>ID 100018</code>) was triggered, indicating <strong>Potential Brute-Force Attack</strong>.</p><hr id="39b2055a-57d2-47ba-93fe-9d2181a00f93"/></li></ol><h2 id="2eebfe2b-fd17-497b-8877-950a9aec0759" class="">4.3 <strong> Lack of resources and rate-limiting</strong></h2><p id="cd5c33bb-12c0-4bff-b0a2-24d1db33f25d" class="">For detecting attacks related to the <strong>lack of resources and rate-limiting</strong>, we focus on the endpoint for <strong>verifying OTP</strong> (<code>One Time Password</code>):</p><ul id="429083b0-67cb-4cf0-83e0-0bbbe0914297" class="bulleted-list"><li style="list-style-type:disc"><strong>Verify OTP</strong> (POST) - <code>http://{{host}}/vapi/api4/otp/verify</code></li></ul><p id="67d01035-1079-40a7-b2fa-332628169a2f" class="">Here are the rules designed to detect various scenarios on this endpoint:</p><ol type="1" id="be2e9393-115a-4c7b-9ebf-7fbcb2cdf3f3" class="numbered-list" start="1"><li><strong>Invalid OTP Detection</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d003e175-829c-4420-96e7-6a97ffc52d2f" class="code"><code class="language-XML">&lt;rule id=&quot;100019&quot; level=&quot;7&quot;&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;success&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;false&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;Invalid OTP&lt;/field&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;403&lt;/status&gt;
  &lt;description&gt;Invalid One Time Password !!! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="d7323374-aee6-4682-9df3-605191bca417" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This rule triggers when the response body indicates a failed <strong>OTP</strong> verification attempt. It checks for the presence of the keywords <code>success</code>, <code>false</code>, and <code>Invalid OTP</code>.</li></ul><ul id="9cf41303-5a0f-4cc9-9b33-52cfcafd0682" class="bulleted-list"><li style="list-style-type:disc"><strong>Action</strong>: If matched, it returns a <code>403 Forbidden</code> status, indicating that the <strong>OTP</strong> provided is invalid.</li></ul><hr id="bbdf6afe-706a-4134-b320-6670d5a0b487"/></li></ol><ol type="1" id="640798d9-a419-42d2-b3df-c663c4ad1574" class="numbered-list" start="2"><li><strong>Brute-Force Attack Detection</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="52134a19-d86e-4df4-bcee-519b2efc50f1" class="code"><code class="language-XML">&lt;rule id=&quot;100020&quot; level=&quot;10&quot; frequency=&quot;5&quot; timeframe=&quot;120&quot;&gt;
  &lt;if_matched_sid&gt;100019&lt;/if_matched_sid&gt;
  &lt;description&gt;Potential Brute-Force Attack !!! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="f420fc0f-c973-4a9c-a2b5-3e3bdf90238f" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This rule is a follow-up to <code>Rule 100019</code>. It monitors for repeated <strong>invalid OTP </strong>attempts.</li></ul><ul id="a040cd66-922e-4b94-abe7-b640a8f407d9" class="bulleted-list"><li style="list-style-type:disc"><strong>Action</strong>: If <code>Rule 100019</code> is triggered <em>5 times within a 2-minute timeframe</em>, this rule flags a<br/><br/><strong>potential brute-force attack</strong> with a high severity level of <code>10</code>.</li></ul><hr id="36150007-8b2a-45af-8089-74dcadb32de2"/></li></ol><ol type="1" id="e638393b-e38e-451f-9701-c8e9f0ff0b26" class="numbered-list" start="3"><li><strong>Successful OTP Verification</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3f9b5434-0176-4a4a-8ee0-731e0c7102d6" class="code"><code class="language-XML">&lt;rule id=&quot;100021&quot; level=&quot;4&quot;&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;success&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;true&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;\bkey&lt;/field&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;status&gt;200&lt;/status&gt;
  &lt;description&gt;User was successfully verified ! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="2b1b6a99-5da9-422b-9399-022e67566c27" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This rule identifies <strong>successful OTP</strong> verifications. It looks for the keywords<br/><br/><code>success</code>, <code>true</code>, and the presence of a key in the <em>response body</em>.</li></ul><ul id="0efa900b-c2ec-4d0c-8a5f-52016dd5c110" class="bulleted-list"><li style="list-style-type:disc"><strong>Action</strong>: If matched, it returns a <code>200 OK</code> status, confirming that the user has been <em>successfully verified</em>.</li></ul><hr id="3e33348d-e595-42b4-8882-d41eced127ae"/></li></ol><ol type="1" id="6335bcfc-f6e6-4f0e-abe6-905bb39e92a2" class="numbered-list" start="4"><li><strong>Unauthorized Field Detection</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="36c72fdc-559e-4ec1-8202-6f08b94c8bed" class="code"><code class="language-XML">&lt;rule id=&quot;100022&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;POST&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api4/otp/verify&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\&quot;(?!otp)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="1933b296-06f8-4360-b87e-e41114aec650" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: This rule checks for <em>unauthorized fields</em> in the <em>request body</em> of the <strong>POST</strong> request to the <strong>OTP verification</strong> endpoint.</li></ul><ul id="c0c9ec30-af72-4648-a3ed-fef56b87f08c" class="bulleted-list"><li style="list-style-type:disc"><strong>Action</strong>: If any field other than <code>otp</code> is detected, it flags this as a potential security issue with a severity level of <code>8</code>.</li></ul><hr id="0abd8753-5856-452b-a5d3-203aaa128847"/></li></ol><p id="28e33131-fd8c-4255-925d-21198b651183" class="">We will use <code>curl</code> to send various requests to the <strong>OTP verification</strong> endpoint and then use <code>wazuh-logtest</code> to manually verify our rules.</p><p id="80645a44-cc13-4fd5-8526-d752104c72fa" class="">1. <strong>Successful OTP Verification (POST Request)</strong><div class="indented"><p id="a30938fd-7f1a-4694-a667-0390d8b73083" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="838713e4-6e81-4f4a-86ec-d1b3468566ea" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api4/otp/verify&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;otp&quot;:&quot;1872&quot;
}&#x27;</code></pre><figure id="98f71d43-b62e-4e02-8a0a-361bdf93a0ec" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20128.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20128.png"/></a></figure><p id="4d453eb9-ccf4-451b-8b90-67f62537dbbe" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3d074199-b1ad-4a87-8055-88ad7cb3c94c" class="code"><code class="language-Bash">[2024-07-21 09:40:03] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;20&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;1872&quot;}} 
[2024-07-21 09:40:03] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:40:03 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;key\&quot;:\&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y\&quot;}&quot;} </code></pre><figure id="6e9ccf45-3cf7-4d87-9a67-4ec8ba9ef937" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20129.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20129.png"/></a></figure><p id="fcc2b81c-6210-45bc-968a-209d0de20067" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="4957943b-f37c-4110-aa65-97021e178567" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20130.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20130.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="27b25602-5a08-48a2-871e-549f6c783151" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;a74d3dbe&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:40:03] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;20&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;1872&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;1872&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;1872&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;20&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:40:03] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:40:03 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;key\&quot;:\&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;true&quot;,&quot;key&quot;:&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:40:03 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100021&#x27;
	level: &#x27;4&#x27;
	description: &#x27;User was successfully verified ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="a4a33906-7eab-4ac8-b6d4-901d8f8f74aa" class="">In summary, these log messages describe an <strong>OTP verification</strong> process where a user initiates a request to <strong>verify an OTP</strong>, and the server responds with a <strong>successful verification</strong> and a session token. The process involves decoding the request and response data and applying predefined rules to detect successful verifications.</p><hr id="9f46799d-2c0c-46e0-be0f-c78a90bfcd07"/></div></p><ol type="1" id="202fac31-343a-4b51-bef0-2011a4bac12a" class="numbered-list" start="2"><li><strong>Unauthorized Field in OTP Verification Request (POST Request)</strong><p id="d1998e6a-3e05-4010-b757-cb5bfcd3d21e" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e8f6d6e6-0864-4532-9c7d-68a7ea2add6a" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api4/otp/verify&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;unauthorized&quot;:&quot;true&quot;,
    &quot;otp&quot;:&quot;1872&quot;
}&#x27;</code></pre><figure id="72b21601-86e0-4caa-ae01-b5617057ac94" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20131.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20131.png"/></a></figure><p id="2a096571-86be-4383-a1f8-c04c16cd7f92" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1127812e-3605-4f12-aef9-f5c929ffa550" class="code"><code class="language-Bash">[2024-07-21 09:44:07] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;47&quot;]},&quot;body&quot;:{&quot;unauthorized&quot;:&quot;true&quot;,&quot;otp&quot;:&quot;1872&quot;}} 
[2024-07-21 09:44:07] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:44:07 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;key\&quot;:\&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y\&quot;}&quot;} </code></pre><figure id="fcaf4a3a-23c9-461f-8c91-4f743058dcd6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20132.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20132.png"/></a></figure><p id="fec40258-5ae4-45d0-92c8-718a3b3b05da" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="b3736556-7c34-493e-8ad2-348e17b006bc" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20133.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20133.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6716873a-d8c2-4a03-b447-72c8a7d07828" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;a5a0503d&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:44:07] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;47&quot;]},&quot;body&quot;:{&quot;unauthorized&quot;:&quot;true&quot;,&quot;otp&quot;:&quot;1872&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;1872&#x27;
	body.unauthorized: &#x27;true&#x27;
	full_body: &#x27;&quot;unauthorized&quot;:&quot;true&quot;,&quot;otp&quot;:&quot;1872&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;47&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100022&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in POST http://localhost/vapi/api4/otp/verify&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:44:07] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:44:07 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;key\&quot;:\&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;true&quot;,&quot;key&quot;:&quot;FZvjaFlMgUfnpFJDhKx-92xeXx_sCr7Y&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:44:07 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100021&#x27;
	level: &#x27;4&#x27;
	description: &#x27;User was successfully verified ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="46599378-c4ed-4fdc-9b09-bfad8b4cd9fd" class="">The log entries reflect multiple <strong>failed login attempts</strong> by a user, where the application correctly processes each request and generates appropriate responses indicating that the provided <em>credentials were incorrect</em>. The <strong>detection rules</strong> (IDs <code>100017</code> and <code>100018</code>) were successfully triggered, indicating that the system is effectively monitoring login activities for <strong>unauthorized access attempts</strong>.</p><hr id="792eb26e-847a-4301-bc4f-29cc785d7350"/></li></ol><ol type="1" id="66b0284e-fd60-4e80-badd-f63d055748fb" class="numbered-list" start="3"><li><strong>Invalid OTP (POST Request)</strong><p id="546a9b58-883f-4cbc-9268-a5ca11fc936d" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="dd703903-e0e0-44b9-8085-e88323f351a5" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api4/otp/verify&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;otp&quot;:&quot;9999&quot;
}&#x27;</code></pre><figure id="52d579d0-8109-4c5c-9770-90b7ecf1dae1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20134.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20134.png"/></a></figure><p id="4a3d0309-1528-4363-b2eb-3833875c6464" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bf06bb93-8a32-4f25-9016-a83677dc22a6" class="code"><code class="language-Bash">[2024-07-21 09:48:41] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;20&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:48:41] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:48:41 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} </code></pre><figure id="485760a9-985e-430a-bd50-8eec353f8025" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20135.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20135.png"/></a></figure><p id="6da0f670-c9cb-48ef-bf6b-05912c036a06" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="627753b4-423c-4837-a31c-1fa5c2653f31" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20136.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20136.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="00529468-bae5-4d08-8311-f7873037860f" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;146781bd&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:48:41] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;20&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;20&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:48:41] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:48:41 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:48:41 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="8a505d02-7f24-4d41-96d4-d714ac1f8bfb" class="">The application correctly identifies and logs both the request and response, and the detection rule (<code>ID 100019</code>) was successfully triggered. The  rule (<code>ID 100019</code>) confirms that the <strong>OTP<br/>verification<br/></strong> was <strong>unsuccessful</strong>, indicating that the application is functioning as intended.</p><hr id="179ddbac-9635-46e1-aee1-6b877160d1ee"/></li></ol><ol type="1" id="d67b4ee6-a4f9-477b-b0af-121d59545577" class="numbered-list" start="4"><li><strong>Brute-Force Attack Simulation</strong><p id="e7d06d7c-8da8-4c6f-94ad-81d1c55e8d6a" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b00c2826-3ab9-40c0-9918-2bfea15eb188" class="code"><code class="language-Bash">for i in {1..6}; do
	curl --location &#x27;http://localhost/vapi/api4/otp/verify&#x27; \
	--header &#x27;Content-Type: application/json&#x27; \
	--data &#x27;{
	    &quot;otp&quot;:&quot;9999&quot;
	}&#x27;
done</code></pre><figure id="73bd8382-18c2-46ad-826b-8491d3b8224c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20137.png"><img style="width:1920px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20137.png"/></a></figure><p id="cfd593e5-c36f-4037-815f-d04dd5ea3aaf" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="76ee935a-6515-46fa-8593-dea6b4dba70f" class="code"><code class="language-Bash">[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} 
[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} 
[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} 
[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} 
[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} 
[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} 
[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} </code></pre><figure id="e1cb897d-17a5-49da-9847-c233c081343a" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20138.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20138.png"/></a></figure><p id="98f7091a-5b62-430e-b4a9-4fddf8357a4e" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="99d4020f-7780-4d79-98fe-9d838b8de44c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20139.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20139.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1534ff31-42e0-47fe-aac2-ddeb6d7013a4" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;b36788d5&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;2&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;3&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;4&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100020&#x27;
	level: &#x27;10&#x27;
	description: &#x27;Potential Brute-Force Attack !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	frequency: &#x27;5&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api4/otp/verify&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;22&quot;]},&quot;body&quot;:{&quot;otp&quot;:&quot;9999&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.otp: &#x27;9999&#x27;
	full_body: &#x27;&quot;otp&quot;:&quot;9999&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;22&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api4/otp/verify&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 09:54:12] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;Invalid OTP\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;Invalid OTP&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 09:54:12 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100019&#x27;
	level: &#x27;7&#x27;
	description: &#x27;Invalid One Time Password !!! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;5&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="292f3c53-e3af-4272-9964-ac36b4edabe1" class="">The repeated <em>failed attempts</em>, with the <strong>same OTP</strong> value being submitted each time, suggest a potential <strong>brute-force attack</strong>. <strong>Brute-force</strong> attacks involve systematically checking all possible combinations of OTPs or passwords until the correct one is found. By implementing the <strong>detection rule</strong> (<code>ID 100020</code>), the system identifies this pattern of multiple failed attempts within a short timeframe and generates a critical alert. This alert indicates that further investigation is necessary to determine if the failed attempts are part of a larger attack or simply legitimate user errors.</p><hr id="72b45204-dde1-4ccf-ba48-67575a52f6da"/></li></ol><h2 id="d5dac5fd-a6a7-484a-8855-dff89c875346" class="">4.4 <strong>Broken function-level authorization</strong></h2><p id="faead580-b424-427d-beb8-491dc19919e2" class=""><strong>Broken function-level authorization</strong> vulnerabilities occur when an application does not properly enforce access controls, allowing <em>unauthorized users</em> to perform actions or access data they should not. In the context of the provided endpoints for user management, we can analyze the rules defined to <em>detect potential attacks</em>.</p><p id="fbc60733-8a50-4c5d-9a2c-8872f397e67f" class="">For detecting attacks related to <strong>broken function-level authorization</strong>, we focus on the following endpoints:</p><ol type="1" id="f9a56f28-f5b2-4b6c-a8d1-a0224679f684" class="numbered-list" start="1"><li><strong>Create User</strong> (POST) - <code>http://{{host}}/vapi/api5/user</code></li></ol><ol type="1" id="8ef07335-020b-40f9-8a54-458c9083d1e5" class="numbered-list" start="2"><li><strong>Get User</strong> (GET) - <code>http://{{host}}/vapi/api5/user/{api5_id}</code></li></ol><p id="ffa313d4-bc88-49ed-ba48-dcec672e5efe" class="">Here are the rules designed to detect various scenarios on these endpoints:</p><ol type="1" id="569e4f6f-f9ff-412d-a1db-3c5f6d4ef667" class="numbered-list" start="1"><li> <strong>Detects GET requests to retrieve user information</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="898364fe-3f43-4f44-bdc5-db16bb2cacb8" class="code"><code class="language-XML">&lt;rule id=&quot;100023&quot; level=&quot;3&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;GET&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;\Wvapi\Wapi5\Wuser\W\d+&lt;/url&gt;
  &lt;description&gt;Getting access to user information id:$(url) &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="97b89253-8df5-4603-ac39-a2cc83944762" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: A request matching the <strong>URL</strong> pattern for getting user data.</li></ul><ul id="fdac2525-3090-4c10-9cae-aac28f35273f" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: To identify attempts to access user information without <em>proper authorization</em>.</li></ul><hr id="5731decf-e1f3-4f68-97df-f07c9fbb9403"/></li></ol><ol type="1" id="5c526ecc-fb01-40f7-8b08-49fa59a1d3ff" class="numbered-list" start="2"><li><strong>Flags attempts to access restricted data</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bd255a4a-46e4-4bab-bbcb-4742069dda08" class="code"><code class="language-XML">&lt;rule id=&quot;100024&quot; level=&quot;10&quot;&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api5/users&lt;/url&gt;
  &lt;description&gt;Attempt to access Restricted Data !!!&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="2a88e0b2-5131-4ebf-95da-30c706f30b1d" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: Any request to <code>/vapi/api5/users</code>.</li></ul><ul id="13dc8e98-813f-47b1-b688-e97dc188b6b0" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: To highlight critical unauthorized access attempts to sensitive user data.</li></ul><hr id="0209fb8e-ba69-4f9c-a3dd-661ebbdc51b1"/></li></ol><ol type="1" id="353c2572-08e6-42e4-b1f2-5ee41356f5b8" class="numbered-list" start="3"><li><strong>Detects unauthorized fields in GET requests</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7ca69803-8188-4e74-8ee3-d342f0ed7f05" class="code"><code class="language-XML">&lt;rule id=&quot;100025&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;GET&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;\Wvapi\Wapi5\Wuser\W\d+&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\w+&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="4410409b-10fe-4599-a1f7-f33a2b079133" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: GET requests to user endpoints containing unexpected fields in the body.</li></ul><ul id="6e633062-8528-4dce-ae9a-a86c71269634" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: To catch attempts to manipulate requests with unauthorized data.</li></ul><hr id="1015e735-9c1d-4fda-ac88-78c6458f05fc"/></li></ol><ol type="1" id="5f4661b8-1cef-4c8d-94e5-28c1445c0415" class="numbered-list" start="4"><li><strong>Flags unauthorized fields in POST requests</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4e176716-3eea-42d8-abf8-2418cecd8ad8" class="code"><code class="language-XML">&lt;rule id=&quot;100026&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;POST&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api5/user&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;\&quot;(?!username|name|address|mobileno|password)\w+\&quot;:\&quot;[^\&quot;]*\&quot;&lt;/field&gt;
  &lt;description&gt;Unauthorized field detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="31fa6387-d4d4-4946-85c0-b685ba7075c2" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: <strong>POST</strong> requests to create a user that include fields other than the allowed ones (<code>username</code>, <code>name</code>, <code>address</code>, <code>mobileno</code>, <code>password</code>).</li></ul><ul id="fc360f26-ef96-4910-9282-813c114e7f14" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: To prevent unauthorized data from being submitted during user creation.</li></ul><hr id="06534d2b-ddeb-47c9-a57d-e604130e93d0"/></li></ol><ol type="1" id="5765dd2e-c4ed-48bf-b405-7c07f900fcf4" class="numbered-list" start="5"><li><strong>Confirms successful user creation</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9d98863d-84dc-432b-858f-3a4610bb3cac" class="code"><code class="language-XML">&lt;rule id=&quot;100027&quot; level=&quot;3&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Response&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;username&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;name&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;address&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;mobileno&lt;/field&gt;
  &lt;field name=&quot;body&quot; type=&quot;pcre2&quot;&gt;id&lt;/field&gt;
  &lt;status&gt;201&lt;/status&gt;
  &lt;description&gt;User was successfully created ! &lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="8a668ad7-ade5-4a6a-af4f-91e218fe3811" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger</strong>: A response with <strong>status 201</strong> that includes specific fields in the body.</li></ul><ul id="2f83d841-c181-43a4-9ebd-53b49a846c2f" class="bulleted-list"><li style="list-style-type:disc"><strong>Purpose</strong>: To validate that a user was <em>created successfully</em>, ensuring <em>no unauthorized access</em> occurred during the process.</li></ul><hr id="0916b298-3a5e-458f-9a16-a2e5bc6f377e"/></li></ol><p id="adbe3779-fd59-4281-894d-d412a287ad13" class="">We will use <code>curl</code> to send various requests to the user endpoints and then use <code>wazuh-logtest</code> to manually verify our rules.</p><p id="10ba54b4-65dd-489d-8d12-490209aa582d" class="">1. <strong>Successful User Creation (POST Request)</strong><div class="indented"><p id="7d06ddcc-8587-41c8-9654-042bfff6c2a0" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6c633530-41d8-4c78-b9e6-94696160b676" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api5/user&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;:&quot;testuser2&quot;,
    &quot;password&quot;:&quot;test123&quot;,
    &quot;name&quot;:&quot;Test User&quot;,
    &quot;address&quot;:&quot;ABC&quot;,
    &quot;mobileno&quot;:&quot;888888888&quot;
}&#x27;</code></pre><figure id="404b700f-a17f-4754-bca5-8030e7d414e8" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20140.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20140.png"/></a></figure><p id="19626c90-8b02-401c-aedb-3289e9f80711" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3bdd4075-e29b-4587-8514-4200fe9c7bad" class="code"><code class="language-Bash">[2024-07-21 10:29:44] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;129&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;testuser2&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;}} 
[2024-07-21 10:29:44] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:29:44 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;,\&quot;id\&quot;:9}&quot;} </code></pre><figure id="7bed8b19-5f7b-48c4-b9da-86ea48a115e6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20141.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20141.png"/></a></figure><p id="706f5a6a-a610-4d11-a7ef-03ea8dc57517" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="d782df12-1d02-48cd-8129-994c036d9cd9" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20142.png"><img style="width:684px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20142.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="46fbca31-5c35-4e53-be7d-3207ef7c26ac" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;4f9531f7&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:29:44] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;129&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;testuser2&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.address: &#x27;ABC&#x27;
	body.mobileno: &#x27;888888888&#x27;
	body.name: &#x27;Test User&#x27;
	body.password: &#x27;test123&#x27;
	body.username: &#x27;testuser2&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;testuser2&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;129&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api5/user&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:29:44] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:29:44 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;,\&quot;id\&quot;:9}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;,&quot;id&quot;:9}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 10:29:44 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;201&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100027&#x27;
	level: &#x27;3&#x27;
	description: &#x27;User was successfully created ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="e6117fc6-90a8-425c-95da-9c53d9c0e0bf" class="">The provided log messages and event processing steps illustrate the workflow of handling a user creation request in a web application. The rule (<code>ID 100027</code>) is triggered because the response indicates a successful creation of a user, validating that the operation was <em>authorized</em> and executed correctly.</p><hr id="131bec20-0ffc-4d2a-9cb7-00d218d4495a"/></div></p><ol type="1" id="59f293e5-e741-4561-b35f-f94ff9cca85a" class="numbered-list" start="2"><li><strong>Unauthorized Field in User Creation Request (POST Request)</strong><p id="bd4ccd6d-00d8-4742-9c0c-5f513d80c1ae" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4071c716-f39e-4797-8a56-25f206c2d914" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api5/user&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;:&quot;Reptilio&quot;,
    &quot;password&quot;:&quot;test123&quot;,
    &quot;name&quot;:&quot;Rept&quot;,
    &quot;address&quot;:&quot;ABC&quot;,
    &quot;mobileno&quot;:&quot;888888888&quot;,
    &quot;age&quot;:&quot;25&quot;
}&#x27;</code></pre><figure id="95439697-c209-4e14-9955-afa3d87e98c1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20143.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20143.png"/></a></figure><p id="9e53c2d1-7182-4e66-98b2-d9d019e908e5" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="21c4be37-cbda-4484-8f8e-2f23cb59cb8d" class="code"><code class="language-Bash">[2024-07-21 10:35:42] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;139&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Reptilio&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;,&quot;age&quot;:&quot;25&quot;}} 
[2024-07-21 10:35:42] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:35:42 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;,\&quot;id\&quot;:10}&quot;} </code></pre><figure id="ba734a19-9685-489b-a15a-640a46af133e" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20144.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20144.png"/></a></figure><p id="ae7a16e4-5c65-4808-855a-8233e9616b20" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="b542162a-28c6-4ef2-8cc0-e3e1262112d1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20145.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20145.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d30a351f-75c7-4db8-830c-9e85dafc4812" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;df01cf5f&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:35:42] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;139&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Reptilio&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;,&quot;age&quot;:&quot;25&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.address: &#x27;ABC&#x27;
	body.age: &#x27;25&#x27;
	body.mobileno: &#x27;888888888&#x27;
	body.name: &#x27;Rept&#x27;
	body.password: &#x27;test123&#x27;
	body.username: &#x27;Reptilio&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Reptilio&quot;,&quot;password&quot;:&quot;test123&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;,&quot;age&quot;:&quot;25&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;139&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api5/user&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100026&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in POST http://localhost/vapi/api5/user&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:35:42] local.INFO: Response: {&quot;status&quot;:201,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:35:42 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;,\&quot;id\&quot;:10}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;username&quot;:&quot;Reptilio&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;,&quot;id&quot;:10}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 10:35:42 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;201&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100027&#x27;
	level: &#x27;3&#x27;
	description: &#x27;User was successfully created ! &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.</code></pre><p id="f83193ef-28d9-4615-875f-b860a39cedfe" class="">The triggering of rules during the request and response phases ensures that <strong>unauthorized actions</strong> are <strong>detected</strong> and <strong>logged</strong>, while successful operations are acknowledged. This structured approach to logging and rule evaluation helps maintain the integrity and security of the user management system.</p><hr id="cddb1163-7e1d-4940-8484-e2f24b50bed7"/></li></ol><ol type="1" id="c537149c-c4b7-490a-9a7d-b33cfb8bff14" class="numbered-list" start="3"><li><strong>Accessing User Information (GET Request)</strong><p id="af6b9671-c595-4712-be60-92f9af58ecba" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c83e35a3-b08d-45fd-9089-9f0a319f7864" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api5/user/10&#x27; \
--header &#x27;Authorization-Token: UmVwdGlsaW86dGVzdDEyMw==&#x27;</code></pre><figure id="9859c935-9b29-43a0-8ba6-e6a8b9de3fb1" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20146.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20146.png"/></a></figure><p id="eaba446d-b8ca-4170-9057-fc0aa02caa57" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6597a513-0ac5-4d08-9c2b-2616233076db" class="code"><code class="language-Bash">[2024-07-21 10:43:37] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user/10&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]},&quot;body&quot;:[]} 
[2024-07-21 10:43:37] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:43:37 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}&quot;} </code></pre><figure id="b2ba2f71-13b0-45dc-8432-a13cd48a71a6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20147.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20147.png"/></a></figure><p id="22a17625-ac54-41c9-8992-9c7609368cca" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="ecc92e97-af3d-4847-af21-8f8348fdd1e3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20148.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20148.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="51633faa-e7e3-4e35-8f1b-2273636ff0aa" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;3ebb83d1&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:43:37] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user/10&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api5/user/10&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100023&#x27;
	level: &#x27;3&#x27;
	description: &#x27;Getting access to user information id:http://localhost/vapi/api5/user/10 &#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:43:37] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:43:37 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;id&quot;:10,&quot;username&quot;:&quot;Reptilio&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 10:43:37 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;</code></pre><p id="6b784161-59d7-4572-bf8b-3500592e5c24" class="">The triggering of <code>Rule 100023</code> during the request phase ensures that any access to user data is logged and can be reviewed for <em>potential unauthorized attempts</em>. This structured approach to <strong>logging</strong> and rule evaluation helps maintain the <strong>integrity</strong> and <strong>security</strong> of the user management system, allowing for effective monitoring and auditing of user data access.</p><hr id="53100246-56d6-46aa-a002-07165c252f88"/></li></ol><ol type="1" id="6f057820-489e-4a4b-89c8-4f2fbe573c99" class="numbered-list" start="4"><li><strong>Unauthorized Field in GET Request</strong><p id="fd9a47eb-8e7b-4633-ae5f-d65254db5106" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fa5374e3-2fe9-4458-9917-2d371bee1c76" class="code"><code class="language-Bash">curl --location --request GET &#x27;http://localhost/vapi/api5/user/10&#x27; \
--header &#x27;Authorization-Token: UmVwdGlsaW86dGVzdDEyMw==&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;unathorized&quot;:&quot;true&quot;
}&#x27;</code></pre><figure id="e14f51dc-f2fd-4137-a281-6035d4c54fc0" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20149.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20149.png"/></a></figure><p id="5797f499-59d4-4b38-ad52-59ce9a324931" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bd87a7e9-a55a-4a54-911b-3c35866c754b" class="code"><code class="language-Bash">[2024-07-21 10:52:43] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user/10&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;28&quot;]},&quot;body&quot;:{&quot;unathorized&quot;:&quot;true&quot;}} 
[2024-07-21 10:52:43] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:52:43 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}&quot;} </code></pre><figure id="b5db3b4f-ea5f-4987-9891-5063d6afd5af" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20150.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20150.png"/></a></figure><p id="25fab190-82d4-45fc-849b-3ad6e6a6ac3d" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="a26d7b6e-6eae-42e8-b1cf-5a6636f20fed" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20151.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20151.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3617b536-f763-4c01-89ae-cecb09e2ad50" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;b4397916&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:52:43] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/user/10&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;28&quot;]},&quot;body&quot;:{&quot;unathorized&quot;:&quot;true&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.unathorized: &#x27;true&#x27;
	full_body: &#x27;&quot;unathorized&quot;:&quot;true&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]&#x27;
	headers.content-length: &#x27;[&quot;28&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api5/user/10&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100025&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized field detected in GET http://localhost/vapi/api5/user/10&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:52:43] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:52:43 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;id&quot;:10,&quot;username&quot;:&quot;Reptilio&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 10:52:43 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;</code></pre><p id="b99cc73b-c901-45a5-a4b4-305c5f81a182" class="">The triggering of <code>Rule 100025</code> during the request phase ensures that any <strong>unauthorized attempts</strong> to <em>access user data</em> are <strong>logged</strong> and can be reviewed for potential security breaches.</p></li></ol><ol type="1" id="3b12d37a-03b4-40b6-a891-2f0e0ecd2477" class="numbered-list" start="5"><li><strong>Attempt to Access Restricted Data (GET Request)</strong><p id="d0e6f546-0392-42be-80b2-c870c3d35e3c" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b04e23ea-224d-4703-8759-98728e67c5e1" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api5/users&#x27; \
--header &#x27;Authorization-Token: UmVwdGlsaW86dGVzdDEyMw==&#x27;</code></pre><figure id="dc1f8324-3ef3-43fd-9953-225144fc6288" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20152.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20152.png"/></a></figure><p id="4e2a2b2e-e27a-498f-8741-5dcc202e2f4d" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f042859d-7760-4ce6-82f8-8f9bd2bcb522" class="code"><code class="language-Bash">[2024-07-21 10:59:53] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/users&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]},&quot;body&quot;:[]} 
[2024-07-21 10:59:53] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:59:53 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;[{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;admin\&quot;,\&quot;name\&quot;:\&quot;Admin User\&quot;,\&quot;address\&quot;:\&quot;flag{api5_76dd990a97ff1563ae76}\&quot;,\&quot;mobileno\&quot;:\&quot;8080808080\&quot;},{\&quot;id\&quot;:2,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:3,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:4,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:5,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:6,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:7,\&quot;username\&quot;:\&quot;\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:8,\&quot;username\&quot;:\&quot;\&quot;,\&quot;name\&quot;:\&quot;\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:9,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}]&quot;} </code></pre><figure id="9d60fbc7-f1cd-4d13-b68f-5a8c32f6fea6" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20153.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20153.png"/></a></figure><p id="40a17fe2-e29d-4041-aab2-dfc0d9ed0167" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="4d5f558b-b96f-48ba-a713-7ab50eb59eea" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20154.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20154.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="71b24c69-7d53-4801-afe7-6aa00545ac93" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;6e31a1b0&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:59:53] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api5/users&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;authorization-token&quot;:[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.authorization-token: &#x27;[&quot;UmVwdGlsaW86dGVzdDEyMw==&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api5/users&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100024&#x27;
	level: &#x27;10&#x27;
	description: &#x27;Attempt to access Restricted Data !!!&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 10:59:53] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 10:59:53 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;[{\&quot;id\&quot;:1,\&quot;username\&quot;:\&quot;admin\&quot;,\&quot;name\&quot;:\&quot;Admin User\&quot;,\&quot;address\&quot;:\&quot;flag{api5_76dd990a97ff1563ae76}\&quot;,\&quot;mobileno\&quot;:\&quot;8080808080\&quot;},{\&quot;id\&quot;:2,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:3,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:4,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:5,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:6,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:7,\&quot;username\&quot;:\&quot;\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:8,\&quot;username\&quot;:\&quot;\&quot;,\&quot;name\&quot;:\&quot;\&quot;,\&quot;address\&quot;:\&quot;\&quot;,\&quot;mobileno\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:9,\&quot;username\&quot;:\&quot;testuser2\&quot;,\&quot;name\&quot;:\&quot;Test User\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;},{\&quot;id\&quot;:10,\&quot;username\&quot;:\&quot;Reptilio\&quot;,\&quot;name\&quot;:\&quot;Rept\&quot;,\&quot;address\&quot;:\&quot;ABC\&quot;,\&quot;mobileno\&quot;:\&quot;888888888\&quot;}]&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[{&quot;id&quot;:1,&quot;username&quot;:&quot;admin&quot;,&quot;name&quot;:&quot;Admin User&quot;,&quot;address&quot;:&quot;flag{api5_76dd990a97ff1563ae76}&quot;,&quot;mobileno&quot;:&quot;8080808080&quot;},{&quot;id&quot;:2,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;},{&quot;id&quot;:3,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;},{&quot;id&quot;:4,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;},{&quot;id&quot;:5,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;&quot;},{&quot;id&quot;:6,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;&quot;,&quot;mobileno&quot;:&quot;&quot;},{&quot;id&quot;:7,&quot;username&quot;:&quot;&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;&quot;,&quot;mobileno&quot;:&quot;&quot;},{&quot;id&quot;:8,&quot;username&quot;:&quot;&quot;,&quot;name&quot;:&quot;&quot;,&quot;address&quot;:&quot;&quot;,&quot;mobileno&quot;:&quot;&quot;},{&quot;id&quot;:9,&quot;username&quot;:&quot;testuser2&quot;,&quot;name&quot;:&quot;Test User&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;},{&quot;id&quot;:10,&quot;username&quot;:&quot;Reptilio&quot;,&quot;name&quot;:&quot;Rept&quot;,&quot;address&quot;:&quot;ABC&quot;,&quot;mobileno&quot;:&quot;888888888&quot;}]&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 10:59:53 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;</code></pre><p id="29f4d2e9-0e5e-4ada-a26b-3a51b24f85d0" class="">The triggering of <code>Rule 100024</code> during the request phase ensures that any access to user data is <strong>logged</strong> and can be reviewed for <em>potential unauthorized attempts</em>.</p><hr id="ce9aff1a-fba4-4ed8-a443-2248793e2f20"/></li></ol><h2 id="594e607a-2cab-4c1b-b961-f04e9bbce6c9" class="">4.5 <strong>Security misconfiguration</strong></h2><p id="ed60a5fc-de31-4a50-93ac-39ee4c5affb8" class=""><strong>Security misconfiguration</strong> vulnerabilities occur when an application is not <em>securely configured</em>, allowing <em>unauthorized users</em> to <em>access sensitive data</em> or perform actions they should not be able to.</p><p id="51002234-0fc4-4f72-bcc9-ea1e50259ca5" class="">For detecting attacks related to security misconfiguration, we focus on the following endpoint:</p><ol type="1" id="d5d4bb3c-d658-4162-ba30-6a4a50cd243c" class="numbered-list" start="1"><li><strong>Get Key</strong> (GET) - <code>http://{{host}}/vapi/api7/user/key</code></li></ol><p id="0101962c-a2bf-4c9b-8077-9f96f35e88aa" class="">The goal is to detect unauthorized headers, such as <code>Origin</code>, being added to requests to access restricted data. Below is the rule designed to detect such scenarios:</p><ol type="1" id="857b1846-3850-40a7-969f-4b6046409729" class="numbered-list" start="1"><li><strong>Unauthorized header</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="59bece9f-90a6-45c0-8ccf-c70fdba1a57a" class="code"><code class="language-XML">&lt;rule id=&quot;100028&quot; level=&quot;8&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;GET&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api7/user/key&lt;/url&gt;
  &lt;field name=&quot;headers.origin&quot; type=&quot;pcre2&quot;&gt;(https|http)?:\/\/\w+(\.\w+)*(\/\w+)*&lt;/field&gt;
  &lt;description&gt;Unauthorized header origin: $(headers.origin) detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="e0e583c9-241c-441a-a932-0acf5859bd3f" class="bulleted-list"><li style="list-style-type:disc"><strong>Rule ID</strong>: 100028</li></ul><ul id="107cf56a-e4f6-4631-a84c-6d89f5d03863" class="bulleted-list"><li style="list-style-type:disc"><strong>Level</strong>: 8</li></ul><ul id="cdeac72b-b5be-4ef6-9bb5-d5482a3629f0" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: &quot;Unauthorized header origin: $(headers.origin) detected in $(method) $(url)&quot;</li></ul><ul id="33419745-ce01-46f5-ba4c-410511bd077d" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger Conditions</strong>:<ul id="a2c81d86-8f57-40db-bd77-6f6565a6cf77" class="bulleted-list"><li style="list-style-type:circle"><strong>Field</strong>: The rule applies to requests.</li></ul><ul id="1585144c-751f-4f77-9ec0-448d24309467" class="bulleted-list"><li style="list-style-type:circle"><strong>Method</strong>: The HTTP method must be GET.</li></ul><ul id="1672c800-50b7-4be1-a216-2b183ef0985e" class="bulleted-list"><li style="list-style-type:circle"><strong>URL</strong>: The request must match the URL pattern <code>/vapi/api7/user/key</code>.</li></ul><ul id="c4823fde-9a54-4205-906d-180f17caeaac" class="bulleted-list"><li style="list-style-type:circle"><strong>Header</strong>: The request must contain an <code>Origin</code> header that matches the specified regular expression pattern, which allows for any valid HTTP or HTTPS URL.</li></ul></li></ul><p id="fdceef1d-f8de-4be9-b607-abba93046b98" class="">The purpose of <code>Rule 100028</code> is to identify and alert on any <strong>GET</strong> requests to the <code>/vapi/api7/user/key</code> endpoint that include an unauthorized <code>Origin</code> header. This is significant because:</p><ul id="98937c6f-af91-4351-a01e-a7625bdc7dd4" class="bulleted-list"><li style="list-style-type:disc"><strong>Unauthorized Access</strong>: By adding an unauthorized <code>Origin</code> header, an attacker may attempt to bypass security controls and gain access to restricted data.</li></ul><ul id="37d82fdd-e359-430f-9aab-159b4e2f37b8" class="bulleted-list"><li style="list-style-type:disc"><strong>Monitoring</strong>: The rule helps in monitoring potentially malicious attempts to exploit security misconfigurations, allowing for timely responses to unauthorized access attempts.</li></ul><p id="e998f4af-14ea-4752-bdcd-95262057f6b7" class="">We will use <code>curl</code> to send requests to the key endpoint with an unauthorized <code>Origin</code> header and then use <code>wazuh-logtest</code> to manually verify our rule.</p><p id="50c247b8-9358-45a4-a970-e49f6fc16d44" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="48a89696-a4a0-4d5b-b73e-06a2cc40eff6" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api7/user/key&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--header &#x27;Origin: https://bing.com&#x27;</code></pre><figure id="82c9bbb8-71c0-41ef-a338-36a2dc34f428" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20155.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20155.png"/></a></figure><p id="0bca2d1d-1c1b-4248-ae63-5950235c2f58" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="691f2bf6-3c03-4782-9870-f2d303ff9e5b" class="code"><code class="language-Bash">[2024-07-21 11:18:32] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api7/user/key&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;origin&quot;:[&quot;https://bing.com&quot;]},&quot;body&quot;:[]} 
[2024-07-21 11:18:32] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 11:18:32 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;userNotLoggedIn\&quot;}&quot;} </code></pre><figure id="f33b97f2-f2c0-41d9-a530-3ce5929be7c3" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20156.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20156.png"/></a></figure><p id="f5e771da-ba15-499d-979a-e2f55a1c09ab" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="6eae80ec-58c2-4b8c-8e2b-1970d66c0d1d" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20157.png"><img style="width:680px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20157.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8828baca-3618-4dd2-b5c5-0e0773f754d3" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;68096ff2&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:18:32] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api7/user/key&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;origin&quot;:[&quot;https://bing.com&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.origin: &#x27;[&quot;https://bing.com&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api7/user/key&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100028&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized header origin: [&quot;https://bing.com&quot;] detected in GET http://localhost/vapi/api7/user/key&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:18:32] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 11:18:32 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;userNotLoggedIn\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;userNotLoggedIn&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 11:18:32 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;</code></pre><p id="07661947-7a0d-4561-b2e4-7a7c563dfb9b" class="">The triggering of <code>Rule 100028</code> during the request phase ensures that any attempts to access the <code>/vapi/api7/user/key</code> endpoint with an <em>unauthorized</em> <code>Origin</code> <strong>header</strong> are logged and can be reviewed for potential security breaches.</p><hr id="c806f903-28ba-4f58-a7d6-2e7a982d7c19"/></li></ol><h2 id="34a12e0c-18b6-4dae-847d-5e8056420b36" class="">4.6 <strong>Injection</strong></h2><p id="b5071722-f20b-4edf-8f62-d54f6a4d56ad" class=""><strong>Injection vulnerabilities</strong> occur when untrusted data is sent to an interpreter as part of a command or query, allowing the data to be executed.</p><p id="a7278afa-faf0-4fe5-af3c-fb16953c2505" class="">For detecting <strong>SQL Injection</strong> attacks, we focus on the following endpoint:</p><ul id="df78e996-f501-4021-8d8f-59a83e603581" class="bulleted-list"><li style="list-style-type:disc"><strong>User Login</strong> (<strong>POST</strong>) - <code>http://{{host}}/vapi/api8/user/login</code></li></ul><p id="eee74115-b2cd-4d31-bbdf-cddcebf344a1" class="">The goal is to detect <strong>SQL Injection attempts</strong> in the body of <strong>POST</strong> requests to this endpoint. Below are the rules designed to detect such scenarios:</p><ol type="1" id="951a8453-f282-4322-96ff-f5aac2ba4c55" class="numbered-list" start="1"><li><strong>Potential SQL attempt detected</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d76bd2ba-5c22-4de4-9f4b-1147d2d0375b" class="code"><code class="language-XML">&lt;rule id=&quot;100029&quot; level=&quot;10&quot;&gt;
  &lt;field name=&quot;response_or_request&quot;&gt;Request&lt;/field&gt;
  &lt;field name=&quot;method&quot;&gt;POST&lt;/field&gt;
  &lt;url type=&quot;pcre2&quot;&gt;/vapi/api8/user/login&lt;/url&gt;
  &lt;field name=&quot;full_body&quot; type=&quot;pcre2&quot;&gt;(?i)(\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|UNION( +ALL)?)\b.*?)|&#x27;|\`|--.*|\/\*.*?\*\/&lt;/field&gt;
  &lt;mitre&gt;
    &lt;id&gt;T1190&lt;/id&gt;
  &lt;/mitre&gt;
  &lt;group&gt;attack,sql_injection,pci_dss_6.5,pci_dss_11.4,pci_dss_6.5.1,gdpr_IV_35.7.d,nist_800_53_SA.11,nist_800_53_SI.4,tsc_CC6.6,tsc_CC7.1,tsc_CC8.1,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,&lt;/group&gt;
  &lt;description&gt;Potential SQL attempt detected in $(method) $(url)&lt;/description&gt;
&lt;/rule&gt;</code></pre><ul id="db6d05b5-1c73-4c55-a8ef-3cc88e71e465" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger Conditions</strong>:<ul id="e53cff73-c4e7-45c9-8222-13c88c439ee5" class="bulleted-list"><li style="list-style-type:circle"><strong>Field</strong>: The rule applies to requests.</li></ul><ul id="9aa186f0-5856-49d6-a24b-efee1b89b45f" class="bulleted-list"><li style="list-style-type:circle"><strong>Method</strong>: The HTTP method must be POST.</li></ul><ul id="85131189-dec3-40fe-8b4f-2e67a42e4206" class="bulleted-list"><li style="list-style-type:circle"><strong>URL</strong>: The request must match the URL pattern <code>/vapi/api8/user/login</code>.</li></ul><ul id="e5565cf8-b5ad-4880-b8ce-1550a7b0df70" class="bulleted-list"><li style="list-style-type:circle"><strong>Body</strong>: The request body must contain patterns that are commonly associated with SQL injection attempts, such as SQL keywords (ALTER, CREATE, DELETE, etc.), single<br/>quotes, backticks, comments, and SQL comments.<br/></li></ul></li></ul><ul id="19c863ae-b22e-4282-9dac-19580366f93f" class="bulleted-list"><li style="list-style-type:disc"><strong>MITRE ATT&amp;CK Mapping</strong>: T1190 (Exploit Public-Facing Application)</li></ul><ul id="a5d202b7-4ac1-49eb-b01e-a246affd30f5" class="bulleted-list"><li style="list-style-type:disc"><strong>Groups</strong>: <code>attack</code>, <code>sql_injection</code>, <code>PCI DSS</code>, <code>NIST 800-53</code>, <code>GDPR</code>, <code>TSC</code></li></ul><p id="201c52e5-bd56-47ab-9473-30beb01fc3ba" class="">The purpose of this rule is to identify and alert on any POST requests to the <code>/vapi/api8/user/login</code> endpoint that contain suspicious patterns in the request body, which may indicate an attempt to inject malicious <strong>SQL</strong> code.</p></li></ol><ol type="1" id="9020ae52-f8ad-4e26-8b90-0be79e184d2b" class="numbered-list" start="2"><li><strong>Web attack returned code 200</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0abc0264-7558-4fea-b594-aa6c7a4c9e5b" class="code"><code class="language-XML">&lt;rule id=&quot;100030&quot; level=&quot;8&quot; frequency=&quot;2&quot; timeframe=&quot;120&quot;&gt;
  &lt;if_matched_sid&gt;100029&lt;/if_matched_sid&gt;
  &lt;description&gt;A web attack returned code 200 (success).&lt;/description&gt;
  &lt;mitre&gt;
    &lt;id&gt;T1190&lt;/id&gt;
  &lt;/mitre&gt;
  &lt;group&gt;attack,pci_dss_6.5,pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SA.11,nist_800_53_SI.4,tsc_CC6.6,tsc_CC7.1,tsc_CC8.1,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,&lt;/group&gt;
&lt;/rule&gt;</code></pre><ul id="4b6856be-0fa9-4b66-ae22-8a513ed2f172" class="bulleted-list"><li style="list-style-type:disc"><strong>Trigger Conditions</strong>:<ul id="e64ef336-ce45-43a9-9768-7fdad640647b" class="bulleted-list"><li style="list-style-type:circle"><strong>If Matched SID</strong>: Triggered if Rule 100029 is matched.</li></ul></li></ul><ul id="ebd6d7b2-0bad-40a7-bd7a-119eb317b718" class="bulleted-list"><li style="list-style-type:disc"><strong>MITRE ATT&amp;CK Mapping</strong>: T1190 (Exploit Public-Facing Application)</li></ul><ul id="a23a4a65-6cf0-46f1-9aba-abc8cbfefb11" class="bulleted-list"><li style="list-style-type:disc"><strong>Groups</strong>: <code>attack</code>, <code>PCI DSS</code>, <code>NIST 800-53</code>, <code>GDPR</code>, <code>TSC</code></li></ul><p id="36edfdb0-bcf3-43c8-8372-63137145f3b7" class="">This rule is a follow-up to <code>Rule 100029</code> and is triggered when a request matching <code>Rule 100029</code> receives a <strong>successful HTTP</strong> response (status code 200). This combination of a potential <strong>SQL injection</strong> attempt and a successful response may indicate that the attack was successful and the attacker gained <strong>unauthorized access</strong> to the system.</p><hr id="ccb443f5-155f-46c4-83e1-4d0574d4cfd9"/></li></ol><p id="ce7cd195-0f06-41b4-b50c-71ff7ffd85fd" class="">We will use <code>curl</code> to send requests to the login endpoint with <strong>SQL injection </strong>patterns in the body and then use <code>wazuh-logtest</code> to manually verify our rules.</p><p id="1d06acdd-b241-4483-8fde-f1c470f3a1ac" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b8186166-121f-4cf4-9e1e-080089a8914c" class="code"><code class="language-Bash">curl --location &#x27;http://localhost/vapi/api8/user/login&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--data &#x27;{
    &quot;username&quot;:&quot;Anto&#x27;\&#x27;&#x27;or&#x27;\&#x27;&#x27;1&#x27;\&#x27;&#x27;=&#x27;\&#x27;&#x27;1&quot;,
    &quot;password&quot;:&quot;Panto&#x27;\&#x27;&#x27;or&#x27;\&#x27;&#x27;1&#x27;\&#x27;&#x27;=&#x27;\&#x27;&#x27;1&quot;
}&#x27;</code></pre><figure id="b4b752f9-a056-4514-a279-9ddab9d1d6b2" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20158.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20158.png"/></a></figure><p id="236cf6fd-6793-45c0-8a71-3f93f982b332" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c8f98d8c-ddaa-4b3a-bec8-0bb3cb6a2590" class="code"><code class="language-Bash">[2024-07-21 11:42:55] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api8/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anto&#x27;or&#x27;1&#x27;=&#x27;1&quot;,&quot;password&quot;:&quot;Panto&#x27;or&#x27;1&#x27;=&#x27;1&quot;}} 
[2024-07-21 11:42:55] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 11:42:55 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;authkey\&quot;:\&quot;oWsZ8vWNuECjCAiZVJHOzsNsNH08zWRZ\&quot;}&quot;} </code></pre><figure id="ba59cee1-f65c-4f8f-aadb-f89e6b0d7d01" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20159.png"><img style="width:708px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20159.png"/></a></figure><p id="3499820b-73d6-4d2c-9d05-b0f5fbf16601" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="c8a45dfd-8496-464f-b6fb-e894f5a9099c" class="image"><a href="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20160.png"><img style="width:1846px" src="Detecting%20Top-10-API-Vulnerabilities-with-vAPI%20e962c52a79d04cfc8eb9821a8c173699/Untitled%20160.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1b3bce58-4ae9-4cbe-8693-3989a43d498c" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;c905c6f5&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:42:55] local.INFO: Request: {&quot;method&quot;:&quot;POST&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api8/user/login&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;content-length&quot;:[&quot;67&quot;]},&quot;body&quot;:{&quot;username&quot;:&quot;Anto&#x27;or&#x27;1&#x27;=&#x27;1&quot;,&quot;password&quot;:&quot;Panto&#x27;or&#x27;1&#x27;=&#x27;1&quot;}} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body.password: &#x27;Panto&#x27;or&#x27;1&#x27;=&#x27;1&#x27;
	body.username: &#x27;Anto&#x27;or&#x27;1&#x27;=&#x27;1&#x27;
	full_body: &#x27;&quot;username&quot;:&quot;Anto&#x27;or&#x27;1&#x27;=&#x27;1&quot;,&quot;password&quot;:&quot;Panto&#x27;or&#x27;1&#x27;=&#x27;1&quot;&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-length: &#x27;[&quot;67&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;POST&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api8/user/login&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100029&#x27;
	level: &#x27;10&#x27;
	description: &#x27;Potential SQL attempt detected in POST http://localhost/vapi/api8/user/login&#x27;
	groups: &#x27;[&quot;laravel&quot;,&quot;attack&quot;,&quot;sql_injection&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	gdpr: &#x27;[&quot;IV_35.7.d&quot;]&#x27;
	mail: &#x27;false&#x27;
	mitre.id: &#x27;[&quot;T1190&quot;]&#x27;
	mitre.tactic: &#x27;[&quot;Initial Access&quot;]&#x27;
	mitre.technique: &#x27;[&quot;Exploit Public-Facing Application&quot;]&#x27;
	nist_800_53: &#x27;[&quot;SA.11&quot;,&quot;SI.4&quot;]&#x27;
	pci_dss: &#x27;[&quot;6.5&quot;,&quot;11.4&quot;,&quot;6.5.1&quot;]&#x27;
	tsc: &#x27;[&quot;CC6.6&quot;,&quot;CC7.1&quot;,&quot;CC8.1&quot;,&quot;CC6.1&quot;,&quot;CC6.8&quot;,&quot;CC7.2&quot;,&quot;CC7.3&quot;]&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:42:55] local.INFO: Response: {&quot;status&quot;:200,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 11:42:55 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;true\&quot;,\&quot;authkey\&quot;:\&quot;oWsZ8vWNuECjCAiZVJHOzsNsNH08zWRZ\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;true&quot;,&quot;authkey&quot;:&quot;oWsZ8vWNuECjCAiZVJHOzsNsNH08zWRZ&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 11:42:55 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;200&#x27;</code></pre><p id="192505c3-9e2d-4c77-9e80-b99924ddf855" class="">The triggering of <code>Rule 100029</code> during the request phase ensures that any attempts to inject malicious <strong>SQL</strong> code into the <code>/vapi/api8/user/login</code> endpoint are logged and can be reviewed for potential security breaches. This structured approach to logging and rule evaluation helps  maintain the integrity and security of the application by identifying and alerting on injection vulnerabilities.</p><hr id="1a5463a0-69e5-47ca-b316-45002db6c772"/><h1 id="0dd71510-c632-4939-91c8-013b10a80064" class="">Conclusion</h1><p id="c0b0ea0e-7368-4c88-9c27-a7068b413df8" class="">In this extensive setup and testing process, we have successfully implemented a robust security monitoring system using <strong>Wazuh</strong> to detect various types of attacks on critical endpoints of our <strong>Laravel</strong>-based application. Here&#x27;s a summary of our accomplishments:</p><p id="452dcbcf-731c-4386-8de7-89d4b9689778" class=""><strong>Key Achievements:</strong></p><ol type="1" id="053ee1fb-d27f-40be-aec9-e2f8290dc9d2" class="numbered-list" start="1"><li><strong>Integration with Laravel:</strong><ul id="b85a05f8-5a95-4e0c-a958-eae6ba20e128" class="bulleted-list"><li style="list-style-type:disc">Configured Laravel to log HTTP requests and responses in a format compatible with Wazuh.</li></ul><ul id="0b04ac28-7164-49e9-bbbc-1d01b6bcd210" class="bulleted-list"><li style="list-style-type:disc">Developed custom decoders in Wazuh to accurately interpret Laravel logs.</li></ul></li></ol><ol type="1" id="f92407e0-5507-4b7c-9afe-7359eb742dbc" class="numbered-list" start="2"><li><strong>Detection of Broken Object-Level Authorization (BOLA):</strong><ul id="a3b19752-6b94-4685-841b-7c09e609465e" class="bulleted-list"><li style="list-style-type:disc">Implemented rules to detect unauthorized field access, duplicate entries, and brute-force attacks.</li></ul><ul id="a31d4fdc-62a2-4013-9671-94da57869285" class="bulleted-list"><li style="list-style-type:disc">Ensured successful detection of valid user creation and update events.</li></ul></li></ol><ol type="1" id="0fc1e6ca-6102-476f-a039-770cd7559c5d" class="numbered-list" start="3"><li><strong>Detection of Broken Authentication:</strong><ul id="d0b73a03-dfb1-4853-835e-fae3008153ce" class="bulleted-list"><li style="list-style-type:disc">Set up rules to detect login successes and failures.</li></ul><ul id="d7db0c2e-f35a-4f57-8363-dd861b8e80b2" class="bulleted-list"><li style="list-style-type:disc">Implemented high-level detection for potential brute-force login attempts.</li></ul></li></ol><ol type="1" id="cc4bdec6-9d5e-4e58-8bb7-63e16321fe31" class="numbered-list" start="4"><li><strong>Detection of Lack of Resources and Rate-Limiting:</strong><ul id="97123d9d-3608-48c0-9e69-b156780d87e8" class="bulleted-list"><li style="list-style-type:disc">Monitored for invalid OTP attempts and subsequent brute-force patterns.</li></ul><ul id="5f42b640-39ee-4987-afcf-5a6bf07090ad" class="bulleted-list"><li style="list-style-type:disc">Detected successful OTP verifications and unauthorized field additions.</li></ul></li></ol><ol type="1" id="f3f0f2a8-c330-4b7d-9906-d042edf030ab" class="numbered-list" start="5"><li><strong>Detection of Broken Function-Level Authorization:</strong><ul id="fbf57677-ba4e-44cf-9636-4610ac9e561c" class="bulleted-list"><li style="list-style-type:disc">Implemented rules to identify unauthorized access attempts to restricted data.</li></ul><ul id="7e17b8ef-ba71-4452-841a-76cc02567e8c" class="bulleted-list"><li style="list-style-type:disc">Ensured detection of successful and unauthorized user data retrieval and creation.</li></ul></li></ol><ol type="1" id="b1445fd0-2644-4e30-a31f-97442fafffa5" class="numbered-list" start="6"><li><strong>Detection of Security Misconfiguration:</strong><ul id="44f83392-c285-4f92-9e2a-e4e2e6259c46" class="bulleted-list"><li style="list-style-type:disc">Configured rules to detect unauthorized headers, specifically targeting potential CORS misconfigurations.</li></ul></li></ol><ol type="1" id="4476de3f-4735-4a03-8708-c127f7217869" class="numbered-list" start="7"><li><strong>Detection of Injection Attacks:</strong><ul id="b1bf368c-1c60-46a1-9680-32fc1adbe50a" class="bulleted-list"><li style="list-style-type:disc">Set up sophisticated rules to detect SQL injection patterns within the body of POST requests.</li></ul><ul id="c830f400-4d43-4d0c-a80b-8c8d5a494f02" class="bulleted-list"><li style="list-style-type:disc">Monitored for multiple occurrences indicating a potential successful attack.</li></ul></li></ol><p id="34f6ae12-f69f-462d-b2ec-4216407d5c4e" class=""><strong>Testing and Validation:</strong></p><ul id="e2cba847-db19-4845-95e5-23c1f52ca698" class="bulleted-list"><li style="list-style-type:disc">Utilized <code>curl</code> to simulate various attack vectors, sending HTTP requests mimicking malicious activities.</li></ul><ul id="f50c0dba-9d1b-44e0-a1fc-78abbf007d9d" class="bulleted-list"><li style="list-style-type:disc">Captured and analyzed Laravel logs to verify the accurate triggering of Wazuh rules.</li></ul><ul id="44f502f4-955d-44f0-b04f-8941f6be0237" class="bulleted-list"><li style="list-style-type:disc">Employed <code>wazuh-logtest</code> to manually validate log entries against the implemented rules, ensuring accurate and reliable detection.</li></ul><p id="ec08fd59-e6f6-47f2-bcd9-8c076f404546" class="">The combination of Laravel&#x27;s detailed logging and Wazuh&#x27;s powerful monitoring capabilities provides a formidable defense against a wide range of security threats. This setup not only enhances the immediate security of the application but also lays a strong foundation for future security initiatives and improvements. By continuously monitoring, updating, and refining our detection mechanisms, we can stay ahead of potential attackers and ensure the ongoing protection of our critical systems and data.</p><p id="05470bcc-d229-4502-9856-9a1dd7ca02ad" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>